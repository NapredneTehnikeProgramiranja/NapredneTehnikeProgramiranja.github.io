<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="sr" xml:lang="sr">
<head>
<!-- 2017-04-25 уто 17:28 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Napredne tehnike programiranja - Clojure</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Novak Boškov" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Napredne tehnike programiranja - Clojure</h1>
<div id="table-of-contents">
<h2>Sadr&#382;aj</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9981938">1. Uvod</a>
<ul>
<li><a href="#orge5ea156">1.1. Lisp</a>
<ul>
<li><a href="#org8f819a2">1.1.1. Scheme</a></li>
</ul>
</li>
<li><a href="#org9a07767">1.2. Clojure - funkcionalni način razmišljanja</a></li>
<li><a href="#org0be9415">1.3. Imperativno vs funckionalno programiranje</a></li>
<li><a href="#orge81a380">1.4. Clojure kao <i>value oriented</i> jezik</a></li>
<li><a href="#org5b52bc5">1.5. Referencijalna transparentnost i memoizacija</a></li>
<li><a href="#orgcf454bf">1.6. Misliti rekurzivno</a></li>
</ul>
</li>
<li><a href="#org38f21e2">2. REPL i IDE</a>
<ul>
<li><a href="#orga1197a9">2.1. <i>Build tools</i> - alati za izgradnju</a></li>
<li><a href="#org6a30ebb">2.2. <i>IDE</i> - integrisana razvojna okruženja</a></li>
</ul>
</li>
<li><a href="#org570cce3">3. Elementi jezika</a>
<ul>
<li><a href="#orgcf62197">3.1. Funkcije višeg reda</a>
<ul>
<li><a href="#org288b3b3">3.1.1. Parcijalne funkcije</a></li>
</ul>
</li>
<li><a href="#org53631c6">3.2. Kompozicija funkcija</a></li>
<li><a href="#org398a161">3.3. Clojure naglašava svoju lenjost</a></li>
<li><a href="#org9a54ebb">3.4. Vežbanje 1</a></li>
<li><a href="#org06d479e">3.5. Kada je mutacija stvarno nezaobilazna</a>
<ul>
<li><a href="#org79e8272">3.5.1. Atomi</a></li>
</ul>
</li>
<li><a href="#org001250b">3.6. Clojure u standardnim OO problemima</a></li>
<li><a href="#orgda71909">3.7. Perzistentne strukture podataka</a></li>
</ul>
</li>
<li><a href="#org2d57d33">4. Read, evaluate vrtlog i makroi</a>
<ul>
<li><a href="#org30fd61e">4.1. <i>Homoiconicy</i> &#x2014; "istoizglednost"</a></li>
</ul>
</li>
<li><a href="#orga775e59">5. Konkurentno i paralelno programiranje</a>
<ul>
<li><a href="#org27352ff">5.1. Reference</a></li>
<li><a href="#org87ff076">5.2. core.async</a></li>
</ul>
</li>
<li><a href="#org40ddf79">6. Interakcija sa platformom</a></li>
<li><a href="#org5ebecf4">7. Apstrakcije</a>
<ul>
<li><a href="#org0c1627f">7.1. Multimethods</a></li>
<li><a href="#orgc7f96d6">7.2. Protocols</a></li>
<li><a href="#orgf709161">7.3. Records</a></li>
<li><a href="#org1c76b8c">7.4. clojure.spec</a></li>
</ul>
</li>
<li><a href="#org833b1f7">8. ClojureScript</a></li>
<li><a href="#orgaac04c2">9. Reader conditionals (.cljc)</a></li>
<li><a href="#orga6aac1c">10. ClojureCLR</a></li>
<li><a href="#orga1a6de1">11. Literatura</a></li>
</ul>
</div>
</div>

<div class="figure">
<p><img src="images/clojure_logo.png" alt="clojure_logo.png" />
</p>
</div>

<blockquote>
<p>
Clojure is a dynamic, general-purpose programming language, combining
the approachability and interactive development of a scripting
language with an efficient and robust infrastructure for multithreaded
programming. Clojure is a compiled language, yet remains completely
dynamic – every feature supported by Clojure is supported at
runtime. Clojure provides easy access to the Java frameworks, with
optional type hints and type inference, to ensure that calls to Java
can avoid reflection.
</p>

<p>
Clojure is a dialect of Lisp, and shares with Lisp the code-as-data
philosophy and a powerful macro system. Clojure is predominantly a
functional programming language, and features a rich set of immutable,
persistent data structures. When mutable state is needed, Clojure
offers a software transactional memory system and reactive Agent
system that ensure clean, correct, multithreaded designs.
</p>

<p>
&#x2013; Rich Hickey (author of Clojure)
</p>
</blockquote>

<div id="outline-container-org9981938" class="outline-2">
<h2 id="org9981938"><span class="section-number-2">1</span> Uvod</h2>
<div class="outline-text-2" id="text-1">
<blockquote>
<p>
If your mind is empty, it is always ready for anything, it is open to
everything. In the beginner's mind there are many possibilities, but
in the expert's mind there are few.
</p>

<p>
&#x2013; Shunryu Suzuki
</p>
</blockquote>
</div>

<div id="outline-container-orge5ea156" class="outline-3">
<h3 id="orge5ea156"><span class="section-number-3">1.1</span> Lisp</h3>
<div class="outline-text-3" id="text-1-1">
<p>
<b>Lisp</b> ili <b>LISP</b> je porodica programskih jezika sa dugom
istorijom. Na prvi pogled ga karakteriše prefiksna notacija i
izrazi u zagradama. Prvobitno je specificiran 1956. godine od
strane <a href="https://en.wikipedia.org/wiki/John_McCarthy_(computer_scientist)">John McCarthy</a>-a za potrebe njegovih istraživanja u oblasti
veštačke inteligencije (<i>McCarthy</i> je inače i smislio naziv
<i>artificial intelligence</i> - <i>AI</i>). Lisp je drugi najstariji
programski jezik visokog nivoa, samo je <i>Fortran</i> jednu godinu
stariji, a poređenja radi:
</p>
<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> se pojavio 1972.</li>
<li><a href="https://en.wikipedia.org/wiki/C%2B%2B">C++</a> 1983.</li>
<li><a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> 1991 (kada i <a href="https://en.wikipedia.org/wiki/Visual_Basic">Visual Basic</a>).</li>
<li><a href="https://en.wikipedia.org/wiki/Java_(programming_language)">Java</a> 1995.</li>
<li><a href="https://en.wikipedia.org/wiki/C_Sharp_(programming_language)">C#</a> 2000.</li>
</ul>

<p>
Lisp je konstruisan kao matematička notacija za kompjuterske
programe inspirisana <a href="https://en.wikipedia.org/wiki/Lambda_calculus">Lambda računom</a>(<a href="https://en.wikipedia.org/wiki/Alonzo_Church">Alonzo Church</a>). Ovaj način
predstave programa doneo je mnoge ideje u kompjuterske nauke:
</p>
<ul class="org-ul">
<li>strukture tipa stabla</li>
<li>automatsko upravljanje memorijom (garbage collector)</li>
<li><i>dynamic typing</i></li>
<li>kondicionale (grananje)</li>
<li>funkcije višeg reda</li>
<li>rekurziju i rekurzivan opis podataka</li>
<li>self-hosting kompajler</li>
<li>REPL itd.</li>
</ul>

<p>
Veliki broj navedenih stvari inspirisao je programske jezike koji
su nastali nakon Lisp-a (tj. skoro sve programske jezike) ali neki
od korisnih koncepata iz Lisp-a se i dan dans smatraju naprednim i
još uvek nisu podržani u pojedinim jezicima koji se intenzivno
koriste.
</p>

<p>
Matematičku formulaciju Lisp-a i koncepata koje ona donosi nadalje
pogledajte <a href="../resources/perzistencija_clojure.pdf">ovde</a> (poglavlja 1.1, 1.2 i 1.3).
</p>

<p>
Pored <i>Clojure</i> dijalekta kojim ćemo se baviti na ovom kursu tu je
još pregršt drugih dijalekata sa raznim osobinama:
</p>

<ul class="org-ul">
<li><a href="https://common-lisp.net/">Commnon Lisp</a></li>
<li><a href="https://en.wikipedia.org/wiki/Scheme_(programming_language)">Scheme</a></li>
<li><a href="https://www.gnu.org/software/emacs/">Emacs Lisp</a></li>
<li><a href="https://en.wikipedia.org/wiki/AutoLISP">AutoLisp</a></li>
<li><a href="http://www.paulgraham.com/arc.html">Arc</a></li>
<li><a href="http://lfe.io/">Lisp Flovered Erlang</a>
&#x2026;</li>
</ul>
</div>

<div id="outline-container-org8f819a2" class="outline-4">
<h4 id="org8f819a2"><span class="section-number-4">1.1.1</span> Scheme</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
<b>Scheme</b> je jedan od najznačajnijih dijalekata Lisp-a. Dizajniran
je od početka sa idejom funkcionalnog programiranja i minimalizma
sa veoma moćnim mehanizmima za proširenje jezika. Prvi je
dijalekat koji usled naglašavanja funkcionalnog programiranja
uvodi <a href="https://en.wikipedia.org/wiki/Tail_call">tail call optimizaciju</a>. Takođe jedan je od prvih programskih
jezika koji imaju podržanu <a href="https://en.wikipedia.org/wiki/Continuation">kontinuaciju</a>.
</p>

<p>
Neke od "biblija" računarske nauke su kao jezik-primer uzimale
upravo Scheme. Jedna, vrlo značajna, takva knjiga je i <a href="http://deptinfo.unice.fr/~roy/sicp.pdf">Structure
and Interpretation of Computer Programs</a>.
</p>

<p>
Postoji mnogo raznih dijalekata Scheme-a a ovde će biti navedena
samo dva.
</p>
</div>

<ol class="org-ol"><li><a id="org0208327"></a>Chez Scheme (Cisco)<br /><div class="outline-text-5" id="text-1-1-1-1">
<p>
<a href="https://github.com/cisco/ChezScheme"><b>Chez</b></a> je <a href="http://www.r6rs.org/">Scheme implementacija</a> zajedno sa (moćnim) kompajlerom,
<i>run time</i> sistemom i bibliotekama. Koristi je kompanije Cisco a
od skoro je <i>open source</i>.
</p>

<p>
Ako danas želite da probate Scheme da njime rešite problem na
kome radite a fokus Vam je na performansama, IO, konkurentnom
programiranju ili Vam treba dobra mogućnost korišćenja postojećih
C biblioteka onda nije loše da počnete sa <b>Chez</b>-om.
</p>
</div></li>

<li><a id="orgc20f3b1"></a>Racket lang<br /><div class="outline-text-5" id="text-1-1-1-2">
<p>
<a href="https://racket-lang.org/">Racket lang</a> je takođe implementacija Schema-a ali sa potpuno
drugim ciljevima pri dizajnu. Racket je po svom dizajnu sistem za
pravljenje programskih jezika (i/ili <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>-ova). Ima veoma dobar
ekosistem biblioteka (u formi jezika) za razne standardne (WEB
serveri, GUI &#x2026;) i manje standardne zadatke. Sve njegove
biblioteke su veoma dobro dokumentovane. Racket ima i svoje
razvojno okruženje (<i>IDE</i>) DrRacket koje sadrži sve na šta ste
navikli od jednog <i>IDE</i>-a (uključujući i grafički
<i>debugger</i>). Ako je dizajn DSL-ova način na koji razmišljate pri
rešavanju problema onda će Racket lang i njegovo okruženje biti
odlično društvo od kojeg možete mnogo da naučite.
</p>
</div></li></ol>
</div>
</div>

<div id="outline-container-org9a07767" class="outline-3">
<h3 id="org9a07767"><span class="section-number-3">1.2</span> Clojure - funkcionalni način razmišljanja</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Danas postoji mnogo programskih jezika i zaista se (pre)veliki deo
njih međusobno razlikuje skoro isključivo po sintaksi. Tako da
danas nije nikakav problem nazivati se <b>polyglot</b> programerom -
samo naučite par sintaktičkih pravila i <i>Voila!</i> znate još jedan
programski jezik (nezaboravite da osvežite svoj CV).
</p>

<p>
<b>Clojure</b> ipak nije jedan od jezika koji se početniku čini od
ranije poznatim. Čak ni na prvi pogled (za šta je zaslužna
<i>S-expression</i> prefiksna notacija). Stoga, kako biste ga naučili
morate primeniti neku drugu strategiju u odnosu na onu navedenu
iznad.
</p>

<p>
Evo jednog predloženog pristupa:
</p>

<blockquote>
<p>
Zaboravite sve što znate o programiranju. <b>Pristupite učenju
Clojure-a kao da Vam je to prvi programski jezik</b> . U suprotnom
ćete Clojure shvatiti samo kao <i>prefiksnu notaciju sa zagradama
koja Vam ne dozvoljava da pišete kod onako kako ste navikli!</i>
</p>

<p>
<b>Umesto da pokušavate svoje znanje od ranije da preslikate na</b>
<b>Clojure, dozvolite ovom Lispu da obogati način na koji pišete</b>
<b>ostale programske jezike.</b>
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org0be9415" class="outline-3">
<h3 id="org0be9415"><span class="section-number-3">1.3</span> Imperativno vs funckionalno programiranje</h3>
<div class="outline-text-3" id="text-1-3">
<p>
C, C++, C#, Java, Python svi ovi (i drugi) programski jezici imaju
veoma sličnu sintaksu i svi koriste veoma slične programske
konstrukcije sa akcentom na imperativno programiranje.
</p>

<blockquote>
<p>
U kompjuterskoj nauci imperativno programiranje je paradigma
programiranja koja koristi naredbe u cilju menjanja stanja
programa.
</p>
</blockquote>

<p>
Ova paradigma programiranja se savršeno uklapa u <a href="https://en.wikipedia.org/wiki/Von_Neumann_architecture">von Neumann-ov</a>
model izračunavanja na računaru. Tačnije, ona je dizajnirana kako
bi oslikala pomenuti model izračunavanja.
</p>

<p>
Na primer, C je dominirao softverom veliki broj godina jer se
odlično uklapa u ovu dominantnu paradigmu hardverske
arhitekture. Programi napisani u C-u su veoma efikasni i u stanju
su da vrše veoma efikasno upravljanje memorijom koja je <i>do skora</i>
bila veliki problem. Ova efikasnost je plaćena cenom izraženom u
kompleksnijoj semantici i sintaksi samog jezika pa sa porastom
programskog koda dramatično opada sposobnost programera da
iskontroliše konstruktorsku kompleksnost što dovodi do češćih
defekata u radu programa (<b>program radi brzo ali ne i ono što
želimo &#x2014; korektno</b>). Ova kompleksnost potiče od toga što kod
imperativnog programiranja posao koji naredbe obavljaju snažno
zavisi od stanja memorije u tom momentu. To čini <b>konkurentno</b>
programiranje veoma komplikovanim i stoga podložnim greškama.
</p>

<blockquote>
<p>
Danas kada je memorija veoma brza i jeftina a kada višeprocesorske
arhitekture svi nosimo u džepovima ili pametnim satovima
imperativno programiranje počinje da pokazuje ozbiljne znake
starenja.
</p>
</blockquote>

<p>
Funkcionalno programiranje se zasniva više na stabilnim
matematičkim konceptima nego na bilo kom modelu izračunavanja na
mašini. Clojure kao funkcionalan programski jezik ima snažan fokus
na <a href="https://en.wikipedia.org/wiki/Immutable_object">nepromenljivosti podataka</a> (u daljem tekstu imutabilnost). To mu
omogućava veoma čiste i jednostavne apstrakcije za konkurentno
programiranje koje su svakako korektnije i manje podložno greškama
od eksplicitnog zaključavanja delova memorije na koje smo usmereni
u imperativnom programiranju.
</p>

<p>
Clojure (kao Lisp) je zapravo zasnovan na jednom veoma konciznom
matematičkom modelu kakav je Lambda račun pa tako i njegova
sintaksa barata sa svega nekoliko raznih konstrukcija što je čini
veoma prostom. <i>Uviđanje ove jednostavnosti dolazi uz malo vežbe.</i>
</p>
</div>
</div>

<div id="outline-container-orge81a380" class="outline-3">
<h3 id="orge81a380"><span class="section-number-3">1.4</span> Clojure kao <i>value oriented</i> jezik</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Clojure promoviše stil programiranja koji se zove <i>value-oriented
programming</i> i nije jedini jezik koji to radi. <b>Rich Hickey</b> je
ovaj koncept vrlo lepo objasnio u svom <a href="https://www.youtube.com/watch?v=-6BsiVyC1kM">izlaganju</a> na <i>Jax
Conf</i>-u 2012. godine.
</p>

<p>
Ideja je da se programer koncentriše na vrednosti u njegovom
programu a ne na mutabilne objekte i njihovo stanje (objekti se
smatraju tankom apstrakcijom oko "gole" memorije). Ovo je veoma
moćan koncept jer kada prestanete da razmišljate o objektima i
memoriji onda konkurentno programiranje postaje manje-više
trivijalan posao.
</p>

<p>
U objektno orijentisanom programiranju takođe imamo potrebu i za
skrivanjem informacija (<i>information hiding</i>) i ograničavanjem
pristupa delovima objekta kroz <i>enkapsulaciju</i>. Clojure otklanja tu
potrebu jer barata samim vrednostima, podaci su <b>semantički
transparentni</b>. Ovaj nivo transparentnosti omogućava bolju osnovu
za rezonovanje o kodu. Uprošćavanje kompleksnih funkcija <b>uvek</b>
može biti izvedeno prostom supstitucijom. Evo jednog naivnog
primera koji to ilustruje:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">square</span> <span style="color: #BFEBBF;">[</span>a<span style="color: #BFEBBF;">]</span> <span style="color: #BFEBBF;">(</span>* a a<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">sum-of-squares</span> <span style="color: #BFEBBF;">[</span>a b<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span>+ <span style="color: #D0BF8F;">(</span>square a<span style="color: #D0BF8F;">)</span> <span style="color: #D0BF8F;">(</span>square b<span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>= <span style="color: #BFEBBF;">(</span>sum-of-squares 2 5<span style="color: #BFEBBF;">)</span>
   <span style="color: #BFEBBF;">(</span>+ <span style="color: #D0BF8F;">(</span>square 2<span style="color: #D0BF8F;">)</span> <span style="color: #D0BF8F;">(</span>square 5<span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span>
   <span style="color: #BFEBBF;">(</span>+ 4 25<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b52bc5" class="outline-3">
<h3 id="org5b52bc5"><span class="section-number-3">1.5</span> Referencijalna transparentnost i memoizacija</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Funkcije za koje uvek po njihovim parametrima možete da kažete sa
čim bi ste ih zamenili su <a href="https://en.wikipedia.org/wiki/Referential_transparency">referencijalno transparentne</a>. Da li su
funkcije koje pišete u matematici referencijalno transparentne? Da
li je \(x^2\) uvek isto za isto \(x\)?
</p>

<p>
<b>Ako je kvadrat broja 4323 uvek 18688329 da li ga ima smisla uvek
iznova računati?</b>
</p>

<p>
Optimizaciona tehnika koja nam omogućuje da programski jezik
zapamti vrednosti referencijalno transparentnih funkcija za
parametre zove se <a href="https://en.wikipedia.org/wiki/Memoization">memoizacija</a>.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">fib</span> <span style="color: #BFEBBF;">[</span>n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">cond</span>
    <span style="color: #D0BF8F;">(</span>= n 0<span style="color: #D0BF8F;">)</span> 0
    <span style="color: #D0BF8F;">(</span>= n 1<span style="color: #D0BF8F;">)</span> 1
    <span style="color: #BFEBBF;">:else</span> <span style="color: #D0BF8F;">(</span>+ <span style="color: #93E0E3;">(</span>fib <span style="color: #9FC59F;">(</span>- n 1<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span>
             <span style="color: #93E0E3;">(</span>fib <span style="color: #9FC59F;">(</span>- n 2<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">memo-fib</span> <span style="color: #BFEBBF;">(</span>memoize fib<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>time <span style="color: #BFEBBF;">(</span>fib 23<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">"Elapsed time: 30.039186 msecs"</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">28657</span>

<span style="color: #DCDCCC;">(</span>time <span style="color: #BFEBBF;">(</span>memo-fib 23<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">"Elapsed time: 23.083033 msecs"</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">28657</span>

<span style="color: #DCDCCC;">(</span>time <span style="color: #BFEBBF;">(</span>memo-fib 23<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">"Elapsed time: 0.246522 msecs"</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">28657</span>

<span style="color: #DCDCCC;">(</span>doc memoize<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/memoize</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([f])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Returns a memoized version of a referentially transparent function. The</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">memoized version of the function keeps a cache of the mapping from arguments</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">to results and, when calls with the same arguments are repeated often, has</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">higher performance at the expense of higher memory use.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>
</pre>
</div>

<p>
Kada se memoizovana funkcija poziva prvi put ona troši vreme kao i
njena obična verzija ali se svaki sledeći put kada bude pozvana
<b>uštedi jedno vreme izvršavanja</b>.
</p>
</div>
</div>

<div id="outline-container-orgcf454bf" class="outline-3">
<h3 id="orgcf454bf"><span class="section-number-3">1.6</span> Misliti rekurzivno</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Iz razloga koji su opisani <a href="#org0be9415">ranije</a> imperativni programski jezici ne
stavljaju previše akcenat na rekurziju. Funcionalno programiranje
rekurziju koristi kao osnovni alat. Tamo gde imperativno
programiranje koristi petlje funkcionalno programiranje koristi
razne vidove rekurzije.
</p>

<blockquote>
<p>
Rekurzija je kada rešenje problem opisujete rešavanjem manje
porcije tog istog problema.
</p>

<p>
Rekurzija je jedna od centralnih ideja kompjuterske nauke.
</p>
</blockquote>


<div class="figure">
<p><img src="images/First_matryoshka_museum_doll_open.jpg" alt="First_matryoshka_museum_doll_open.jpg" />
</p>
</div>


<div class="figure">
<p><img src="images/RecursiveTree.jpg" alt="RecursiveTree.jpg" />
</p>
</div>

<p>
Imperativno programiranje problem faktorijela posmatra ovako:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">factorial</span>(n):
    <span style="color: #DFAF8F;">acc</span> = 1

    <span style="color: #F0DFAF; font-weight: bold;">for</span> i <span style="color: #F0DFAF; font-weight: bold;">in</span> <span style="color: #DCDCCC; font-weight: bold;">range</span>(1, n + 1):
        <span style="color: #DFAF8F;">acc</span> *= i

    <span style="color: #F0DFAF; font-weight: bold;">return</span> acc
</pre>
</div>

<p>
Clojure kao funkcionalan <a href="#orge81a380">value oriented</a> jezik ne podržava mutiranje
pa tako:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">factorial</span> <span style="color: #BFEBBF;">[</span>n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">case</span> n
    <span style="color: #D0BF8F;">(</span>0 1<span style="color: #D0BF8F;">)</span> 1
    <span style="color: #D0BF8F;">(</span>* n <span style="color: #93E0E3;">(</span>factorial <span style="color: #9FC59F;">(</span>- n 1<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
</pre>
</div>

<p>
Ako ispratimo izvršavanje ove rekurzije videćemo da "clojure" mora
svaku operaciju da stavi na stek kako <code>n</code> raste. To za veliko <code>n</code>
može izazvati <i>stack overflow</i>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>factorial 6<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span>* 6 <span style="color: #BFEBBF;">(</span>factorial 5<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span>* 6 <span style="color: #BFEBBF;">(</span>* 5 <span style="color: #D0BF8F;">(</span>factorial 4<span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span>* 6 <span style="color: #BFEBBF;">(</span>* 5 <span style="color: #D0BF8F;">(</span>* 4 <span style="color: #93E0E3;">(</span>factorial 3<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span>* 6 <span style="color: #BFEBBF;">(</span>* 5 <span style="color: #D0BF8F;">(</span>* 4 <span style="color: #93E0E3;">(</span>* 3 <span style="color: #9FC59F;">(</span>factorial 2<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span>* 6 <span style="color: #BFEBBF;">(</span>* 5 <span style="color: #D0BF8F;">(</span>* 4 <span style="color: #93E0E3;">(</span>* 3 <span style="color: #9FC59F;">(</span>* 2 <span style="color: #94BFF3;">(</span>factorial 1<span style="color: #94BFF3;">)</span><span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span>* 6 <span style="color: #BFEBBF;">(</span>* 5 <span style="color: #D0BF8F;">(</span>* 4 <span style="color: #93E0E3;">(</span>* 3 <span style="color: #9FC59F;">(</span>* 2 1<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span>* 6 <span style="color: #BFEBBF;">(</span>* 5 <span style="color: #D0BF8F;">(</span>* 4 <span style="color: #93E0E3;">(</span>* 3 2<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span>* 6 <span style="color: #BFEBBF;">(</span>* 5 <span style="color: #D0BF8F;">(</span>* 4 6<span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span>* 6 <span style="color: #BFEBBF;">(</span>* 5 24<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span>* 6 120<span style="color: #DCDCCC;">)</span>
720
</pre>
</div>

<p>
Ovakva rekurzija se naziva još i <b>linearna rekurzija</b>.
</p>

<p>
U opštem slučaju ovaj problem se rešava <a href="https://en.wikipedia.org/wiki/Tail_call">tail call optimizacijom</a>.
</p>

<p>
Međutim, pošto je Clojure <b>hosted</b> programski jezik, a <i>JVM</i> ne
podržava ovu optimizaciju onda se Clojure koristi jednim trikom &#x2014;
<code>recur</code>
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>doc recur<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">recur</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(recur exprs*)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Special Form</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Evaluates the exprs in order, then, in parallel, rebinds</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">the bindings of the recursion point to the values of the exprs.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Execution then jumps back to the recursion point, a loop or fn method.</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Please see http://clojure.org/special_forms#recur</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>
</pre>
</div>

<p>
Naš <code>factorial</code> koristeći <code>recur</code> možemo napisati na sledeći način:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">factorial-recur</span> <span style="color: #BFEBBF;">[</span>n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">loop</span> <span style="color: #D0BF8F;">[</span>count n acc 1<span style="color: #D0BF8F;">]</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #93E0E3;">(</span>zero? count<span style="color: #93E0E3;">)</span>
      acc
      <span style="color: #93E0E3;">(</span><span style="color: #F0DFAF; font-weight: bold;">recur</span> <span style="color: #9FC59F;">(</span>dec count<span style="color: #9FC59F;">)</span> <span style="color: #9FC59F;">(</span>* count acc<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
</pre>
</div>

<p>
<code>loop</code> konstrukcija je zapravo anonimna - <i>lambda</i> funkcija sa
početnim <i>binding</i>-om.
</p>

<blockquote>
<p>
<i>Binding</i> u kompjuterskoj nauci znači asocijaciju nekog imena i nekog izraza.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>doc loop<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/loop</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(loop [bindings*] exprs*)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Special Form</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Evaluates the exprs in a lexical context in which the symbols in</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">the binding-forms are bound to their respective init-exprs or parts</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">therein. Acts as a recur target.</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Please see http://clojure.org/special_forms#loop</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>
</pre>
</div>

<p>
Primetite da <b>sada imamo poziv recur kao poslednji izraz u
funkciji</b> (u repu - <i>tail call</i>) pa tako nema potrebe za čuvanjem
na steku. Funkcija se izvršava ovako:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>factorial-recur 6<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">loop</span> 6 1<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">loop</span> 5 6<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">loop</span> 4 30<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">loop</span> 3 120<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">loop</span> 2 360<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">loop</span> 1 720<span style="color: #DCDCCC;">)</span>
<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">loop</span> 0 720<span style="color: #DCDCCC;">)</span>
720
</pre>
</div>

<p>
Šta ako imamo potrebu za međusobnom rekurzijom (pogledajte zadatak
sa parsiranjem iz Python dela ovog kursa)?
</p>

<p>
Za potrebe ilustracije ovog koncepta implementirajmo svoju funckiju
za određivanje da li je broj paran ili ne na sledeći način:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">declare</span> is-even? is-odd?<span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>doc declare<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/declare</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([&amp; names])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Macro</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">defs the supplied var names with no bindings, useful for making forward decla</span><span style="color: #DC8CC3; background-color: #3F3F3F;">rations.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">is-even?</span> <span style="color: #BFEBBF;">[</span>n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #D0BF8F;">(</span>= n 0<span style="color: #D0BF8F;">)</span>
    <span style="color: #BFEBBF;">true</span>
    <span style="color: #D0BF8F;">(</span>is-odd? <span style="color: #93E0E3;">(</span>dec n<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">is-odd?</span> <span style="color: #BFEBBF;">[</span>n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #D0BF8F;">(</span>= n 0<span style="color: #D0BF8F;">)</span>
    <span style="color: #BFEBBF;">false</span>
    <span style="color: #D0BF8F;">(</span>is-even? <span style="color: #93E0E3;">(</span>dec n<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>is-odd? 12<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; false</span>
<span style="color: #DCDCCC;">(</span>is-even? 12<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; true</span>
</pre>
</div>

<p>
Međutim, ovaj pristup opet ima problem sa alokacijom steka. Pa
definišimo to na malo drugačiji način:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">declare</span> is-even-2? is-odd-2?<span style="color: #DCDCCC;">)</span>

#<span style="color: #DCDCCC;">(</span>+ 1 2<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; #function[clojure-ntp.core/eval20359/fn--20360]</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">is-even-2?</span> <span style="color: #BFEBBF;">[</span>n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #D0BF8F;">(</span>= n 0<span style="color: #D0BF8F;">)</span>
    <span style="color: #BFEBBF;">true</span>
    #<span style="color: #D0BF8F;">(</span>is-odd-2? <span style="color: #93E0E3;">(</span>dec n<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">is-odd-2?</span> <span style="color: #BFEBBF;">[</span>n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #D0BF8F;">(</span>= n 0<span style="color: #D0BF8F;">)</span>
    <span style="color: #BFEBBF;">false</span>
    #<span style="color: #D0BF8F;">(</span>is-even-2? <span style="color: #93E0E3;">(</span>dec n<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>trampoline is-odd-2? 12<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; false</span>
<span style="color: #DCDCCC;">(</span>trampoline is-even-2? 12<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; true</span>
</pre>
</div>

<p>
Međutim, korisnik naše funkcije sada mora da zna da treba da je
pozove sa <code>trampoline</code>. To nije baš divno. Pa preformulišimo to još
malo:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>doc letfn<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/letfn</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(letfn [fnspecs*] exprs*)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Special Form</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">fnspec ==&gt; (fname [params*] exprs) or (fname ([params*] exprs)+)</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Takes a vector of function specs and a body, and generates a set of</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">bindings of functions to their names. All of the names are available</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">in all of the definitions of the functions, as well as the body.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">my-odd?</span> <span style="color: #BFEBBF;">[</span>n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">letfn</span> <span style="color: #D0BF8F;">[</span><span style="color: #93E0E3;">(</span>o? <span style="color: #9FC59F;">[</span>n<span style="color: #9FC59F;">]</span>
          <span style="color: #9FC59F;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #94BFF3;">(</span>= n 0<span style="color: #94BFF3;">)</span>
            <span style="color: #BFEBBF;">false</span>
            #<span style="color: #94BFF3;">(</span>e? <span style="color: #E0CF9F;">(</span>dec n<span style="color: #E0CF9F;">)</span><span style="color: #94BFF3;">)</span><span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span>
          <span style="color: #93E0E3;">(</span>e? <span style="color: #9FC59F;">[</span>n<span style="color: #9FC59F;">]</span>
            <span style="color: #9FC59F;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #94BFF3;">(</span>= n 0<span style="color: #94BFF3;">)</span>
              <span style="color: #BFEBBF;">true</span>
              #<span style="color: #94BFF3;">(</span>o? <span style="color: #E0CF9F;">(</span>dec n<span style="color: #E0CF9F;">)</span><span style="color: #94BFF3;">)</span><span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">]</span>
    <span style="color: #D0BF8F;">(</span>trampoline o? n<span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">my-even?</span> <span style="color: #BFEBBF;">[</span>n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span>not <span style="color: #D0BF8F;">(</span>my-odd? n<span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>my-odd? 12<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; false</span>
<span style="color: #DCDCCC;">(</span>my-even? 12<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;;</span><span style="color: #7F9F7F;">=&gt; true</span>
</pre>
</div>

<p>
Sada je već bolje. A najbolje je što sada <b>nema nepotrebnih
alokacija steka</b>.
</p>
</div>
</div>
</div>

<div id="outline-container-org38f21e2" class="outline-2">
<h2 id="org38f21e2"><span class="section-number-2">2</span> REPL i IDE</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orga1197a9" class="outline-3">
<h3 id="orga1197a9"><span class="section-number-3">2.1</span> <i>Build tools</i> - alati za izgradnju</h3>
<div class="outline-text-3" id="text-2-1">
<p>
U Clojure zajednici se paralelno koriste dva alata za izgradnju:
</p>

<ul class="org-ul">
<li><a href="https://leiningen.org/">Leiningen</a></li>
<li><a href="http://boot-clj.com/">Boot</a></li>
</ul>

<p>
<i>Lein</i> je po svom funkcionisanju sličniji alatima za razvoj koje
srećemo u drugim programskim jezicima pa ćemo ga na ovom kursu
koristiti. Ovde je potrebno napomenuti da je <i>Boot</i> prilično
zanimljiv i inovativan pristup izgradnji i da mu svakako vredi
posvetiti pažnju. <i>Boot</i> na veoma pametan način koristi Clojure kao
potpuno dinamičko Lisp okruženje.
</p>

<p>
Kako biste počeli da koristite <i>lein</i> potrebno je da pročitate
<i><a href="https://github.com/technomancy/leiningen/blob/stable/doc/TUTORIAL.md#creating-a-project">Creating a Project</a></i> poglavlje iz totorijala.
</p>
</div>
</div>

<div id="outline-container-org6a30ebb" class="outline-3">
<h3 id="org6a30ebb"><span class="section-number-3">2.2</span> <i>IDE</i> - integrisana razvojna okruženja</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Podešavanje za rad u Clojure-u nije teško pronaći bez obzira na to
koji je Vaš omiljeni način rada i sviđaju li Vam se više
tradicionalni editori ili tradicionalna razvojna okruženja. Evo par
rešenja:
</p>

<ul class="org-ul">
<li>GNU/Emacs - <a href="https://github.com/clojure-emacs/cider">CIDER</a> (<a href="http://blog.cognitect.com/blog/2017/1/31/state-of-clojure-2016-results">najkorišćenije</a> u okviru Clojure zajednice)</li>
<li>Vim - <a href="https://github.com/tpope/vim-fireplace">Fireplace</a></li>
<li>Eclipse - <a href="http://doc.ccw-ide.org/documentation.html">Counterclockwise</a></li>
<li>IntelliJ - <a href="https://cursive-ide.com/">Cursive</a></li>
<li><a href="http://lighttable.com/">LightTable</a> - napredni editor pisan u Clojure-u (podržava osnovne
Clojure alate bez dodatne konfiguracije)</li>
<li><a href="https://sekao.net/nightcode/">Nightcode</a> - osnovni editor pisan u Clojure-u (preporučen Clojure
početnicima)</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org570cce3" class="outline-2">
<h2 id="org570cce3"><span class="section-number-2">3</span> Elementi jezika</h2>
<div class="outline-text-2" id="text-3">
<p>
Ovaj kurs nema deo posvećen upoznavanju sa bazičnim elementima
jezika iz par razloga:
</p>

<ol class="org-ol">
<li>jer bi autor ovog teksta to sigurno uradio lošije nego što je urađeno:
<ul class="org-ul">
<li>u knjizi <i>Clojure For The Brave And True</i> <a href="http://www.braveclojure.com/do-things/">ovde</a>.</li>
<li>na sajtu <a href="https://kimh.github.io/clojure-by-example/#require">Clojure By Example</a>.</li>
</ul></li>
<li>jer su bazični elementi jezika vrlo unificirani (kao i kod svakog
Lisp-a).</li>
<li>jer se proste stvari najbrže uče individualno (tada je najmanja
šansa da Vam neko proste stvari zakomplikuje svojim lošim
objašnjenjem)</li>
</ol>
</div>

<div id="outline-container-orgcf62197" class="outline-3">
<h3 id="orgcf62197"><span class="section-number-3">3.1</span> Funkcije višeg reda</h3>
<div class="outline-text-3" id="text-3-1">
<p>
<a href="https://en.wikipedia.org/wiki/Higher-order_function">Funkcije višeg</a> reda su funkcije koje primaju funkcije kao parametre
i/ili vraćaju funkcije.
</p>

<p>
Neke funkcije višeg reda kao što su <code>map</code>, <code>filter</code>, <code>reduce</code> su
Vam poznate od ranije iz drugih programskih jezika.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">students</span> <span style="color: #BFEBBF;">[</span><span style="color: #D0BF8F;">{</span><span style="color: #BFEBBF;">:city</span> <span style="color: #CC9393;">"Novi Sad"</span> <span style="color: #BFEBBF;">:name</span> <span style="color: #CC9393;">"Milica"</span><span style="color: #D0BF8F;">}</span>
               <span style="color: #D0BF8F;">{</span><span style="color: #BFEBBF;">:city</span> <span style="color: #CC9393;">"Loznica"</span> <span style="color: #BFEBBF;">:name</span> <span style="color: #CC9393;">"Jelena"</span><span style="color: #D0BF8F;">}</span>
               <span style="color: #D0BF8F;">{</span><span style="color: #BFEBBF;">:city</span> <span style="color: #CC9393;">"Loznica"</span> <span style="color: #BFEBBF;">:name</span> <span style="color: #CC9393;">"Milan"</span><span style="color: #D0BF8F;">}</span>
               <span style="color: #D0BF8F;">{</span><span style="color: #BFEBBF;">:city</span> <span style="color: #CC9393;">"Loznica"</span> <span style="color: #BFEBBF;">:name</span> <span style="color: #CC9393;">"Stefan"</span><span style="color: #D0BF8F;">}</span>
               <span style="color: #D0BF8F;">{</span><span style="color: #BFEBBF;">:city</span> <span style="color: #CC9393;">"Novi Sad"</span> <span style="color: #BFEBBF;">:name</span> <span style="color: #CC9393;">"Ivana"</span><span style="color: #D0BF8F;">}</span><span style="color: #BFEBBF;">]</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>filter #<span style="color: #BFEBBF;">(</span>= <span style="color: #CC9393;">"Loznica"</span> <span style="color: #D0BF8F;">(</span><span style="color: #BFEBBF;">:city</span> <span style="color: #DFAF8F;">%</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span> students<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">({</span><span style="color: #7F9F7F;">:city</span><span style="color: #7F9F7F;"> "Loznica", </span><span style="color: #7F9F7F;">:name</span><span style="color: #7F9F7F;"> "Jelena"}</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">{</span><span style="color: #7F9F7F;">:city</span><span style="color: #7F9F7F;"> "Loznica", </span><span style="color: #7F9F7F;">:name</span><span style="color: #7F9F7F;"> "Milan"}</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">{</span><span style="color: #7F9F7F;">:city</span><span style="color: #7F9F7F;"> "Loznica", </span><span style="color: #7F9F7F;">:name</span><span style="color: #7F9F7F;"> "Stefan"})</span>
</pre>
</div>

<p>
Sećate li se objektnog programiranja i <a href="https://en.wikipedia.org/wiki/Command_pattern">Command pattern</a>-a iz Jave?
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">Command is an interface defining method execute() for its execution</span>

<span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">wrapInTransaction</span>(<span style="color: #7CB8BB;">Command</span> <span style="color: #DFAF8F;">c</span>) <span style="color: #F0DFAF; font-weight: bold;">throws</span> <span style="color: #7CB8BB;">Exception</span> {
    setupDataInfrastructure();
    <span style="color: #F0DFAF; font-weight: bold;">try</span> {
        c.execute();
        completeTransaction();
    } <span style="color: #F0DFAF; font-weight: bold;">catch</span> (<span style="color: #7CB8BB;">Exception</span> <span style="color: #DFAF8F;">condition</span>) {
        rollbackTransaction();
        <span style="color: #F0DFAF; font-weight: bold;">throw</span> condition;
    } <span style="color: #F0DFAF; font-weight: bold;">finally</span> {
        cleanUp();
    }
}

<span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">addOrderFrom</span>(<span style="color: #F0DFAF; font-weight: bold;">final</span> <span style="color: #7CB8BB;">ShoppingCart</span> <span style="color: #DFAF8F;">cart</span>, <span style="color: #F0DFAF; font-weight: bold;">final</span> <span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">userName</span>,
                         <span style="color: #F0DFAF; font-weight: bold;">final</span> <span style="color: #7CB8BB;">Order</span> <span style="color: #DFAF8F;">order</span>) <span style="color: #F0DFAF; font-weight: bold;">throws</span> <span style="color: #7CB8BB;">Exception</span> {
    wrapInTransaction(<span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #7CB8BB;">Command</span>() {
            <span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">execute</span>() {
                add(order, userKeyBassedOn(username));
                addLineItemsFrom(cart, order.getOrderKey());
            }
        });
}
</pre>
</div>

<p>
Nije li funkcija odličan način za modelovanje neke funkcije
(komande) sistema? :)
</p>

<p>
Verovatno jeste. Problem objektnog programiranja u Javi je što ako
posao modelujemo funkcijom onda posao ne možemo poslati nekoj
metodi na izvršavanje jer nemamo na raspolaganju funkcije višeg
reda. U Clojure-u je to prirodna stvar:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">wrapInTransaction</span> <span style="color: #BFEBBF;">[</span>f<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">do</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #94BFF3;">startTransaction</span><span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span>f<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #94BFF3;">completeTransaction</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span><span style="color: #94BFF3;">wrapInTransaction</span> #<span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">do</span>
                      <span style="color: #D0BF8F;">(</span>add order user<span style="color: #D0BF8F;">)</span>
                      <span style="color: #D0BF8F;">(</span><span style="color: #94BFF3;">addLineItemsFrom</span> cart <span style="color: #94BFF3;">orderKey</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
</pre>
</div>

<p>
Ruku na srce, Java od verzije 1.8 ima podršku za funkcije višeg
reda. Najbolji način da uvidite koliko su funkcije višeg reda
prirodne za Clojure je da ih probate u npr. Javi.
</p>
</div>

<div id="outline-container-org288b3b3" class="outline-4">
<h4 id="org288b3b3"><span class="section-number-4">3.1.1</span> Parcijalne funkcije</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Kada smo radili napredno Python programiranje videli smo šta su i
kako se mogu koristiti parcijalne funkcije. Pogledajmo u ovom
odeljku za šta se one mogu koristiti.
</p>

<p>
U objektnom programiranju postoji način da izgradimo neki objekat
u nizu koraka. Pošto objektno programiranje prethodno ustanovljene
prakse zove šablonima onda se šablon o kome ovde govorimo zove
<a href="https://en.wikipedia.org/wiki/Builder_pattern"><i>Builder Pattern</i></a>. Takođe postoji i jedan prilično sličan šablon
koji služi da za proizvodnju sličnih objekata - <a href="https://en.wikipedia.org/wiki/Abstract_factory_pattern"><i>Abstract Factory
Pattern</i></a>.
</p>

<p>
Sa druge strane, osnovni metod apstrakcije funkcionalnih
programskih jezika su funkcije, a koncept koji nam omogućuje da od
postojećih funkcija sa već datim delom parametara pravimo nove
funkcije su <b>parcijalne funkcije</b>.
</p>

<p>
Pogledajmo sada osnovno korišćenje parcijalnih funkcija u
Cljure-u:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>doc partial<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/partial</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([f] [f arg1] [f arg1 arg2] [f arg1 arg2 arg3] [f arg1 arg2 arg3 &amp; more])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Takes a function f and fewer than the normal arguments to f, and</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">returns a fn that takes a variable number of additional args. When</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">called, the returned function calls f with args + additional args.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">mul3</span> <span style="color: #BFEBBF;">(</span>partial * 3<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>mul3 2<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; 6</span>
</pre>
</div>

<p>
Sada možemo dati neke primere Clojure-a iz realnog sveta koji
pokazuju kako se mogu koristiti parcijalne funkcije tamo gde se u
objektnom programiranju koriste gorepomenuti šabloni:
</p>

<p>
Za ovaj primer nam je potrebna biblioteka <a href="https://github.com/clojure/java.jdbc"><code>clojure.java.jdbc</code></a>.
</p>

<p>
I recimo da želimo da pravimo upite na našu bazu podataka koristeći
samo <code>clojure.java.jdbc</code>. To u praksi možemo uradi ovako:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>doc do<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">do</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(do exprs*)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Special Form</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Evaluates the expressions in order and returns the value of</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">the last. If no expressions are supplied, returns nil.</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Please see http://clojure.org/special_forms#do</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

#_<span style="color: #DCDCCC;">(</span><span style="color: #7F9F7F;">do</span>
<span style="color: #7F9F7F;">    </span><span style="color: #BFEBBF;">(</span><span style="color: #7F9F7F;">def spec </span><span style="color: #D0BF8F;">{</span><span style="color: #7F9F7F;">:classname   "org.posgresql.Driver"</span>
<span style="color: #7F9F7F;">               :subprotocol "postgresql"</span>
<span style="color: #7F9F7F;">               :subname     "//localhost:5453/our_little_database"</span><span style="color: #D0BF8F;">}</span><span style="color: #BFEBBF;">)</span>

<span style="color: #7F9F7F;">    </span><span style="color: #BFEBBF;">(</span><span style="color: #7F9F7F;">defn all-users </span><span style="color: #D0BF8F;">[]</span>
<span style="color: #7F9F7F;">      </span><span style="color: #D0BF8F;">(</span><span style="color: #7F9F7F;">jdbc/query spec </span><span style="color: #93E0E3;">[</span><span style="color: #7F9F7F;">"select * from login order by username desc"</span><span style="color: #93E0E3;">]</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span>

<span style="color: #7F9F7F;">    </span><span style="color: #BFEBBF;">(</span><span style="color: #7F9F7F;">defn find-user </span><span style="color: #D0BF8F;">[</span><span style="color: #7F9F7F;">username</span><span style="color: #D0BF8F;">]</span>
<span style="color: #7F9F7F;">      </span><span style="color: #D0BF8F;">(</span><span style="color: #7F9F7F;">jdbc/query spec </span><span style="color: #93E0E3;">[</span><span style="color: #7F9F7F;">"select * from login where username = ?" username</span><span style="color: #93E0E3;">]</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span>

<span style="color: #7F9F7F;">    </span><span style="color: #BFEBBF;">(</span><span style="color: #7F9F7F;">defn create-user </span><span style="color: #D0BF8F;">[</span><span style="color: #7F9F7F;">username password</span><span style="color: #D0BF8F;">]</span>
<span style="color: #7F9F7F;">      </span><span style="color: #D0BF8F;">(</span><span style="color: #7F9F7F;">jdbc/insert! spec :login </span><span style="color: #93E0E3;">{</span><span style="color: #7F9F7F;">:username username :password password</span>
<span style="color: #7F9F7F;">                                 :sal      "some_salt"</span><span style="color: #93E0E3;">}</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
</pre>
</div>

<p>
U objektnom programiranju ne biste pisali specifikaciju konekcije
na bazu u svakom upitu već biste se već nekako odlučili da pravite
<i>builder</i> (razmisliti šta to sve tačno obuhvata). Ovde biste
takav efekat postigli mnogo direktnije:
</p>

<div class="org-src-container">
<pre class="src src-clojure">#_<span style="color: #DCDCCC;">(</span><span style="color: #7F9F7F;">do</span>
<span style="color: #7F9F7F;">    </span><span style="color: #BFEBBF;">(</span><span style="color: #7F9F7F;">def spec </span><span style="color: #D0BF8F;">{</span><span style="color: #7F9F7F;">:classname   "org.posgresql.Driver"</span>
<span style="color: #7F9F7F;">               :subprotocol "postgresql"</span>
<span style="color: #7F9F7F;">               :subname     "//localhost:5453/our_little_database"</span><span style="color: #D0BF8F;">}</span><span style="color: #BFEBBF;">)</span>

<span style="color: #7F9F7F;">    </span><span style="color: #BFEBBF;">(</span><span style="color: #7F9F7F;">def query </span><span style="color: #D0BF8F;">(</span><span style="color: #7F9F7F;">partial jdbc/query spec</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span>

<span style="color: #7F9F7F;">    </span><span style="color: #BFEBBF;">(</span><span style="color: #7F9F7F;">def insert! </span><span style="color: #D0BF8F;">(</span><span style="color: #7F9F7F;">partial jdbc/insert! spec</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span>

<span style="color: #7F9F7F;">    </span><span style="color: #BFEBBF;">(</span><span style="color: #7F9F7F;">defn all-users </span><span style="color: #D0BF8F;">[]</span>
<span style="color: #7F9F7F;">      </span><span style="color: #D0BF8F;">(</span><span style="color: #7F9F7F;">query </span><span style="color: #93E0E3;">[</span><span style="color: #7F9F7F;">"select * from login order by username desc"</span><span style="color: #93E0E3;">]</span><span style="color: #D0BF8F;">)</span>

<span style="color: #7F9F7F;">      </span><span style="color: #D0BF8F;">(</span><span style="color: #7F9F7F;">defn find-user </span><span style="color: #93E0E3;">[</span><span style="color: #7F9F7F;">username</span><span style="color: #93E0E3;">]</span>
<span style="color: #7F9F7F;">        </span><span style="color: #93E0E3;">(</span><span style="color: #7F9F7F;">query </span><span style="color: #9FC59F;">[</span><span style="color: #7F9F7F;">"select * from login where username = ?" username</span><span style="color: #9FC59F;">]</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span>

<span style="color: #7F9F7F;">      </span><span style="color: #D0BF8F;">(</span><span style="color: #7F9F7F;">defn create-user </span><span style="color: #93E0E3;">[</span><span style="color: #7F9F7F;">username password</span><span style="color: #93E0E3;">]</span>
<span style="color: #7F9F7F;">        </span><span style="color: #93E0E3;">(</span><span style="color: #7F9F7F;">insert! :login </span><span style="color: #9FC59F;">{</span><span style="color: #7F9F7F;">:username username :password password</span>
<span style="color: #7F9F7F;">                         :sal      "some_salt"</span><span style="color: #9FC59F;">}</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
</pre>
</div>

<p>
Naravno, kao i svim široko korišćenim programskim jezicima i u
Clojure-u postoji čitav spektar gotovih biblioteka koje Vam daju
apstrakciju nad osnovnim drajverom baze podataka (u ovom slučaju
nad <i>jdbc</i>-om).
</p>

<p>
Drugi primer iz <i>real world</i> Clojure koda gde se koriste parcijalne
funkcije je kada imate funkciju višeg reda kojoj želite da
prosledite neku funkciju koja prima više parametara. Npr. funkcija
<code>*</code> nema previše smisla za jedan argument.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">apply-sales-tax</span> <span style="color: #BFEBBF;">[</span>items<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span>map <span style="color: #D0BF8F;">(</span>partial * 1.6<span style="color: #D0BF8F;">)</span> items<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>apply-sales-tax <span style="color: #BFEBBF;">[</span>0.23 0.12 8.12 4.2<span style="color: #BFEBBF;">]</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; (0.36800000000000005 0.192 12.991999999999999 6.720000000000001)</span>
</pre>
</div>

<p>
Prokomentarišite sledeći rezultat?
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">a-result</span> <span style="color: #BFEBBF;">[</span>items<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span>map * items<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>a-result <span style="color: #BFEBBF;">[</span>0.23 0.12 8.12 4.2<span style="color: #BFEBBF;">]</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; (0.23 0.12 8.12 4.2)</span>
</pre>
</div>

<p>
Nedostatak parcijalnih funkcija formulisanih na način kako je to
urađeno u Clojure-u što se parametri funkcije parcijalizuju <b>samo</b>
sa početka. Na primer funkciju <code>-</code> ne možemo <b>samo</b> koristeći
<code>partial</code> parcijalizovati drugim parametrom već samo prvim.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>map <span style="color: #BFEBBF;">(</span>partial - 2<span style="color: #BFEBBF;">)</span> <span style="color: #BFEBBF;">[</span>1 2 3<span style="color: #BFEBBF;">]</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; (1 0 -1)</span>
</pre>
</div>

<p>
Ali možemo postići taj efekat uvodeći jednu prostu <code>lambdu</code>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>map #<span style="color: #BFEBBF;">(</span>- <span style="color: #DFAF8F;">%</span> 2<span style="color: #BFEBBF;">)</span> <span style="color: #BFEBBF;">[</span>1 2 3<span style="color: #BFEBBF;">]</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; (-1 0 1)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org53631c6" class="outline-3">
<h3 id="org53631c6"><span class="section-number-3">3.2</span> Kompozicija funkcija</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Još jednom, Clojure svoje korene vuče iz matematike pa tako ima još
jedan veoma moćan koncept apstrakcije - <b>kompoziciju funkcija</b>.
</p>

<blockquote>
<p>
Kompozicija funkcija je primena funkcije na rezultate druge
funkcije u cilju dobijanja treće funkcije.
</p>

<p>
\(f \circ g (x) = f(g(x))\)
</p>
</blockquote>

<p>
Ili za one kojima je poznavanje <i>Unix-a</i> trenutno ispred poznavanja
matematike - "to je ako pipe (|) u <i>shell-u</i>":
</p>

<div class="org-src-container">
<pre class="src src-shell">ls | grep <span style="color: #CC9393;">"clojure-ntp"</span>
</pre>
</div>

<p>
U svrhu ilustracije zamislimo da imamo neki JavaScript kod i da
želimo da ga minificiramo tj. da pročitamo JavaScript fajl kao
tekst i da iz tog teksta izbacimo sve nove redove i druge
nepotrebne karaktere kako bi se manje podataka prenosilo mrežom. Za
to vrlo elegantno možemo da iskoristimo kompoziciju funkcija koje
već postoje u Clojure-u:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">minify</span> <span style="color: #BFEBBF;">[</span>input<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #7CB8BB;">clojure.string</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>join
   <span style="color: #D0BF8F;">(</span>map <span style="color: #7CB8BB;">clojure.string</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>trim
        <span style="color: #93E0E3;">(</span><span style="color: #7CB8BB;">clojure.string</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>split-lines input<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>minify <span style="color: #CC9393;">"javascriptcode javascriptcode    </span><span style="color: #CC9393; font-weight: bold;">\n</span><span style="color: #CC9393;">javascriptcodejavascriptco   </span><span style="color: #CC9393; font-weight: bold;">\n</span><span style="color: #CC9393;">"</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; javascriptcode javascriptcodejavascriptcodejavascriptco</span>
</pre>
</div>

<p>
Primetimo da se poslednja navedena funkcija poziva prva tj. primena
funkcija ide "iznutra ka spolja". To možda može izgledati čudno
(iako je baš tako i u matematičkoj notaciji) pa onda Clojure pruža
drugi način da se ovo zapiše korišćenjem <i>threading macro</i>-a (o
makroima će biti reči <a href="#org2d57d33">u nastavku</a>):
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">minify2</span> <span style="color: #BFEBBF;">[</span>input<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">-&gt;</span> <span style="color: #7CB8BB;">clojure.string</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>trim
      <span style="color: #D0BF8F;">(</span>map <span style="color: #93E0E3;">(</span><span style="color: #7CB8BB;">clojure.string</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>split-lines input<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span>
      <span style="color: #7CB8BB;">clojure.string</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>join<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>minify2 <span style="color: #CC9393;">"javascriptcode javascriptcode    </span><span style="color: #CC9393; font-weight: bold;">\n</span><span style="color: #CC9393;">javascriptcodejavascriptco   </span><span style="color: #CC9393; font-weight: bold;">\n</span><span style="color: #CC9393;">"</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; "javascriptcode javascriptcodejavascriptcodejavascriptco"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org398a161" class="outline-3">
<h3 id="org398a161"><span class="section-number-3">3.3</span> Clojure naglašava svoju lenjost</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Clojure se ne smatra lenjim jezikom u smislu u kome se to misli
kada se govori o Haskell-u (o tome u nastavku kursa) ali naglašava
lenje izvršavanje na mnogim mestima.
</p>

<p>
Mnoge ugrađene funkcije vraćaju lenje sekvence. Takve su <code>map</code>,
<code>reduce</code>, <code>filter</code> i druge. To se može jednostavno videti na
primeru:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">result</span> <span style="color: #BFEBBF;">(</span>map #<span style="color: #D0BF8F;">(</span><span style="color: #F0DFAF; font-weight: bold;">do</span> <span style="color: #93E0E3;">(</span>println <span style="color: #CC9393;">"."</span><span style="color: #93E0E3;">)</span> <span style="color: #93E0E3;">(</span>inc <span style="color: #DFAF8F;">%</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span> <span style="color: #D0BF8F;">[</span>0 1 2 3<span style="color: #D0BF8F;">]</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

result
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(1 2 3 4)</span>
</pre>
</div>

<p>
Da Clojure nije lenj tačke bi se ispisivale na ekran odmah pri
definisanju <code>result</code>-a. Ovako je ispisivanje na ekran pozvano tek
kada smo zatražili da se <code>result</code> isprinta.
</p>

<p>
Još jedna stvar za koju lenje sekvence mogu biti od koristi je i
predstava beskonačnih struktura. Npr, ako imamo lenje sekvence i
skup realnih brojeva onda fibonačijevu sekvencu možemo da
predstavimo na sledeći način:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">fib-seq</span>
  <span style="color: #BFEBBF;">(</span>lazy-cat <span style="color: #D0BF8F;">[</span>1 1<span style="color: #D0BF8F;">]</span> <span style="color: #D0BF8F;">(</span>map + <span style="color: #93E0E3;">(</span>rest fib-seq<span style="color: #93E0E3;">)</span> fib-seq<span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>doc lazy-cat<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/lazy-cat</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([&amp; colls])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Macro</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Expands to code which yields a lazy sequence of the concatenation</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">of the supplied colls.  Each coll expr is not evaluated until it is</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">needed.</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(lazy-cat xs ys zs) === (concat (lazy-seq xs) (lazy-seq ys) (lazy-seq zs))</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span>take 10 fib-seq<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; (1 1 2 3 5 8 13 21 34 55)</span>

<span style="color: #DCDCCC;">(</span>doc take<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/take</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([n] [n coll])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Returns a lazy sequence of the first n items in coll, or all items if</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">there are fewer than n.  Returns a stateful transducer when</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">no collection is provided.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>
</pre>
</div>

<p>
Kada smo radili napredni Python upoznali smo se sa metodama koje
nam omogućuju da beskonačno kružimo kroz konačne strukture. Ovde je
dat još jedan primer korišćenja ovog koncepta:
</p>

<p>
Recimo želimo da ravnomerno rasporedimo ljude iz kolekcije na 4
moguća izlaza:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">people</span> <span style="color: #BFEBBF;">[</span><span style="color: #CC9393;">"Milica"</span> <span style="color: #CC9393;">"Milan"</span> <span style="color: #CC9393;">"Ivan"</span> <span style="color: #CC9393;">"Stefan"</span> <span style="color: #CC9393;">"Nikolina"</span> <span style="color: #CC9393;">"Nikola"</span> <span style="color: #CC9393;">"Ilija"</span> <span style="color: #CC9393;">"Dunja</span><span style="color: #DC8CC3; background-color: #3F3F3F;">"</span>
             <span style="color: #CC9393;">"Vi&#353;nja"</span> <span style="color: #CC9393;">"Aida"</span> <span style="color: #CC9393;">"Nemanja"</span> <span style="color: #CC9393;">"Ivona"</span> <span style="color: #CC9393;">"Petar"</span> <span style="color: #CC9393;">"Petra"</span> <span style="color: #CC9393;">"Aagda"</span> <span style="color: #CC9393;">"Du&#353;an"</span><span style="color: #BFEBBF;">]</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>mapv #<span style="color: #BFEBBF;">(</span>vector <span style="color: #DFAF8F;">%1</span> <span style="color: #DFAF8F;">%2</span><span style="color: #BFEBBF;">)</span> <span style="color: #BFEBBF;">(</span>cycle <span style="color: #D0BF8F;">[</span><span style="color: #BFEBBF;">:up</span> <span style="color: #BFEBBF;">:down</span> <span style="color: #BFEBBF;">:left</span> <span style="color: #BFEBBF;">:right</span><span style="color: #D0BF8F;">]</span><span style="color: #BFEBBF;">)</span> people<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">[[</span><span style="color: #7F9F7F;">:up</span><span style="color: #7F9F7F;"> "Milica"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:down</span><span style="color: #7F9F7F;"> "Milan"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:left</span><span style="color: #7F9F7F;"> "Ivan"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:right</span><span style="color: #7F9F7F;"> "Stefan"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:up</span><span style="color: #7F9F7F;"> "Nikolina"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:down</span><span style="color: #7F9F7F;"> "Nikola"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:left</span><span style="color: #7F9F7F;"> "Ilija"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:right</span><span style="color: #7F9F7F;"> "Dunja"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:up</span><span style="color: #7F9F7F;"> "Vi&#353;nja"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:down</span><span style="color: #7F9F7F;"> "Aida"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:left</span><span style="color: #7F9F7F;"> "Nemanja"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:right</span><span style="color: #7F9F7F;"> "Ivona"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:up</span><span style="color: #7F9F7F;"> "Petar"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:down</span><span style="color: #7F9F7F;"> "Petra"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:left</span><span style="color: #7F9F7F;"> "Aagda"]</span>
<span style="color: #5F7F5F;">;;  </span><span style="color: #7F9F7F;">[</span><span style="color: #7F9F7F;">:right</span><span style="color: #7F9F7F;"> "Du&#353;an"]]</span>

<span style="color: #DCDCCC;">(</span>doc mapv<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/mapv</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([f coll] [f c1 c2] [f c1 c2 c3] [f c1 c2 c3 &amp; colls])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Returns a vector consisting of the result of applying f to the</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">set of first items of each coll, followed by applying f to the set</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">of second items in each coll, until any one of the colls is</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">exhausted.  Any remaining items in other colls are ignored. Function</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">f should accept number-of-colls arguments.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span>doc vector<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/vector</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([] [a] [a b] [a b c] [a b c d] [a b c d e] [a b c d e f] [a b c d e f &amp; args</span><span style="color: #DC8CC3; background-color: #3F3F3F;">])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Creates a new vector containing the args.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a54ebb" class="outline-3">
<h3 id="org9a54ebb"><span class="section-number-3">3.4</span> Vežbanje 1</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Ideje zadataka uglavnom preuzete sa <a href="https://www.4clojure.com">4Clojure</a>.
</p>

<ol class="org-ol">
<li>Napisati funkciju <code>say-hello</code> koja prima parametar <code>name</code> i vraća
tekst <code>Hello to &lt;name&gt;</code>.</li>
<li><p>
Napisati funkciju <code>get-the-caps</code> koja prima string engleskih
slova a vraća samo njegova velika slova.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>doc -&gt;&gt;<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/-&gt;&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([x &amp; forms])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Macro</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Threads the expr through the forms. Inserts x as the</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">last item in the first form, making a list of it if it is not a</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">list already. If there are more forms, inserts the first form as the</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">last item in second form, etc.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span>doc apply<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/apply</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([f args] [f x args] [f x y args] [f x y z args] [f a b c d &amp; args])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Applies fn f to the argument list formed by prepending intervening arguments </span><span style="color: #DC8CC3; background-color: #3F3F3F;">to args.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">get-the-caps</span>
  <span style="color: #9FC59F;">"Gets the string and returns string consisted of capital letters from</span>
<span style="color: #9FC59F;">  the original."</span>
  <span style="color: #BFEBBF;">[</span>s<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">let</span> <span style="color: #D0BF8F;">[</span>capitals <span style="color: #93E0E3;">(</span><span style="color: #F0DFAF; font-weight: bold;">-&gt;&gt;</span> <span style="color: #9FC59F;">(</span>range 65 91<span style="color: #9FC59F;">)</span>
                      <span style="color: #9FC59F;">(</span>map char<span style="color: #9FC59F;">)</span>
                      set<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">]</span>
    <span style="color: #D0BF8F;">(</span>apply str <span style="color: #93E0E3;">(</span>filter capitals s<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>get-the-caps <span style="color: #CC9393;">"AmsdaBsdaDsdaDAS"</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; "ABDDAS"</span>
</pre>
</div></li>

<li><p>
Napisati funkciju <code>drop-nth</code> koja prima dva parametra od kojih je
prvo vektor elemenata a drugo <code>n</code>. Funkcija vraća listu bez
svakog <code>n</code>-tog elementa.
</p>

<p>
Eksplicitnom rekurzijom:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">drop-nth</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">----------------------------------------------------------------------</span>

<span style="color: #DCDCCC;">(</span>doc concat<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/concat</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([] [x] [x y] [x y &amp; zs])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Returns a lazy seq representing the concatenation of the elements in the supp</span><span style="color: #DC8CC3; background-color: #3F3F3F;">lied colls.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span>doc into<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/into</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([to from] [to xform from])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Returns a new coll consisting of to-coll with all of the items of</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">from-coll conjoined. A transducer may be supplied.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">drop-nth</span>
  <span style="color: #9FC59F;">"Drop every nth element from a vector starting with first if n fits</span>
<span style="color: #9FC59F;">  in length of v."</span>
  <span style="color: #BFEBBF;">[</span>v n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">loop</span> <span style="color: #D0BF8F;">[</span>v   v
         acc <span style="color: #93E0E3;">[]</span><span style="color: #D0BF8F;">]</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #93E0E3;">(</span>&gt; n <span style="color: #9FC59F;">(</span>count v<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span>
      <span style="color: #93E0E3;">(</span>into <span style="color: #9FC59F;">[]</span> acc<span style="color: #93E0E3;">)</span>
      <span style="color: #93E0E3;">(</span><span style="color: #F0DFAF; font-weight: bold;">recur</span> <span style="color: #9FC59F;">(</span>drop n v<span style="color: #9FC59F;">)</span>
             <span style="color: #9FC59F;">(</span><span style="color: #F0DFAF; font-weight: bold;">-&gt;&gt;</span> v <span style="color: #94BFF3;">(</span>take <span style="color: #E0CF9F;">(</span>dec n<span style="color: #E0CF9F;">)</span><span style="color: #94BFF3;">)</span> <span style="color: #94BFF3;">(</span>concat acc<span style="color: #94BFF3;">)</span><span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>drop-nth <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 2<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [0 2 4 6 8]</span>

<span style="color: #DCDCCC;">(</span>drop-nth <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 3<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [0 1 3 4 6 7]</span>

<span style="color: #DCDCCC;">(</span>drop-nth <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 5<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [0 1 2 3 5 6 7 8]</span>

<span style="color: #DCDCCC;">(</span>drop-nth <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 10<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [0 1 2 3 4 5 6 7 8]</span>

<span style="color: #DCDCCC;">(</span>drop-nth <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 11<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; []</span>
</pre>
</div>

<p>
Ili koristeći <code>keep-indexed</code> funkciju:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>doc -&gt;<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/-&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([x &amp; forms])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Macro</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Threads the expr through the forms. Inserts x as the</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">second item in the first form, making a list of it if it is not a</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">list already. If there are more forms, inserts the first form as the</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">second item in second form, etc.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span>doc keep-indexed<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/keep-indexed</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([f] [f coll])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Returns a lazy sequence of the non-nil results of (f index item). Note,</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">this means false return values will be included.  f must be free of</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">side-effects.  Returns a stateful transducer when no collection is</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">provided.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">drop-nth-2</span>
  <span style="color: #9FC59F;">"Drop every nth element from a vector starting with first if n fits</span>
<span style="color: #9FC59F;">  in length of v."</span>
  <span style="color: #BFEBBF;">[</span>v n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #D0BF8F;">(</span>&gt;= <span style="color: #93E0E3;">(</span>count v<span style="color: #93E0E3;">)</span> n<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span>vec
     <span style="color: #93E0E3;">(</span>keep-indexed <span style="color: #9FC59F;">(</span><span style="color: #F0DFAF; font-weight: bold;">fn</span> <span style="color: #94BFF3;">[</span>i v<span style="color: #94BFF3;">]</span> <span style="color: #94BFF3;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #E0CF9F;">(</span><span style="color: #F0DFAF; font-weight: bold;">-&gt;</span> i
                                     <span style="color: #8FB28F;">(</span>mod n<span style="color: #8FB28F;">)</span>
                                     zero?
                                     not<span style="color: #E0CF9F;">)</span>
                               v<span style="color: #94BFF3;">)</span><span style="color: #9FC59F;">)</span>
                   v<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">[]</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>drop-nth-2 <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 2<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [1 3 5 7 9]</span>

<span style="color: #DCDCCC;">(</span>drop-nth-2 <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 3<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [1 2 4 5 7 8]</span>

<span style="color: #DCDCCC;">(</span>drop-nth-2 <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 5<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [1 2 3 4 6 7 8 9]</span>

<span style="color: #DCDCCC;">(</span>drop-nth-2 <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 10<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [1 2 3 4 5 6 7 8 9]</span>

<span style="color: #DCDCCC;">(</span>drop-nth-2 <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 11<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; []</span>
</pre>
</div>

<p>
Ili uz malo skupovnih operacija:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">drop-nthh</span>
  <span style="color: #9FC59F;">"Drop every n-th element using only take-nth and a little bit of</span>
<span style="color: #9FC59F;">  type theory."</span>
  <span style="color: #BFEBBF;">[</span>v n<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #D0BF8F;">(</span>&gt;= <span style="color: #93E0E3;">(</span>count v<span style="color: #93E0E3;">)</span> n<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span>vec <span style="color: #93E0E3;">(</span><span style="color: #7CB8BB;">clojure.set</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>difference <span style="color: #9FC59F;">(</span>apply sorted-set v<span style="color: #9FC59F;">)</span> <span style="color: #9FC59F;">(</span>take-nth n v<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">[]</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>drop-nthh <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 2<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [1 3 5 7 9]</span>

<span style="color: #DCDCCC;">(</span>drop-nthh <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 3<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [1 2 4 5 7 8]</span>

<span style="color: #DCDCCC;">(</span>drop-nthh <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 5<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [1 2 3 4 6 7 8 9]</span>

<span style="color: #DCDCCC;">(</span>drop-nthh <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 10<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; [1 2 3 4 5 6 7 8 9]</span>

<span style="color: #DCDCCC;">(</span>drop-nthh <span style="color: #BFEBBF;">(</span>range 10<span style="color: #BFEBBF;">)</span> 11<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; []</span>
</pre>
</div></li>

<li><p>
Napravite <code>flip</code> funkciju višeg reda koja invertuje parametre
prosleđene funkcije.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #BFEBBF;">(</span>flip -<span style="color: #BFEBBF;">)</span> 1 2<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; 1</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>doc apply<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/apply</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([f args] [f x args] [f x y args] [f x y z args] [f a b c d &amp; args])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Applies fn f to the argument list formed by prepending intervening arguments </span><span style="color: #DC8CC3; background-color: #3F3F3F;">to args.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">flip</span>
  <span style="color: #9FC59F;">"Flip the parameters of a function."</span>
  <span style="color: #BFEBBF;">[</span>f<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">fn</span> <span style="color: #D0BF8F;">[</span>&amp; args<span style="color: #D0BF8F;">]</span>
    <span style="color: #D0BF8F;">(</span>apply f <span style="color: #93E0E3;">(</span>reverse args<span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>= 3 <span style="color: #BFEBBF;">(</span><span style="color: #D0BF8F;">(</span>flip nth<span style="color: #D0BF8F;">)</span> 2 <span style="color: #D0BF8F;">[</span>1 2 3 4 5<span style="color: #D0BF8F;">]</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; true</span>

<span style="color: #DCDCCC;">(</span>= <span style="color: #BFEBBF;">true</span> <span style="color: #BFEBBF;">(</span><span style="color: #D0BF8F;">(</span>flip &gt;<span style="color: #D0BF8F;">)</span> 7 8<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; true</span>

<span style="color: #DCDCCC;">(</span>= 4 <span style="color: #BFEBBF;">(</span><span style="color: #D0BF8F;">(</span>flip quot<span style="color: #D0BF8F;">)</span> 2 8<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; true</span>

<span style="color: #DCDCCC;">(</span>= <span style="color: #BFEBBF;">[</span>1 2 3<span style="color: #BFEBBF;">]</span> <span style="color: #BFEBBF;">(</span><span style="color: #D0BF8F;">(</span>flip take<span style="color: #D0BF8F;">)</span> <span style="color: #D0BF8F;">[</span>1 2 3 4 5<span style="color: #D0BF8F;">]</span> 3<span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; true</span>
</pre>
</div></li>

<li><p>
Napisati funkciju <code>b-tree?</code> koja proverava da li je neka
sekvenca binarno stablo.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>b-tree? <span style="color: #BFEBBF;">[</span>1 <span style="color: #D0BF8F;">[</span>2 <span style="color: #93E0E3;">[</span>3 <span style="color: #9FC59F;">[</span>4 <span style="color: #BFEBBF;">false</span> <span style="color: #BFEBBF;">nil</span><span style="color: #9FC59F;">]</span> <span style="color: #BFEBBF;">nil</span><span style="color: #93E0E3;">]</span> <span style="color: #BFEBBF;">nil</span><span style="color: #D0BF8F;">]</span> <span style="color: #BFEBBF;">nil</span><span style="color: #BFEBBF;">]</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; true</span>

<span style="color: #DCDCCC;">(</span>b-tree? '<span style="color: #BFEBBF;">(</span><span style="color: #BFEBBF;">:a</span> <span style="color: #BFEBBF;">nil</span> <span style="color: #D0BF8F;">()</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; false</span>

<span style="color: #DCDCCC;">(</span>b-tree? <span style="color: #BFEBBF;">[</span>1 <span style="color: #D0BF8F;">[</span>2 <span style="color: #BFEBBF;">nil</span> <span style="color: #BFEBBF;">nil</span><span style="color: #D0BF8F;">]</span> <span style="color: #D0BF8F;">[</span>3 <span style="color: #BFEBBF;">nil</span> <span style="color: #BFEBBF;">nil</span><span style="color: #D0BF8F;">]</span> <span style="color: #D0BF8F;">[</span>4 <span style="color: #BFEBBF;">nil</span> <span style="color: #BFEBBF;">nil</span><span style="color: #D0BF8F;">]</span><span style="color: #BFEBBF;">]</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; false</span>

<span style="color: #DCDCCC;">(</span>b-tree? '<span style="color: #BFEBBF;">(</span><span style="color: #BFEBBF;">:a</span> <span style="color: #D0BF8F;">(</span><span style="color: #BFEBBF;">:b</span> <span style="color: #BFEBBF;">nil</span> <span style="color: #BFEBBF;">nil</span><span style="color: #D0BF8F;">)</span> <span style="color: #BFEBBF;">nil</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; true</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">b-tree?</span>
  <span style="color: #9FC59F;">"Predicate that checks is s a binary tree or not."</span>
  <span style="color: #BFEBBF;">[</span>s<span style="color: #BFEBBF;">]</span>
  <span style="color: #BFEBBF;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #D0BF8F;">(</span>coll? s<span style="color: #D0BF8F;">)</span>
    <span style="color: #D0BF8F;">(</span><span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #93E0E3;">(</span>not= <span style="color: #9FC59F;">(</span>count s<span style="color: #9FC59F;">)</span> 3<span style="color: #93E0E3;">)</span>
      <span style="color: #BFEBBF;">false</span>
      <span style="color: #93E0E3;">(</span><span style="color: #F0DFAF; font-weight: bold;">and</span> <span style="color: #9FC59F;">(</span>b-tree? <span style="color: #94BFF3;">(</span>nth s 1<span style="color: #94BFF3;">)</span><span style="color: #9FC59F;">)</span> <span style="color: #9FC59F;">(</span>b-tree? <span style="color: #94BFF3;">(</span>nth s 2<span style="color: #94BFF3;">)</span><span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span>
    <span style="color: #BFEBBF;">true</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span>b-tree? <span style="color: #BFEBBF;">[</span>1 <span style="color: #D0BF8F;">[</span>2 <span style="color: #93E0E3;">[</span>3 <span style="color: #9FC59F;">[</span>4 <span style="color: #BFEBBF;">false</span> <span style="color: #BFEBBF;">nil</span><span style="color: #9FC59F;">]</span> <span style="color: #BFEBBF;">nil</span><span style="color: #93E0E3;">]</span> <span style="color: #BFEBBF;">nil</span><span style="color: #D0BF8F;">]</span> <span style="color: #BFEBBF;">nil</span><span style="color: #BFEBBF;">]</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; true</span>

<span style="color: #DCDCCC;">(</span>b-tree? '<span style="color: #BFEBBF;">(</span><span style="color: #BFEBBF;">:a</span> <span style="color: #BFEBBF;">nil</span> <span style="color: #D0BF8F;">()</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; false</span>

<span style="color: #DCDCCC;">(</span>b-tree? <span style="color: #BFEBBF;">[</span>1 <span style="color: #D0BF8F;">[</span>2 <span style="color: #BFEBBF;">nil</span> <span style="color: #BFEBBF;">nil</span><span style="color: #D0BF8F;">]</span> <span style="color: #D0BF8F;">[</span>3 <span style="color: #BFEBBF;">nil</span> <span style="color: #BFEBBF;">nil</span><span style="color: #D0BF8F;">]</span> <span style="color: #D0BF8F;">[</span>4 <span style="color: #BFEBBF;">nil</span> <span style="color: #BFEBBF;">nil</span><span style="color: #D0BF8F;">]</span><span style="color: #BFEBBF;">]</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; false</span>

<span style="color: #DCDCCC;">(</span>b-tree? '<span style="color: #BFEBBF;">(</span><span style="color: #BFEBBF;">:a</span> <span style="color: #D0BF8F;">(</span><span style="color: #BFEBBF;">:b</span> <span style="color: #BFEBBF;">nil</span> <span style="color: #BFEBBF;">nil</span><span style="color: #D0BF8F;">)</span> <span style="color: #BFEBBF;">nil</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; true</span>
</pre>
</div></li>

<li>Lepota je u simetriji. Napišite predikat <code>beauty-tree?</code> koji
proverava da li je binarno stablo simetrično. Stablo je
simetrično ako je svako levo podstablo odraz u ogledalu od
desnog podstabla.</li>
</ol>
</div>
</div>

<div id="outline-container-org06d479e" class="outline-3">
<h3 id="org06d479e"><span class="section-number-3">3.5</span> Kada je mutacija stvarno nezaobilazna</h3>
<div class="outline-text-3" id="text-3-5">
<p>
To što je Clojure <i>value oriented</i> ne znači da ne postoji način da
koristite mutabilna stanja već da kada ih koristite ona moraju biti
dobro izolovana i jedino na pravilan (konzistentan) način možete
njima rukovati. Clojure pruža nekoliko mehanizama za rukovanje
mutabilnim stanjem.
</p>
</div>

<div id="outline-container-org79e8272" class="outline-4">
<h4 id="org79e8272"><span class="section-number-4">3.5.1</span> Atomi</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
<i>Atomi</i> su prvi i najjednostavniji mehanizam za rukovanje
mutabilnim stanjem. Ideja je da se oni uposle kada imamo
<b>sinhrono</b>, <b>nekoordinisano</b> ili <b>nezavisano</b> korišćenje deljenih
resursa. Dakle, ako treba da baratamo samo jednim parčetom
mutabilnog stanja od jednom i drugih zahteva onda su Atomi prava
stvar za nas (i upravo to je i najčešće).
</p>

<p>
Do sada smo uvek kada govorimo o Clojure-u govorili o vrednostima
(a ne o promenljivom sadržaju), <i>atomi su definisani na malo
složeniji način</i>. Pošto nam treba da atomima predstavimo nešto što
se može menjati u vremenu i pošto Clojure ne dozvoljava mutabilne
strukture podataka jedini način da se implementiraju atomi je bio
&#x2014; <span class="underline">kao promenljive reference na imutabilne strukture</span>. Jedan
način kako se definiše atom je dat u nastavku:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">app-state</span> <span style="color: #BFEBBF;">(</span>atom <span style="color: #D0BF8F;">{}</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>
app-state
</pre>
</div>

<p>
Ovako smo napravili atom koji sadrži praznu perzistentnu -
<b>imutabilnu</b> mapu a čija je referenca sačuvana u <code>app-state</code>
(adresa mape je data heksadecimalno). Pošto ovako prazna naša mapa
nije baš korisna hajde da asociramo neke vrednosti unutar nje:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>doc swap!<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt;</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">-------------------------</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">clojure.core/swap!</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">([atom f] [atom f x] [atom f x y] [atom f x y &amp; args])</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Atomically swaps the value of atom to be:</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(apply f current-value-of-atom args). Note that f may be called</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">multiple times, and thus should be free of side effects.  Returns</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">the value that was swapped in.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">nil</span>

<span style="color: #DCDCCC;">(</span>swap! app-state assoc <span style="color: #BFEBBF;">:current-user</span> <span style="color: #CC9393;">"Mile"</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; #atom[{</span><span style="color: #7F9F7F;">:current-user</span><span style="color: #7F9F7F;"> "Mile"} 0x18a5b107]</span>

<span style="color: #DCDCCC;">(</span>swap! app-state assoc <span style="color: #BFEBBF;">:session-id</span> <span style="color: #CC9393;">"873649203"</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; #atom[{</span><span style="color: #7F9F7F;">:current-user</span><span style="color: #7F9F7F;"> "Mile", </span><span style="color: #7F9F7F;">:session-id</span><span style="color: #7F9F7F;"> "873649203"} 0x18a5b107]</span>
</pre>
</div>

<p>
Dakle, funkcija <code>swap!</code> <b>zamenjuje</b> vrednost na kuju pokazuje
<code>app-state</code> za neku drugu vrednost koja je rezultat primene
funkcije <code>assoc</code> na onu vrednost na koju trenutno pokazuje
<code>app-state</code> i ostale argumente. Naravno, umesto <code>assoc</code> funkcije
se može koristiti bilo koja druga.
</p>

<p>
Ako samo želimo da <b>zamenimo</b> vrednost na koju trenutno pokazuje
<code>app-state</code> sa nekom drugom vrednošću za to možemo koristiti
funkciju <code>reset!</code>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>reset! app-state <span style="color: #BFEBBF;">{}</span><span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; #atom[{} 0x18a5b107]</span>
</pre>
</div>

<p>
Sada kada znamo kako da sačuvamo deljeno stanje u okviru atoma
pitanje je &#x2014; kako da ga pročitamo odatle? Operacija čitanja se u
ovom kontekstu zove <b>dereferenciranje</b> i radi se funkcijom <code>deref</code>
ili <code>@</code> <i>reader macro</i>-om:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span>swap! app-state assoc <span style="color: #BFEBBF;">:current-user</span> <span style="color: #CC9393;">"Pera"</span> <span style="color: #BFEBBF;">:session-id</span> <span style="color: #CC9393;">"98374374"</span><span style="color: #DCDCCC;">)</span>
@app-state
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; {</span><span style="color: #7F9F7F;">:current-user</span><span style="color: #7F9F7F;"> "Pera", </span><span style="color: #7F9F7F;">:session-id</span><span style="color: #7F9F7F;"> "98374374"}</span>
<span style="color: #DCDCCC;">(</span><span style="color: #BFEBBF;">:current-user</span> @app-state<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; "Pera"</span>
<span style="color: #DCDCCC;">(</span><span style="color: #BFEBBF;">:session-id</span> @app-state<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; 98374374</span>
<span style="color: #DCDCCC;">(</span><span style="color: #BFEBBF;">:foo</span> @app-state<span style="color: #DCDCCC;">)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; nil</span>
</pre>
</div>

<p>
Ovaj vrlo prost i intuitivan mehanizam nas spašava pisanje
eksplicitnih zaključavanja i daje nam veoma čist - funkcionalni
API za rukovanje deljenim stanjem.
</p>

<p>
Prokomentarišite rezultate ispod.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">state</span> <span style="color: #BFEBBF;">(</span>atom <span style="color: #D0BF8F;">{</span><span style="color: #BFEBBF;">:account</span> 200<span style="color: #D0BF8F;">}</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">multit</span> <span style="color: #BFEBBF;">[]</span>
  <span style="color: #BFEBBF;">(</span>future <span style="color: #D0BF8F;">(</span>swap! state update-in <span style="color: #93E0E3;">[</span><span style="color: #BFEBBF;">:account</span><span style="color: #93E0E3;">]</span>
                 <span style="color: #93E0E3;">(</span><span style="color: #F0DFAF; font-weight: bold;">do</span>
                   <span style="color: #9FC59F;">(</span>println <span style="color: #CC9393;">"Negotiations start..."</span><span style="color: #9FC59F;">)</span>
                   <span style="color: #9FC59F;">(</span><span style="color: #7CB8BB;">Thread</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>sleep 10000<span style="color: #9FC59F;">)</span>
                   <span style="color: #9FC59F;">(</span>println <span style="color: #CC9393;">"They're ready to pay!"</span><span style="color: #9FC59F;">)</span>
                   <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">They decided to support our budget by 50%</span>
                   #<span style="color: #9FC59F;">(</span>+ <span style="color: #DFAF8F;">%</span> <span style="color: #94BFF3;">(</span>* <span style="color: #DFAF8F;">%</span> 0.5<span style="color: #94BFF3;">)</span><span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span>
  <span style="color: #BFEBBF;">(</span>future <span style="color: #D0BF8F;">(</span>swap! state update-in <span style="color: #93E0E3;">[</span><span style="color: #BFEBBF;">:account</span><span style="color: #93E0E3;">]</span> <span style="color: #93E0E3;">(</span><span style="color: #F0DFAF; font-weight: bold;">do</span>
                                              <span style="color: #9FC59F;">(</span><span style="color: #7CB8BB;">Thread</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>sleep 800<span style="color: #9FC59F;">)</span>
                                              <span style="color: #9FC59F;">(</span>println <span style="color: #CC9393;">"We have to pay taxes."</span><span style="color: #9FC59F;">)</span>
                                              #<span style="color: #9FC59F;">(</span>- <span style="color: #DFAF8F;">%</span> 180<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">@state</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">=&gt; {</span><span style="color: #7F9F7F;">:account</span><span style="color: #7F9F7F;"> 200}</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(multit)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Negotiations start...</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">#future[{</span><span style="color: #7F9F7F;">:status</span><span style="color: #7F9F7F;"> </span><span style="color: #7F9F7F;">:pending</span><span style="color: #7F9F7F;">, </span><span style="color: #7F9F7F;">:val</span><span style="color: #7F9F7F;"> nil} 0x499ef740]</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">We have to pay taxes.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">@state</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">{</span><span style="color: #7F9F7F;">:account</span><span style="color: #7F9F7F;"> 20}</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">They're ready to pay!</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">@state</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">{</span><span style="color: #7F9F7F;">:account</span><span style="color: #7F9F7F;"> 30.0}</span>

<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">multit-2</span> <span style="color: #BFEBBF;">[]</span>
  <span style="color: #BFEBBF;">(</span>future <span style="color: #D0BF8F;">(</span>swap! state update-in <span style="color: #93E0E3;">[</span><span style="color: #BFEBBF;">:account</span><span style="color: #93E0E3;">]</span>
                 <span style="color: #93E0E3;">(</span><span style="color: #F0DFAF; font-weight: bold;">do</span>
                   <span style="color: #9FC59F;">(</span>println <span style="color: #CC9393;">"Negotiations start..."</span><span style="color: #9FC59F;">)</span>
                   <span style="color: #9FC59F;">(</span><span style="color: #7CB8BB;">Thread</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>sleep 10000<span style="color: #9FC59F;">)</span>
                   <span style="color: #9FC59F;">(</span>println <span style="color: #CC9393;">"They're ready to pay!"</span><span style="color: #9FC59F;">)</span>
                   <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">They decided to support our budget by 50%</span>
                   #<span style="color: #9FC59F;">(</span>+ <span style="color: #DFAF8F;">%</span> <span style="color: #94BFF3;">(</span>* <span style="color: #DFAF8F;">%</span> 0.5<span style="color: #94BFF3;">)</span><span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span>
  <span style="color: #BFEBBF;">(</span>future <span style="color: #D0BF8F;">(</span>swap! state update-in <span style="color: #93E0E3;">[</span><span style="color: #BFEBBF;">:account</span><span style="color: #93E0E3;">]</span> <span style="color: #93E0E3;">(</span><span style="color: #F0DFAF; font-weight: bold;">do</span>
                                              <span style="color: #9FC59F;">(</span>println <span style="color: #CC9393;">"We negotiate about taxes</span><span style="color: #DC8CC3; background-color: #3F3F3F;">..."</span><span style="color: #9FC59F; background-color: #3F3F3F;">)</span>
                                              <span style="color: #9FC59F;">(</span><span style="color: #7CB8BB;">Thread</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>sleep 15000<span style="color: #9FC59F;">)</span>
                                              <span style="color: #9FC59F;">(</span>println <span style="color: #CC9393;">"We have to pay taxes."</span><span style="color: #9FC59F;">)</span>
                                              #<span style="color: #9FC59F;">(</span>- <span style="color: #DFAF8F;">%</span> 180<span style="color: #9FC59F;">)</span><span style="color: #93E0E3;">)</span><span style="color: #D0BF8F;">)</span><span style="color: #BFEBBF;">)</span><span style="color: #DCDCCC;">)</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">@state</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">{</span><span style="color: #7F9F7F;">:account</span><span style="color: #7F9F7F;"> 200}</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">(multit-2)</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Negotiations start...</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">We negotiate about taxes...</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">#future[{</span><span style="color: #7F9F7F;">:status</span><span style="color: #7F9F7F;"> </span><span style="color: #7F9F7F;">:pending</span><span style="color: #7F9F7F;">, </span><span style="color: #7F9F7F;">:val</span><span style="color: #7F9F7F;"> nil} 0x1ec207bd]</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">They're ready to pay!</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">@state</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">{</span><span style="color: #7F9F7F;">:account</span><span style="color: #7F9F7F;"> 300.0}</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">We have to pay taxes.</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">@state</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">{</span><span style="color: #7F9F7F;">:account</span><span style="color: #7F9F7F;"> 120.0}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org001250b" class="outline-3">
<h3 id="org001250b"><span class="section-number-3">3.6</span> Clojure u standardnim OO problemima</h3>
</div>
<div id="outline-container-orgda71909" class="outline-3">
<h3 id="orgda71909"><span class="section-number-3">3.7</span> Perzistentne strukture podataka</h3>
</div>
</div>

<div id="outline-container-org2d57d33" class="outline-2">
<h2 id="org2d57d33"><span class="section-number-2">4</span> Read, evaluate vrtlog i makroi</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-org30fd61e" class="outline-3">
<h3 id="org30fd61e"><span class="section-number-3">4.1</span> <i>Homoiconicy</i> &#x2014; "istoizglednost"</h3>
<div class="outline-text-3" id="text-4-1">

<div class="figure">
<p><img src="images/franca_homoiconicy_clojure.jpg" alt="franca_homoiconicy_clojure.jpg" width="700" />
</p>
<p><span class="figure-number">Figure 4: </span><a href="https://twitter.com/franschm">@franschm</a></p>
</div>

<p>
Primetimo da u jezicima koji nisu <i>homoikonični</i> važi pravilo:
</p>

<p>
<b>Kod je Kralj, podaci se zamišljaju.</b>
</p>

<p>
Dok kod jezika koji su <i>homoikonični</i> situacija nije tako
striktna. Kod u koji gledamo su zapravo podaci, ne moramo da ih
zamišljamo.
</p>
</div>
</div>
</div>

<div id="outline-container-orga775e59" class="outline-2">
<h2 id="orga775e59"><span class="section-number-2">5</span> Konkurentno i paralelno programiranje</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-org27352ff" class="outline-3">
<h3 id="org27352ff"><span class="section-number-3">5.1</span> Reference</h3>
</div>

<div id="outline-container-org87ff076" class="outline-3">
<h3 id="org87ff076"><span class="section-number-3">5.2</span> core.async</h3>
</div>
</div>

<div id="outline-container-org40ddf79" class="outline-2">
<h2 id="org40ddf79"><span class="section-number-2">6</span> Interakcija sa platformom</h2>
</div>

<div id="outline-container-org5ebecf4" class="outline-2">
<h2 id="org5ebecf4"><span class="section-number-2">7</span> Apstrakcije</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-org0c1627f" class="outline-3">
<h3 id="org0c1627f"><span class="section-number-3">7.1</span> Multimethods</h3>
</div>

<div id="outline-container-orgc7f96d6" class="outline-3">
<h3 id="orgc7f96d6"><span class="section-number-3">7.2</span> Protocols</h3>
</div>

<div id="outline-container-orgf709161" class="outline-3">
<h3 id="orgf709161"><span class="section-number-3">7.3</span> Records</h3>
</div>

<div id="outline-container-org1c76b8c" class="outline-3">
<h3 id="org1c76b8c"><span class="section-number-3">7.4</span> clojure.spec</h3>
</div>
</div>

<div id="outline-container-org833b1f7" class="outline-2">
<h2 id="org833b1f7"><span class="section-number-2">8</span> ClojureScript</h2>
</div>

<div id="outline-container-orgaac04c2" class="outline-2">
<h2 id="orgaac04c2"><span class="section-number-2">9</span> Reader conditionals (.cljc)</h2>
</div>

<div id="outline-container-orga6aac1c" class="outline-2">
<h2 id="orga6aac1c"><span class="section-number-2">10</span> ClojureCLR</h2>
</div>

<div id="outline-container-orga1a6de1" class="outline-2">
<h2 id="orga1a6de1"><span class="section-number-2">11</span> Literatura</h2>
<div class="outline-text-2" id="text-11">
<ul class="org-ul">
<li><a href="http://www.braveclojure.com/">Clojure For The Brave and True</a> &#x2014; Daniel Higginbotham</li>
<li>Professional Clojure &#x2014; Anderson, Gaare, Holguin, Bailey, Pratley</li>
<li>Web Development with Clojure 2nd Edition &#x2014; Dmitri Sotnikov</li>
<li><a href="http://deptinfo.unice.fr/~roy/sicp.pdf">Structure and Interpretation of Computer Programs</a> &#x2014; Harold
Abelson, Gerald Jay Sussman with Julie Sussman (sa video
<a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-001-structure-and-interpretation-of-computer-programs-spring-2005/video-lectures/">predavanjima</a> na YouTube-u)</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Novak Boškov</p>
<p class="date">Created: 2017-04-25 уто 17:28</p>
<p class="validation"></p>
</div>
</body>
</html>
