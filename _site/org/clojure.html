<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="sr" xml:lang="sr">
<head>
<!-- 2018-04-26 Thu 16:09 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Napredne tehnike programiranja - Clojure</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Novak BoÅ¡kov" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Napredne tehnike programiranja - Clojure</h1>
<div id="table-of-contents">
<h2>Sadr&#382;aj</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6a3d4e7">1. Uvod</a>
<ul>
<li><a href="#org2e7c8ec">1.1. Lisp</a>
<ul>
<li><a href="#org573d416">1.1.1. Scheme</a></li>
</ul>
</li>
<li><a href="#org5c5927b">1.2. Clojure - funkcionalni naÄin razmiÅ¡ljanja</a></li>
<li><a href="#org2c2032b">1.3. Imperativno vs funckionalno programiranje</a></li>
<li><a href="#org3bbf4a1">1.4. Clojure kao <i>value oriented</i> jezik</a></li>
<li><a href="#orgd2a6aed">1.5. Referencijalna transparentnost i memoizacija</a></li>
<li><a href="#org8c6d22f">1.6. Misliti rekurzivno</a></li>
</ul>
</li>
<li><a href="#org8941d1d">2. REPL i IDE</a>
<ul>
<li><a href="#org9478164">2.1. <i>Build tools</i> - alati za izgradnju</a></li>
<li><a href="#orgd646d0e">2.2. <i>IDE</i> - integrisana razvojna okruÅ¾enja</a></li>
</ul>
</li>
<li><a href="#org73a1e73">3. Elementi jezika</a>
<ul>
<li><a href="#org94e9190">3.1. Funkcije viÅ¡eg reda</a>
<ul>
<li><a href="#orgc755c2a">3.1.1. Parcijalne funkcije</a></li>
</ul>
</li>
<li><a href="#org1b7a09f">3.2. Kompozicija funkcija</a></li>
<li><a href="#orgd7e2499">3.3. Clojure naglaÅ¡ava svoju lenjost</a></li>
<li><a href="#org43276ef">3.4. VeÅ¾banje 1</a></li>
<li><a href="#org9248b0f">3.5. Kada je mutacija stvarno nezaobilazna</a>
<ul>
<li><a href="#org8057ad1">3.5.1. Atom</a></li>
<li><a href="#orga485bfd">3.5.2. Ref</a></li>
</ul>
</li>
<li><a href="#org1ab0869">3.6. Perzistentne strukture podataka</a></li>
<li><a href="#org3c3e50f">3.7. Clojure u standardnim OO problemima</a></li>
</ul>
</li>
<li><a href="#org3cb455c">4. Read, evaluate vrtlog i makroi</a>
<ul>
<li><a href="#org2ab0932">4.1. <i>Evaluation Model</i> Clojure-a</a></li>
<li><a href="#orgacf3735">4.2. Neki poznati <i>reader</i> makroi</a></li>
<li><a href="#org226b23d">4.3. <i>Homoiconicity</i> &#x2014; "istoizglednost"</a></li>
<li><a href="#orgc73fafc">4.4. NavoÄenje sintakse &#x2014; <i>syntax quoting</i></a></li>
<li><a href="#org43670df">4.5. Reader conditionals (.cljc)</a></li>
<li><a href="#orgc3dc549">4.6. VeÅ¾banje 2</a></li>
</ul>
</li>
<li><a href="#org154433d">5. Konkurentno i paralelno programiranje</a>
<ul>
<li><a href="#orgfe236de">5.1. Reference</a></li>
<li><a href="#org7daac66">5.2. core.async</a></li>
</ul>
</li>
<li><a href="#orgd4d2964">6. Interakcija sa platformom</a></li>
<li><a href="#org63f8201">7. Apstrakcije</a>
<ul>
<li><a href="#org0a31aff">7.1. Multimethods</a></li>
<li><a href="#org752e564">7.2. Protocols</a></li>
<li><a href="#org4e803c7">7.3. Records</a></li>
<li><a href="#org64ae815">7.4. clojure.spec</a>
<ul>
<li><a href="#org6b09df9">7.4.1. Validatori za mape</a></li>
<li><a href="#org7cf25cd">7.4.2. Validatori za kolekcije</a></li>
<li><a href="#org6debe00">7.4.3. Validatori za sekvence</a></li>
<li><a href="#org3ca5941">7.4.4. Validiranje funkcija</a></li>
<li><a href="#org4c322ba">7.4.5. Generativno testiranje <code>test-check</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8c6bf28">8. ClojureScript</a></li>
<li><a href="#org9e1112f">9. Literatura</a></li>
</ul>
</div>
</div>

<div class="figure">
<p><img src="images/clojure_logo.png" alt="clojure_logo.png" />
</p>
</div>

<blockquote>
<p>
Clojure is a dynamic, general-purpose programming language, combining
the approachability and interactive development of a scripting
language with an efficient and robust infrastructure for multithreaded
programming. Clojure is a compiled language, yet remains completely
dynamic â every feature supported by Clojure is supported at
runtime. Clojure provides easy access to the Java frameworks, with
optional type hints and type inference, to ensure that calls to Java
can avoid reflection.
</p>

<p>
Clojure is a dialect of Lisp, and shares with Lisp the code-as-data
philosophy and a powerful macro system. Clojure is predominantly a
functional programming language, and features a rich set of immutable,
persistent data structures. When mutable state is needed, Clojure
offers a software transactional memory system and reactive Agent
system that ensure clean, correct, multithreaded designs.
</p>

<p>
&#x2013; Rich Hickey (author of Clojure)
</p>
</blockquote>

<div id="outline-container-org6a3d4e7" class="outline-2">
<h2 id="org6a3d4e7"><span class="section-number-2">1</span> Uvod</h2>
<div class="outline-text-2" id="text-1">
<blockquote>
<p>
If your mind is empty, it is always ready for anything, it is open to
everything. In the beginner's mind there are many possibilities, but
in the expert's mind there are few.
</p>

<p>
&#x2013; Shunryu Suzuki
</p>
</blockquote>
</div>

<div id="outline-container-org2e7c8ec" class="outline-3">
<h3 id="org2e7c8ec"><span class="section-number-3">1.1</span> Lisp</h3>
<div class="outline-text-3" id="text-1-1">
<p>
<b>Lisp</b> ili <b>LISP</b> je porodica programskih jezika sa dugom
istorijom. Na prvi pogled ga karakteriÅ¡e prefiksna notacija i
izrazi u zagradama. Prvobitno je specificiran 1956. godine od
strane <a href="https://en.wikipedia.org/wiki/John_McCarthy_(computer_scientist)">John McCarthy</a>-a za potrebe njegovih istraÅ¾ivanja u oblasti
veÅ¡taÄke inteligencije (<i>McCarthy</i> je inaÄe i smislio naziv
<i>artificial intelligence</i> - <i>AI</i>). Lisp je drugi najstariji
programski jezik visokog nivoa, samo je <i>Fortran</i> jednu godinu
stariji, a poreÄenja radi:
</p>
<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/C_(programming_language)">C</a> se pojavio 1972.</li>
<li><a href="https://en.wikipedia.org/wiki/C%2B%2B">C++</a> 1983.</li>
<li><a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> 1991 (kada i <a href="https://en.wikipedia.org/wiki/Visual_Basic">Visual Basic</a>).</li>
<li><a href="https://en.wikipedia.org/wiki/Java_(programming_language)">Java</a> 1995.</li>
<li><a href="https://en.wikipedia.org/wiki/C_Sharp_(programming_language)">C#</a> 2000.</li>
</ul>

<p>
Lisp je konstruisan kao matematiÄka notacija za kompjuterske
programe inspirisana <a href="https://en.wikipedia.org/wiki/Lambda_calculus">Lambda raÄunom</a>(<a href="https://en.wikipedia.org/wiki/Alonzo_Church">Alonzo Church</a>). Ovaj naÄin
predstave programa doneo je mnoge ideje u kompjuterske nauke:
</p>
<ul class="org-ul">
<li>strukture tipa stabla</li>
<li>automatsko upravljanje memorijom (garbage collector)</li>
<li><i>dynamic typing</i></li>
<li>kondicionale (grananje)</li>
<li>funkcije viÅ¡eg reda</li>
<li>rekurziju i rekurzivan opis podataka</li>
<li>self-hosting kompajler</li>
<li>REPL itd.</li>
</ul>

<p>
Veliki broj navedenih stvari inspirisao je programske jezike koji
su nastali nakon Lisp-a (tj. skoro sve programske jezike) ali neki
od korisnih koncepata iz Lisp-a se i dan dans smatraju naprednim i
joÅ¡ uvek nisu podrÅ¾ani u pojedinim jezicima koji se intenzivno
koriste.
</p>

<p>
MatematiÄku formulaciju Lisp-a i koncepata koje ona donosi nadalje
pogledajte <a href="../resources/perzistencija_clojure.pdf">ovde</a> (poglavlja 1.1, 1.2 i 1.3).
</p>

<p>
Pored <i>Clojure</i> dijalekta kojim Äemo se baviti na ovom kursu tu je
joÅ¡ pregrÅ¡t drugih dijalekata sa raznim osobinama:
</p>

<ul class="org-ul">
<li><a href="https://common-lisp.net/">Commnon Lisp</a></li>
<li><a href="https://en.wikipedia.org/wiki/Scheme_(programming_language)">Scheme</a></li>
<li><a href="https://www.gnu.org/software/emacs/">Emacs Lisp</a></li>
<li><a href="https://en.wikipedia.org/wiki/AutoLISP">AutoLisp</a></li>
<li><a href="http://www.paulgraham.com/arc.html">Arc</a></li>
<li><a href="http://lfe.io/">Lisp Flovered Erlang</a>
&#x2026;</li>
</ul>
</div>

<div id="outline-container-org573d416" class="outline-4">
<h4 id="org573d416"><span class="section-number-4">1.1.1</span> Scheme</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
<b>Scheme</b> je jedan od najznaÄajnijih dijalekata Lisp-a. Dizajniran
je od poÄetka sa idejom funkcionalnog programiranja i minimalizma
sa veoma moÄnim mehanizmima za proÅ¡irenje jezika. Prvi je
dijalekat koji usled naglaÅ¡avanja funkcionalnog programiranja
uvodi <a href="https://en.wikipedia.org/wiki/Tail_call">tail call optimizaciju</a>. TakoÄe jedan je od prvih programskih
jezika koji imaju podrÅ¾anu <a href="https://en.wikipedia.org/wiki/Continuation">kontinuaciju</a>.
</p>

<p>
Neke od "biblija" raÄunarske nauke su kao jezik-primer uzimale
upravo Scheme. Jedna, vrlo znaÄajna, takva knjiga je i <a href="http://deptinfo.unice.fr/~roy/sicp.pdf">Structure
and Interpretation of Computer Programs</a>.
</p>

<p>
Postoji mnogo raznih dijalekata Scheme-a a ovde Äe biti navedena
samo dva.
</p>
</div>

<ol class="org-ol">
<li><a id="orgca4ae04"></a>Chez Scheme (Cisco)<br />
<div class="outline-text-5" id="text-1-1-1-1">
<p>
<a href="https://github.com/cisco/ChezScheme"><b>Chez</b></a> je <a href="http://www.r6rs.org/">Scheme implementacija</a> zajedno sa (moÄnim) kompajlerom,
<i>run time</i> sistemom i bibliotekama. Koristi je kompanije Cisco a
od skoro je <i>open source</i>.
</p>

<p>
Ako danas Å¾elite da probate Scheme da njime reÅ¡ite problem na
kome radite a fokus Vam je na performansama, IO, konkurentnom
programiranju ili Vam treba dobra moguÄnost koriÅ¡Äenja postojeÄih
C biblioteka onda nije loÅ¡e da poÄnete sa <b>Chez</b>-om.
</p>
</div>
</li>

<li><a id="org62f3eaa"></a>Racket lang<br />
<div class="outline-text-5" id="text-1-1-1-2">
<p>
<a href="https://racket-lang.org/">Racket lang</a> je takoÄe implementacija Schema-a ali sa potpuno
drugim ciljevima pri dizajnu. Racket je po svom dizajnu sistem za
pravljenje programskih jezika (i/ili <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>-ova). Ima veoma dobar
ekosistem biblioteka (u formi jezika) za razne standardne (WEB
serveri, GUI &#x2026;) i manje standardne zadatke. Sve njegove
biblioteke su veoma dobro dokumentovane. Racket ima i svoje
razvojno okruÅ¾enje (<i>IDE</i>) DrRacket koje sadrÅ¾i sve na Å¡ta ste
navikli od jednog <i>IDE</i>-a (ukljuÄujuÄi i grafiÄki
<i>debugger</i>). Ako je dizajn DSL-ova naÄin na koji razmiÅ¡ljate pri
reÅ¡avanju problema onda Äe Racket lang i njegovo okruÅ¾enje biti
odliÄno druÅ¡tvo od kojeg moÅ¾ete mnogo da nauÄite.
</p>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org5c5927b" class="outline-3">
<h3 id="org5c5927b"><span class="section-number-3">1.2</span> Clojure - funkcionalni naÄin razmiÅ¡ljanja</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Danas postoji mnogo programskih jezika i zaista se (pre)veliki deo
njih meÄusobno razlikuje skoro iskljuÄivo po sintaksi. Tako da
danas nije nikakav problem nazivati se <b>polyglot</b> programerom -
samo nauÄite par sintaktiÄkih pravila i <i>Voila!</i> znate joÅ¡ jedan
programski jezik (nezaboravite da osveÅ¾ite svoj CV).
</p>

<p>
<b>Clojure</b> ipak nije jedan od jezika koji se poÄetniku Äini od
ranije poznatim. Äak ni na prvi pogled (za Å¡ta je zasluÅ¾na
<i>S-expression</i> prefiksna notacija). Stoga, kako biste ga nauÄili
morate primeniti neku drugu strategiju u odnosu na onu navedenu
iznad.
</p>

<p>
Evo jednog predloÅ¾enog pristupa:
</p>

<blockquote>
<p>
Zaboravite sve Å¡to znate o programiranju. <b>Pristupite uÄenju
Clojure-a kao da Vam je to prvi programski jezik</b> . U suprotnom
Äete Clojure shvatiti samo kao <i>prefiksnu notaciju sa zagradama
koja Vam ne dozvoljava da piÅ¡ete kod onako kako ste navikli!</i>
</p>

<p>
<b>Umesto da pokuÅ¡avate svoje znanje od ranije da preslikate na</b>
<b>Clojure, dozvolite ovom Lispu da obogati naÄin na koji piÅ¡ete</b>
<b>ostale programske jezike.</b>
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org2c2032b" class="outline-3">
<h3 id="org2c2032b"><span class="section-number-3">1.3</span> Imperativno vs funckionalno programiranje</h3>
<div class="outline-text-3" id="text-1-3">
<p>
C, C++, C#, Java, Python svi ovi (i drugi) programski jezici imaju
veoma sliÄnu sintaksu i svi koriste veoma sliÄne programske
konstrukcije sa akcentom na imperativno programiranje.
</p>

<blockquote>
<p>
U kompjuterskoj nauci imperativno programiranje je paradigma
programiranja koja koristi naredbe u cilju menjanja stanja
programa.
</p>
</blockquote>

<p>
Ova paradigma programiranja se savrÅ¡eno uklapa u <a href="https://en.wikipedia.org/wiki/Von_Neumann_architecture">von Neumann-ov</a>
model izraÄunavanja na raÄunaru. TaÄnije, ona je dizajnirana kako
bi oslikala pomenuti model izraÄunavanja.
</p>

<p>
Na primer, C je dominirao softverom veliki broj godina jer se
odliÄno uklapa u ovu dominantnu paradigmu hardverske
arhitekture. Programi napisani u C-u su veoma efikasni i u stanju
su da vrÅ¡e veoma efikasno upravljanje memorijom koja je <i>do skora</i>
bila veliki problem. Ova efikasnost je plaÄena cenom izraÅ¾enom u
kompleksnijoj semantici i sintaksi samog jezika pa sa porastom
programskog koda dramatiÄno opada sposobnost programera da
iskontroliÅ¡e konstruktorsku kompleksnost Å¡to dovodi do ÄeÅ¡Äih
defekata u radu programa (<b>program radi brzo ali ne i ono Å¡to
Å¾elimo &#x2014; korektno</b>). Ova kompleksnost potiÄe od toga Å¡to kod
imperativnog programiranja posao koji naredbe obavljaju snaÅ¾no
zavisi od stanja memorije u tom momentu. To Äini <b>konkurentno</b>
programiranje veoma komplikovanim i stoga podloÅ¾nim greÅ¡kama.
</p>

<blockquote>
<p>
Danas kada je memorija veoma brza i jeftina a kada viÅ¡eprocesorske
arhitekture svi nosimo u dÅ¾epovima ili pametnim satovima
imperativno programiranje poÄinje da pokazuje ozbiljne znake
starenja.
</p>
</blockquote>

<p>
Funkcionalno programiranje se zasniva viÅ¡e na stabilnim
matematiÄkim konceptima nego na bilo kom modelu izraÄunavanja na
maÅ¡ini. Clojure kao funkcionalan programski jezik ima snaÅ¾an fokus
na <a href="https://en.wikipedia.org/wiki/Immutable_object">nepromenljivosti podataka</a> (u daljem tekstu imutabilnost). To mu
omoguÄava veoma Äiste i jednostavne apstrakcije za konkurentno
programiranje koje su svakako korektnije i manje podloÅ¾no greÅ¡kama
od eksplicitnog zakljuÄavanja delova memorije na koje smo usmereni
u imperativnom programiranju.
</p>

<p>
Clojure (kao Lisp) je zapravo zasnovan na jednom veoma konciznom
matematiÄkom modelu kakav je Lambda raÄun pa tako i njegova
sintaksa barata sa svega nekoliko raznih konstrukcija Å¡to je Äini
veoma prostom. <i>UviÄanje ove jednostavnosti dolazi uz malo veÅ¾be.</i>
</p>
</div>
</div>

<div id="outline-container-org3bbf4a1" class="outline-3">
<h3 id="org3bbf4a1"><span class="section-number-3">1.4</span> Clojure kao <i>value oriented</i> jezik</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Clojure promoviÅ¡e stil programiranja koji se zove <i>value-oriented
programming</i> i nije jedini jezik koji to radi. <b>Rich Hickey</b> je
ovaj koncept vrlo lepo objasnio u svom <a href="https://www.youtube.com/watch?v=-6BsiVyC1kM">izlaganju</a> na <i>Jax
Conf</i>-u 2012. godine.
</p>

<p>
Ideja je da se programer koncentriÅ¡e na vrednosti u njegovom
programu a ne na mutabilne objekte i njihovo stanje (objekti se
smatraju tankom apstrakcijom oko "gole" memorije). Ovo je veoma
moÄan koncept jer kada prestanete da razmiÅ¡ljate o objektima i
memoriji onda konkurentno programiranje postaje manje-viÅ¡e
trivijalan posao.
</p>

<p>
U objektno orijentisanom programiranju takoÄe imamo potrebu i za
skrivanjem informacija (<i>information hiding</i>) i ograniÄavanjem
pristupa delovima objekta kroz <i>enkapsulaciju</i>. Clojure otklanja tu
potrebu jer barata samim vrednostima, podaci su <b>semantiÄki
transparentni</b>. Ovaj nivo transparentnosti omoguÄava bolju osnovu
za rezonovanje o kodu. UproÅ¡Äavanje kompleksnih funkcija <b>uvek</b>
moÅ¾e biti izvedeno prostom supstitucijom. Evo jednog naivnog
primera koji to ilustruje:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">square</span> <span style="color: #6c3163;">[</span>a<span style="color: #6c3163;">]</span> <span style="color: #6c3163;">(</span>* a a<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">sum-of-squares</span> <span style="color: #6c3163;">[</span>a b<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>+ <span style="color: #2d9574;">(</span>square a<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span>square b<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>= <span style="color: #6c3163;">(</span>sum-of-squares 2 5<span style="color: #6c3163;">)</span>
   <span style="color: #6c3163;">(</span>+ <span style="color: #2d9574;">(</span>square 2<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span>square 5<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
   <span style="color: #6c3163;">(</span>+ 4 25<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2a6aed" class="outline-3">
<h3 id="orgd2a6aed"><span class="section-number-3">1.5</span> Referencijalna transparentnost i memoizacija</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Funkcije za koje uvek po njihovim parametrima moÅ¾ete da kaÅ¾ete sa
Äim bi ste ih zamenili su <a href="https://en.wikipedia.org/wiki/Referential_transparency">referencijalno transparentne</a>. Da li su
funkcije koje piÅ¡ete u matematici referencijalno transparentne? Da
li je \(x^2\) uvek isto za isto \(x\)?
</p>

<p>
<b>Ako je kvadrat broja 4323 uvek 18688329 da li ga ima smisla uvek
iznova raÄunati?</b>
</p>

<p>
Optimizaciona tehnika koja nam omoguÄuje da programski jezik
zapamti vrednosti referencijalno transparentnih funkcija za
parametre zove se <a href="https://en.wikipedia.org/wiki/Memoization">memoizacija</a>.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">fib</span> <span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span>
    <span style="color: #2d9574;">(</span>= n 0<span style="color: #2d9574;">)</span> 0
    <span style="color: #2d9574;">(</span>= n 1<span style="color: #2d9574;">)</span> 1
    <span style="color: #4e3163;">:else</span> <span style="color: #2d9574;">(</span>+ <span style="color: #67b11d;">(</span>fib <span style="color: #b1951d;">(</span>- n 1<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
             <span style="color: #67b11d;">(</span>fib <span style="color: #b1951d;">(</span>- n 2<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">memo-fib</span> <span style="color: #6c3163;">(</span>memoize fib<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>time <span style="color: #6c3163;">(</span>fib 23<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">"Elapsed time: 30.039186 msecs"</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">28657</span>

<span style="color: #3a81c3;">(</span>time <span style="color: #6c3163;">(</span>memo-fib 23<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">"Elapsed time: 23.083033 msecs"</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">28657</span>

<span style="color: #3a81c3;">(</span>time <span style="color: #6c3163;">(</span>memo-fib 23<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">"Elapsed time: 0.246522 msecs"</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">28657</span>

<span style="color: #3a81c3;">(</span>doc memoize<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/memoize</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([f])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns a memoized version of a referentially transparent function. The</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">memoized version of the function keeps a cache of the mapping from arguments</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">to results and, when calls with the same arguments are repeated often, has</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">higher performance at the expense of higher memory use.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>
</pre>
</div>

<p>
Kada se memoizovana funkcija poziva prvi put ona troÅ¡i vreme kao i
njena obiÄna verzija ali se svaki sledeÄi put kada bude pozvana
<b>uÅ¡tedi jedno vreme izvrÅ¡avanja</b>.
</p>
</div>
</div>

<div id="outline-container-org8c6d22f" class="outline-3">
<h3 id="org8c6d22f"><span class="section-number-3">1.6</span> Misliti rekurzivno</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Iz razloga koji su opisani <a href="#org2c2032b">ranije</a> imperativni programski jezici ne
stavljaju previÅ¡e akcenat na rekurziju. Funcionalno programiranje
rekurziju koristi kao osnovni alat. Tamo gde imperativno
programiranje koristi petlje funkcionalno programiranje koristi
razne vidove rekurzije.
</p>

<blockquote>
<p>
Rekurzija je kada reÅ¡enje problem opisujete reÅ¡avanjem manje
porcije tog istog problema.
</p>

<p>
Rekurzija je jedna od centralnih ideja kompjuterske nauke.
</p>
</blockquote>


<div class="figure">
<p><img src="images/First_matryoshka_museum_doll_open.jpg" alt="First_matryoshka_museum_doll_open.jpg" />
</p>
</div>


<div class="figure">
<p><img src="images/RecursiveTree.jpg" alt="RecursiveTree.jpg" />
</p>
</div>

<p>
Imperativno programiranje problem faktorijela posmatra ovako:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">factorial</span>(n):
    <span style="color: #715ab1;">acc</span> = 1

    <span style="color: #3a81c3; font-weight: bold;">for</span> i <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3;">range</span>(1, n + 1):
        <span style="color: #715ab1;">acc</span> *= i

    <span style="color: #3a81c3; font-weight: bold;">return</span> acc
</pre>
</div>

<p>
Clojure kao funkcionalan <a href="#org3bbf4a1">value oriented</a> jezik ne podrÅ¾ava mutiranje
pa tako:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">factorial</span> <span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">case</span> n
    <span style="color: #2d9574;">(</span>0 1<span style="color: #2d9574;">)</span> 1
    <span style="color: #2d9574;">(</span>* n <span style="color: #67b11d;">(</span>factorial <span style="color: #b1951d;">(</span>- n 1<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Ako ispratimo izvrÅ¡avanje ove rekurzije videÄemo da "clojure" mora
svaku operaciju da stavi na stek kako <code>n</code> raste. To za veliko <code>n</code>
moÅ¾e izazvati <i>stack overflow</i>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>factorial 6<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>* 6 <span style="color: #6c3163;">(</span>factorial 5<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>* 6 <span style="color: #6c3163;">(</span>* 5 <span style="color: #2d9574;">(</span>factorial 4<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>* 6 <span style="color: #6c3163;">(</span>* 5 <span style="color: #2d9574;">(</span>* 4 <span style="color: #67b11d;">(</span>factorial 3<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>* 6 <span style="color: #6c3163;">(</span>* 5 <span style="color: #2d9574;">(</span>* 4 <span style="color: #67b11d;">(</span>* 3 <span style="color: #b1951d;">(</span>factorial 2<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>* 6 <span style="color: #6c3163;">(</span>* 5 <span style="color: #2d9574;">(</span>* 4 <span style="color: #67b11d;">(</span>* 3 <span style="color: #b1951d;">(</span>* 2 <span style="color: #3a81c3;">(</span>factorial 1<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>* 6 <span style="color: #6c3163;">(</span>* 5 <span style="color: #2d9574;">(</span>* 4 <span style="color: #67b11d;">(</span>* 3 <span style="color: #b1951d;">(</span>* 2 1<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>* 6 <span style="color: #6c3163;">(</span>* 5 <span style="color: #2d9574;">(</span>* 4 <span style="color: #67b11d;">(</span>* 3 2<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>* 6 <span style="color: #6c3163;">(</span>* 5 <span style="color: #2d9574;">(</span>* 4 6<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>* 6 <span style="color: #6c3163;">(</span>* 5 24<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>* 6 120<span style="color: #3a81c3;">)</span>
720
</pre>
</div>

<p>
Ovakva rekurzija se naziva joÅ¡ i <b>linearna rekurzija</b>.
</p>

<p>
U opÅ¡tem sluÄaju ovaj problem se reÅ¡ava <a href="https://en.wikipedia.org/wiki/Tail_call">tail call optimizacijom</a>.
</p>

<p>
MeÄutim, poÅ¡to je Clojure <b>hosted</b> programski jezik, a <i>JVM</i> ne
podrÅ¾ava ovu optimizaciju onda se Clojure koristi jednim trikom &#x2014;
<code>recur</code>
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc recur<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">recur</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(recur exprs*)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Special Form</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Evaluates the exprs in order, then, in parallel, rebinds</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the bindings of the recursion point to the values of the exprs.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Execution then jumps back to the recursion point, a loop or fn method.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Please see http://clojure.org/special_forms#recur</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>
</pre>
</div>

<p>
NaÅ¡ <code>factorial</code> koristeÄi <code>recur</code> moÅ¾emo napisati na sledeÄi naÄin:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">factorial-recur</span> <span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">loop</span> <span style="color: #2d9574;">[</span>count n acc 1<span style="color: #2d9574;">]</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #67b11d;">(</span>zero? count<span style="color: #67b11d;">)</span>
      acc
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">recur</span> <span style="color: #b1951d;">(</span>dec count<span style="color: #b1951d;">)</span> <span style="color: #b1951d;">(</span>* count acc<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
<code>loop</code> konstrukcija je zapravo anonimna - <i>lambda</i> funkcija sa
poÄetnim <i>binding</i>-om.
</p>

<blockquote>
<p>
<i>Binding</i> u kompjuterskoj nauci znaÄi asocijaciju nekog imena i nekog izraza.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc loop<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/loop</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(loop [bindings*] exprs*)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Special Form</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Evaluates the exprs in a lexical context in which the symbols in</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the binding-forms are bound to their respective init-exprs or parts</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">therein. Acts as a recur target.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Please see http://clojure.org/special_forms#loop</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>
</pre>
</div>

<p>
Primetite da <b>sada imamo poziv recur kao poslednji izraz u
funkciji</b> (u repu - <i>tail call</i>) pa tako nema potrebe za Äuvanjem
na steku. Funkcija se izvrÅ¡ava ovako:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>factorial-recur 6<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">loop</span> 6 1<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">loop</span> 5 6<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">loop</span> 4 30<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">loop</span> 3 120<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">loop</span> 2 360<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">loop</span> 1 720<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">loop</span> 0 720<span style="color: #3a81c3;">)</span>
720
</pre>
</div>

<p>
Å ta ako imamo potrebu za meÄusobnom rekurzijom (pogledajte zadatak
sa parsiranjem iz Python dela ovog kursa)?
</p>

<p>
Za potrebe ilustracije ovog koncepta implementirajmo svoju funckiju
za odreÄivanje da li je broj paran ili ne na sledeÄi naÄin:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">declare</span> is-even? is-odd?<span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>doc declare<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/declare</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([&amp; names])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Macro</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">defs the supplied var names with no bindings, useful for making forward decla</span><span style="color: #6c4173; background-color: #ecf3ec;">rations.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">is-even?</span> <span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>= n 0<span style="color: #2d9574;">)</span>
    <span style="color: #4e3163;">true</span>
    <span style="color: #2d9574;">(</span>is-odd? <span style="color: #67b11d;">(</span>dec n<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">is-odd?</span> <span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>= n 0<span style="color: #2d9574;">)</span>
    <span style="color: #4e3163;">false</span>
    <span style="color: #2d9574;">(</span>is-even? <span style="color: #67b11d;">(</span>dec n<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>is-odd? 12<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>
<span style="color: #3a81c3;">(</span>is-even? 12<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
</pre>
</div>

<p>
MeÄutim, ovaj pristup opet ima problem sa alokacijom steka. Pa
definiÅ¡imo to na malo drugaÄiji naÄin:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">declare</span> is-even-2? is-odd-2?<span style="color: #3a81c3;">)</span>

#<span style="color: #3a81c3;">(</span>+ <span style="color: #715ab1;">%1</span> <span style="color: #715ab1;">%2</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #function[clojure-ntp.core/eval20359/fn--20360]</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">is-even-2?</span> <span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>= n 0<span style="color: #2d9574;">)</span>
    <span style="color: #4e3163;">true</span>
    #<span style="color: #2d9574;">(</span>is-odd-2? <span style="color: #67b11d;">(</span>dec n<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">is-odd-2?</span> <span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>= n 0<span style="color: #2d9574;">)</span>
    <span style="color: #4e3163;">false</span>
    #<span style="color: #2d9574;">(</span>is-even-2? <span style="color: #67b11d;">(</span>dec n<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>trampoline is-odd-2? 12<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>
<span style="color: #3a81c3;">(</span>trampoline is-even-2? 12<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
</pre>
</div>

<p>
MeÄutim, korisnik naÅ¡e funkcije sada mora da zna da treba da je
pozove sa <code>trampoline</code>. To nije baÅ¡ divno. Pa preformuliÅ¡imo to joÅ¡
malo:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">my-is-odd-2?</span> <span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>trampoline is-odd-2? n<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>doc letfn<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/letfn</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(letfn [fnspecs*] exprs*)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Special Form</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">fnspec ==&gt; (fname [params*] exprs) or (fname ([params*] exprs)+)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Takes a vector of function specs and a body, and generates a set of</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">bindings of functions to their names. All of the names are available</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">in all of the definitions of the functions, as well as the body.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">my-odd?</span> <span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">letfn</span> <span style="color: #2d9574;">[</span><span style="color: #67b11d;">(</span>o? <span style="color: #b1951d;">[</span>n<span style="color: #b1951d;">]</span>
          <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #3a81c3;">(</span>= n 0<span style="color: #3a81c3;">)</span>
            <span style="color: #4e3163;">false</span>
            #<span style="color: #3a81c3;">(</span>e? <span style="color: #6c3163;">(</span>dec n<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
          <span style="color: #67b11d;">(</span>e? <span style="color: #b1951d;">[</span>n<span style="color: #b1951d;">]</span>
            <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #3a81c3;">(</span>= n 0<span style="color: #3a81c3;">)</span>
              <span style="color: #4e3163;">true</span>
              #<span style="color: #3a81c3;">(</span>o? <span style="color: #6c3163;">(</span>dec n<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">]</span>
    <span style="color: #2d9574;">(</span>trampoline o? n<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">my-even?</span> <span style="color: #6c3163;">[</span>n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>not <span style="color: #2d9574;">(</span>my-odd? n<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>my-odd? 12<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>
<span style="color: #3a81c3;">(</span>my-even? 12<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
</pre>
</div>

<p>
Sada je veÄ bolje. A najbolje je Å¡to sada <b>nema nepotrebnih
alokacija steka</b>.
</p>
</div>
</div>
</div>

<div id="outline-container-org8941d1d" class="outline-2">
<h2 id="org8941d1d"><span class="section-number-2">2</span> REPL i IDE</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org9478164" class="outline-3">
<h3 id="org9478164"><span class="section-number-3">2.1</span> <i>Build tools</i> - alati za izgradnju</h3>
<div class="outline-text-3" id="text-2-1">
<p>
U Clojure zajednici se paralelno koriste dva alata za izgradnju:
</p>

<ul class="org-ul">
<li><a href="https://leiningen.org/">Leiningen</a></li>
<li><a href="http://boot-clj.com/">Boot</a></li>
</ul>

<p>
<i>Lein</i> je po svom funkcionisanju sliÄniji alatima za razvoj koje
sreÄemo u drugim programskim jezicima pa Äemo ga na ovom kursu
koristiti. Ovde je potrebno napomenuti da je <i>Boot</i> priliÄno
zanimljiv i inovativan pristup izgradnji i da mu svakako vredi
posvetiti paÅ¾nju. <i>Boot</i> na veoma pametan naÄin koristi Clojure kao
potpuno dinamiÄko Lisp okruÅ¾enje.
</p>

<p>
Kako biste poÄeli da koristite <i>lein</i> potrebno je da proÄitate
<i><a href="https://github.com/technomancy/leiningen/blob/stable/doc/TUTORIAL.md#creating-a-project">Creating a Project</a></i> poglavlje iz totorijala.
</p>
</div>
</div>

<div id="outline-container-orgd646d0e" class="outline-3">
<h3 id="orgd646d0e"><span class="section-number-3">2.2</span> <i>IDE</i> - integrisana razvojna okruÅ¾enja</h3>
<div class="outline-text-3" id="text-2-2">
<p>
PodeÅ¡avanje za rad u Clojure-u nije teÅ¡ko pronaÄi bez obzira na to
koji je VaÅ¡ omiljeni naÄin rada i sviÄaju li Vam se viÅ¡e
tradicionalni editori ili tradicionalna razvojna okruÅ¾enja. Evo par
reÅ¡enja:
</p>

<ul class="org-ul">
<li>GNU/Emacs - <a href="https://github.com/clojure-emacs/cider">CIDER</a> (<a href="http://blog.cognitect.com/blog/2017/1/31/state-of-clojure-2016-results">najkoriÅ¡Äenije</a> u okviru Clojure zajednice)</li>
<li>Vim - <a href="https://github.com/tpope/vim-fireplace">Fireplace</a></li>
<li>Eclipse - <a href="http://doc.ccw-ide.org/documentation.html">Counterclockwise</a></li>
<li>IntelliJ - <a href="https://cursive-ide.com/">Cursive</a></li>
<li><a href="http://lighttable.com/">LightTable</a> - napredni editor pisan u Clojure-u (podrÅ¾ava osnovne
Clojure alate bez dodatne konfiguracije)</li>
<li><a href="https://sekao.net/nightcode/">Nightcode</a> - osnovni editor pisan u Clojure-u (preporuÄen Clojure
poÄetnicima)</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org73a1e73" class="outline-2">
<h2 id="org73a1e73"><span class="section-number-2">3</span> Elementi jezika</h2>
<div class="outline-text-2" id="text-3">
<p>
Ovaj kurs nema deo posveÄen upoznavanju sa baziÄnim elementima
jezika iz par razloga:
</p>

<ol class="org-ol">
<li>jer bi autor ovog teksta to sigurno uradio loÅ¡ije nego Å¡to je uraÄeno:
<ul class="org-ul">
<li>u knjizi <i>Clojure For The Brave And True</i> <a href="http://www.braveclojure.com/do-things/">ovde</a>.</li>
<li>na sajtu <a href="https://kimh.github.io/clojure-by-example/#require">Clojure By Example</a>.</li>
</ul></li>
<li>jer su baziÄni elementi jezika vrlo unificirani (kao i kod svakog
Lisp-a).</li>
<li>jer se proste stvari najbrÅ¾e uÄe individualno (tada je najmanja
Å¡ansa da Vam neko proste stvari zakomplikuje svojim loÅ¡im
objaÅ¡njenjem)</li>
</ol>
</div>

<div id="outline-container-org94e9190" class="outline-3">
<h3 id="org94e9190"><span class="section-number-3">3.1</span> Funkcije viÅ¡eg reda</h3>
<div class="outline-text-3" id="text-3-1">
<p>
<a href="https://en.wikipedia.org/wiki/Higher-order_function">Funkcije viÅ¡eg</a> reda su funkcije koje primaju funkcije kao parametre
i/ili vraÄaju funkcije.
</p>

<p>
Neke funkcije viÅ¡eg reda kao Å¡to su <code>map</code>, <code>filter</code>, <code>reduce</code> su
Vam poznate od ranije iz drugih programskih jezika.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">students</span> <span style="color: #6c3163;">[</span><span style="color: #2d9574;">{</span><span style="color: #4e3163;">:city</span> <span style="color: #2d9574;">"Novi Sad"</span> <span style="color: #4e3163;">:name</span> <span style="color: #2d9574;">"Milica"</span><span style="color: #2d9574;">}</span>
               <span style="color: #2d9574;">{</span><span style="color: #4e3163;">:city</span> <span style="color: #2d9574;">"Loznica"</span> <span style="color: #4e3163;">:name</span> <span style="color: #2d9574;">"Jelena"</span><span style="color: #2d9574;">}</span>
               <span style="color: #2d9574;">{</span><span style="color: #4e3163;">:city</span> <span style="color: #2d9574;">"Loznica"</span> <span style="color: #4e3163;">:name</span> <span style="color: #2d9574;">"Milan"</span><span style="color: #2d9574;">}</span>
               <span style="color: #2d9574;">{</span><span style="color: #4e3163;">:city</span> <span style="color: #2d9574;">"Loznica"</span> <span style="color: #4e3163;">:name</span> <span style="color: #2d9574;">"Stefan"</span><span style="color: #2d9574;">}</span>
               <span style="color: #2d9574;">{</span><span style="color: #4e3163;">:city</span> <span style="color: #2d9574;">"Novi Sad"</span> <span style="color: #4e3163;">:name</span> <span style="color: #2d9574;">"Ivana"</span><span style="color: #2d9574;">}</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>filter #<span style="color: #6c3163;">(</span>= <span style="color: #2d9574;">"Loznica"</span> <span style="color: #2d9574;">(</span><span style="color: #4e3163;">:city</span> <span style="color: #715ab1;">%</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span> students<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">({:city "Loznica", :name "Jelena"}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:city "Loznica", :name "Milan"}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:city "Loznica", :name "Stefan"})</span>
</pre>
</div>

<p>
SeÄate li se objektnog programiranja i <a href="https://en.wikipedia.org/wiki/Command_pattern">Command pattern</a>-a iz Jave?
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Command is an interface defining method execute() for its execution</span>

<span style="color: #3a81c3; font-weight: bold;">public</span> <span style="color: #ba2f59; font-weight: bold;">void</span> <span style="color: #6c3163; font-weight: bold;">wrapInTransaction</span>(<span style="color: #ba2f59; font-weight: bold;">Command</span> <span style="color: #715ab1;">c</span>) <span style="color: #3a81c3; font-weight: bold;">throws</span> <span style="color: #ba2f59; font-weight: bold;">Exception</span> {
    setupDataInfrastructure();
    <span style="color: #3a81c3; font-weight: bold;">try</span> {
        c.execute();
        completeTransaction();
    } <span style="color: #3a81c3; font-weight: bold;">catch</span> (<span style="color: #ba2f59; font-weight: bold;">Exception</span> <span style="color: #715ab1;">condition</span>) {
        rollbackTransaction();
        <span style="color: #3a81c3; font-weight: bold;">throw</span> condition;
    } <span style="color: #3a81c3; font-weight: bold;">finally</span> {
        cleanUp();
    }
}

<span style="color: #3a81c3; font-weight: bold;">public</span> <span style="color: #ba2f59; font-weight: bold;">void</span> <span style="color: #6c3163; font-weight: bold;">addOrderFrom</span>(<span style="color: #3a81c3; font-weight: bold;">final</span> <span style="color: #ba2f59; font-weight: bold;">ShoppingCart</span> <span style="color: #715ab1;">cart</span>, <span style="color: #3a81c3; font-weight: bold;">final</span> <span style="color: #ba2f59; font-weight: bold;">String</span> <span style="color: #715ab1;">userName</span>,
                         <span style="color: #3a81c3; font-weight: bold;">final</span> <span style="color: #ba2f59; font-weight: bold;">Order</span> <span style="color: #715ab1;">order</span>) <span style="color: #3a81c3; font-weight: bold;">throws</span> <span style="color: #ba2f59; font-weight: bold;">Exception</span> {
    wrapInTransaction(<span style="color: #3a81c3; font-weight: bold;">new</span> <span style="color: #ba2f59; font-weight: bold;">Command</span>() {
            <span style="color: #3a81c3; font-weight: bold;">public</span> <span style="color: #ba2f59; font-weight: bold;">void</span> <span style="color: #6c3163; font-weight: bold;">execute</span>() {
                add(order, userKeyBassedOn(username));
                addLineItemsFrom(cart, order.getOrderKey());
            }
        });
}
</pre>
</div>

<p>
Nije li funkcija odliÄan naÄin za modelovanje neke funkcije
(komande) sistema? :)
</p>

<p>
Verovatno jeste. Problem objektnog programiranja u Javi je Å¡to ako
posao modelujemo funkcijom onda posao ne moÅ¾emo poslati nekoj
metodi na izvrÅ¡avanje jer nemamo na raspolaganju funkcije viÅ¡eg
reda. U Clojure-u je to prirodna stvar:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">wrapInTransaction</span> <span style="color: #6c3163;">[</span>f<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">do</span>
    <span style="color: #2d9574;">(</span>startTransaction<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>f<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>completeTransaction<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>wrapInTransaction #<span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">do</span>
                      <span style="color: #2d9574;">(</span>add order user<span style="color: #2d9574;">)</span>
                      <span style="color: #2d9574;">(</span>addLineItemsFrom cart orderKey<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Ruku na srce, Java od verzije 1.8 ima podrÅ¡ku za funkcije viÅ¡eg
reda. Najbolji naÄin da uvidite koliko su funkcije viÅ¡eg reda
prirodne za Clojure je da ih probate u npr. Javi.
</p>
</div>

<div id="outline-container-orgc755c2a" class="outline-4">
<h4 id="orgc755c2a"><span class="section-number-4">3.1.1</span> Parcijalne funkcije</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Kada smo radili napredno Python programiranje videli smo Å¡ta su i
kako se mogu koristiti parcijalne funkcije. Pogledajmo u ovom
odeljku za Å¡ta se one mogu koristiti.
</p>

<p>
U objektnom programiranju postoji naÄin da izgradimo neki objekat
u nizu koraka. PoÅ¡to objektno programiranje prethodno ustanovljene
prakse zove Å¡ablonima onda se Å¡ablon o kome ovde govorimo zove
<a href="https://en.wikipedia.org/wiki/Builder_pattern"><i>Builder Pattern</i></a>. TakoÄe postoji i jedan priliÄno sliÄan Å¡ablon
koji sluÅ¾i da za proizvodnju sliÄnih objekata - <a href="https://en.wikipedia.org/wiki/Abstract_factory_pattern"><i>Abstract Factory
Pattern</i></a>.
</p>

<p>
Sa druge strane, osnovni metod apstrakcije funkcionalnih
programskih jezika su funkcije, a koncept koji nam omoguÄuje da od
postojeÄih funkcija sa veÄ datim delom parametara pravimo nove
funkcije su <b>parcijalne funkcije</b>.
</p>

<p>
Pogledajmo sada osnovno koriÅ¡Äenje parcijalnih funkcija u
Cljure-u:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc partial<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/partial</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([f] [f arg1] [f arg1 arg2] [f arg1 arg2 arg3] [f arg1 arg2 arg3 &amp; more])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Takes a function f and fewer than the normal arguments to f, and</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">returns a fn that takes a variable number of additional args. When</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">called, the returned function calls f with args + additional args.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">mul3</span> <span style="color: #6c3163;">(</span>partial * 3<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>mul3 2<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 6</span>
</pre>
</div>

<p>
Sada moÅ¾emo dati neke primere Clojure-a iz realnog sveta koji
pokazuju kako se mogu koristiti parcijalne funkcije tamo gde se u
objektnom programiranju koriste gorepomenuti Å¡abloni:
</p>

<p>
Za ovaj primer nam je potrebna biblioteka <a href="https://github.com/clojure/java.jdbc"><code>clojure.java.jdbc</code></a>.
</p>

<p>
I recimo da Å¾elimo da pravimo upite na naÅ¡u bazu podataka koristeÄi
samo <code>clojure.java.jdbc</code>. To u praksi moÅ¾emo uradi ovako:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc do<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">do</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(do exprs*)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Special Form</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Evaluates the expressions in order and returns the value of</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the last. If no expressions are supplied, returns nil.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Please see http://clojure.org/special_forms#do</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

#_<span style="color: #3a81c3; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">do</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">    </span><span style="color: #6c3163; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">def spec </span><span style="color: #2d9574; background-color: #ecf3ec;">{</span><span style="color: #2aa1ae; background-color: #ecf3ec;">:classname   "org.posgresql.Driver"</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">               :subprotocol "postgresql"</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">               :subname     "//localhost:5453/our_little_database"</span><span style="color: #2d9574; background-color: #ecf3ec;">}</span><span style="color: #6c3163; background-color: #ecf3ec;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">    </span><span style="color: #6c3163; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">defn all-users </span><span style="color: #2d9574; background-color: #ecf3ec;">[]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">      </span><span style="color: #2d9574; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">jdbc/query spec </span><span style="color: #67b11d; background-color: #ecf3ec;">[</span><span style="color: #2aa1ae; background-color: #ecf3ec;">"select * from login order by username desc"</span><span style="color: #67b11d; background-color: #ecf3ec;">]</span><span style="color: #2d9574; background-color: #ecf3ec;">)</span><span style="color: #6c3163; background-color: #ecf3ec;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">    </span><span style="color: #6c3163; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">defn find-user </span><span style="color: #2d9574; background-color: #ecf3ec;">[</span><span style="color: #2aa1ae; background-color: #ecf3ec;">username</span><span style="color: #2d9574; background-color: #ecf3ec;">]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">      </span><span style="color: #2d9574; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">jdbc/query spec </span><span style="color: #67b11d; background-color: #ecf3ec;">[</span><span style="color: #2aa1ae; background-color: #ecf3ec;">"select * from login where username = ?" username</span><span style="color: #67b11d; background-color: #ecf3ec;">]</span><span style="color: #2d9574; background-color: #ecf3ec;">)</span><span style="color: #6c3163; background-color: #ecf3ec;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">    </span><span style="color: #6c3163; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">defn create-user </span><span style="color: #2d9574; background-color: #ecf3ec;">[</span><span style="color: #2aa1ae; background-color: #ecf3ec;">username password</span><span style="color: #2d9574; background-color: #ecf3ec;">]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">      </span><span style="color: #2d9574; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">jdbc/insert! spec :login </span><span style="color: #67b11d; background-color: #ecf3ec;">{</span><span style="color: #2aa1ae; background-color: #ecf3ec;">:username username :password password</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">                                 :sal      "some_salt"</span><span style="color: #67b11d; background-color: #ecf3ec;">}</span><span style="color: #2d9574; background-color: #ecf3ec;">)</span><span style="color: #6c3163; background-color: #ecf3ec;">)</span><span style="color: #3a81c3; background-color: #ecf3ec;">)</span>
</pre>
</div>

<p>
U objektnom programiranju ne biste pisali specifikaciju konekcije
na bazu u svakom upitu veÄ biste se veÄ nekako odluÄili da pravite
<i>builder</i> (razmisliti Å¡ta to sve taÄno obuhvata). Ovde biste
takav efekat postigli mnogo direktnije:
</p>

<div class="org-src-container">
<pre class="src src-clojure">#_<span style="color: #3a81c3; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">do</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">    </span><span style="color: #6c3163; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">def spec </span><span style="color: #2d9574; background-color: #ecf3ec;">{</span><span style="color: #2aa1ae; background-color: #ecf3ec;">:classname   "org.posgresql.Driver"</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">               :subprotocol "postgresql"</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">               :subname     "//localhost:5453/our_little_database"</span><span style="color: #2d9574; background-color: #ecf3ec;">}</span><span style="color: #6c3163; background-color: #ecf3ec;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">    </span><span style="color: #6c3163; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">def query </span><span style="color: #2d9574; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">partial jdbc/query spec</span><span style="color: #2d9574; background-color: #ecf3ec;">)</span><span style="color: #6c3163; background-color: #ecf3ec;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">    </span><span style="color: #6c3163; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">def insert! </span><span style="color: #2d9574; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">partial jdbc/insert! spec</span><span style="color: #2d9574; background-color: #ecf3ec;">)</span><span style="color: #6c3163; background-color: #ecf3ec;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">    </span><span style="color: #6c3163; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">defn all-users </span><span style="color: #2d9574; background-color: #ecf3ec;">[]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">      </span><span style="color: #2d9574; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">query </span><span style="color: #67b11d; background-color: #ecf3ec;">[</span><span style="color: #2aa1ae; background-color: #ecf3ec;">"select * from login order by username desc"</span><span style="color: #67b11d; background-color: #ecf3ec;">]</span><span style="color: #2d9574; background-color: #ecf3ec;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">      </span><span style="color: #2d9574; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">defn find-user </span><span style="color: #67b11d; background-color: #ecf3ec;">[</span><span style="color: #2aa1ae; background-color: #ecf3ec;">username</span><span style="color: #67b11d; background-color: #ecf3ec;">]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">        </span><span style="color: #67b11d; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">query </span><span style="color: #b1951d; background-color: #ecf3ec;">[</span><span style="color: #2aa1ae; background-color: #ecf3ec;">"select * from login where username = ?" username</span><span style="color: #b1951d; background-color: #ecf3ec;">]</span><span style="color: #67b11d; background-color: #ecf3ec;">)</span><span style="color: #2d9574; background-color: #ecf3ec;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">      </span><span style="color: #2d9574; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">defn create-user </span><span style="color: #67b11d; background-color: #ecf3ec;">[</span><span style="color: #2aa1ae; background-color: #ecf3ec;">username password</span><span style="color: #67b11d; background-color: #ecf3ec;">]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">        </span><span style="color: #67b11d; background-color: #ecf3ec;">(</span><span style="color: #2aa1ae; background-color: #ecf3ec;">insert! :login </span><span style="color: #b1951d; background-color: #ecf3ec;">{</span><span style="color: #2aa1ae; background-color: #ecf3ec;">:username username :password password</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">                         :sal      "some_salt"</span><span style="color: #b1951d; background-color: #ecf3ec;">}</span><span style="color: #67b11d; background-color: #ecf3ec;">)</span><span style="color: #2d9574; background-color: #ecf3ec;">)</span><span style="color: #6c3163; background-color: #ecf3ec;">)</span><span style="color: #3a81c3; background-color: #ecf3ec;">)</span>
</pre>
</div>

<p>
Naravno, kao i svim Å¡iroko koriÅ¡Äenim programskim jezicima i u
Clojure-u postoji Äitav spektar gotovih biblioteka koje Vam daju
apstrakciju nad osnovnim drajverom baze podataka (u ovom sluÄaju
nad <i>jdbc</i>-om).
</p>

<p>
Drugi primer iz <i>real world</i> Clojure koda gde se koriste parcijalne
funkcije je kada imate funkciju viÅ¡eg reda kojoj Å¾elite da
prosledite neku funkciju koja prima viÅ¡e parametara. Npr. funkcija
<code>*</code> nema previÅ¡e smisla za jedan argument.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">apply-sales-tax</span> <span style="color: #6c3163;">[</span>items<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>map <span style="color: #2d9574;">(</span>partial * 1.6<span style="color: #2d9574;">)</span> items<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>apply-sales-tax <span style="color: #6c3163;">[</span>0.23 0.12 8.12 4.2<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (0.36800000000000005 0.192 12.991999999999999 6.720000000000001)</span>
</pre>
</div>

<p>
ProkomentariÅ¡ite sledeÄi rezultat?
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">a-result</span> <span style="color: #6c3163;">[</span>items<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>map * items<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>a-result <span style="color: #6c3163;">[</span>0.23 0.12 8.12 4.2<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (0.23 0.12 8.12 4.2)</span>
</pre>
</div>

<p>
Nedostatak parcijalnih funkcija formulisanih na naÄin kako je to
uraÄeno u Clojure-u Å¡to se parametri funkcije parcijalizuju <b>samo</b>
sa poÄetka. Na primer funkciju <code>-</code> ne moÅ¾emo <b>samo</b> koristeÄi
<code>partial</code> parcijalizovati drugim parametrom veÄ samo prvim.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>map <span style="color: #6c3163;">(</span>partial - 2<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">[</span>1 2 3<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (1 0 -1)</span>
</pre>
</div>

<p>
Ali moÅ¾emo postiÄi taj efekat uvodeÄi jednu prostu <code>lambdu</code>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>map #<span style="color: #6c3163;">(</span>- <span style="color: #715ab1;">%</span> 2<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">[</span>1 2 3<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (-1 0 1)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1b7a09f" class="outline-3">
<h3 id="org1b7a09f"><span class="section-number-3">3.2</span> Kompozicija funkcija</h3>
<div class="outline-text-3" id="text-3-2">
<p>
JoÅ¡ jednom, Clojure svoje korene vuÄe iz matematike pa tako ima joÅ¡
jedan veoma moÄan koncept apstrakcije - <b>kompoziciju funkcija</b>.
</p>

<blockquote>
<p>
Kompozicija funkcija je primena funkcije na rezultate druge
funkcije u cilju dobijanja treÄe funkcije.
</p>

<p>
\(f \circ g (x) = f(g(x))\)
</p>
</blockquote>

<p>
Ili za one kojima je poznavanje <i>Unix-a</i> trenutno ispred poznavanja
matematike - "to je ako pipe (|) u <i>shell-u</i>":
</p>

<div class="org-src-container">
<pre class="src src-shell">ls | grep <span style="color: #2d9574;">"clojure-ntp"</span>
</pre>
</div>

<p>
U svrhu ilustracije zamislimo da imamo neki JavaScript kod i da
Å¾elimo da ga minificiramo tj. da proÄitamo JavaScript fajl kao
tekst i da iz tog teksta izbacimo sve nove redove i druge
nepotrebne karaktere kako bi se manje podataka prenosilo mreÅ¾om. Za
to vrlo elegantno moÅ¾emo da iskoristimo kompoziciju funkcija koje
veÄ postoje u Clojure-u:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">minify</span> <span style="color: #6c3163;">[</span>input<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">clojure.string</span>/join
   <span style="color: #2d9574;">(</span>map <span style="color: #ba2f59; font-weight: bold;">clojure.string</span>/trim
        <span style="color: #67b11d;">(</span><span style="color: #ba2f59; font-weight: bold;">clojure.string</span>/split-lines input<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>minify <span style="color: #2d9574;">"javascriptcode javascriptcode    </span><span style="color: #2d9574; font-weight: bold;">\n</span><span style="color: #2d9574;">javascriptcodejavascriptco   </span><span style="color: #2d9574; font-weight: bold;">\n</span><span style="color: #2d9574;">"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; javascriptcode javascriptcodejavascriptcodejavascriptco</span>
</pre>
</div>

<p>
Primetimo da se poslednja navedena funkcija poziva prva tj. primena
funkcija ide "iznutra ka spolja". To moÅ¾da moÅ¾e izgledati Äudno
(iako je baÅ¡ tako i u matematiÄkoj notaciji) pa onda Clojure pruÅ¾a
drugi naÄin da se ovo zapiÅ¡e koriÅ¡Äenjem <i>threading macro</i>-a (o
makroima Äe biti reÄi <a href="#org3cb455c">u nastavku</a>):
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">minify2</span> <span style="color: #6c3163;">[</span>input<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">clojure.string</span>/trim
      <span style="color: #2d9574;">(</span>map <span style="color: #67b11d;">(</span><span style="color: #ba2f59; font-weight: bold;">clojure.string</span>/split-lines input<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
      <span style="color: #ba2f59; font-weight: bold;">clojure.string</span>/join<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>minify2 <span style="color: #2d9574;">"javascriptcode javascriptcode    </span><span style="color: #2d9574; font-weight: bold;">\n</span><span style="color: #2d9574;">javascriptcodejavascriptco   </span><span style="color: #2d9574; font-weight: bold;">\n</span><span style="color: #2d9574;">"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; "javascriptcode javascriptcodejavascriptcodejavascriptco"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7e2499" class="outline-3">
<h3 id="orgd7e2499"><span class="section-number-3">3.3</span> Clojure naglaÅ¡ava svoju lenjost</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Clojure se ne smatra lenjim jezikom u smislu u kome se to misli
kada se govori o Haskell-u (o tome u nastavku kursa) ali naglaÅ¡ava
lenje izvrÅ¡avanje na mnogim mestima.
</p>

<p>
Mnoge ugraÄene funkcije vraÄaju lenje sekvence. Takve su <code>map</code>,
<code>reduce</code>, <code>filter</code> i druge. To se moÅ¾e jednostavno videti na
primeru:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">result</span> <span style="color: #6c3163;">(</span>map #<span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">do</span> <span style="color: #67b11d;">(</span>println <span style="color: #2d9574;">"."</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>inc <span style="color: #715ab1;">%</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">[</span>0 1 2 3<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

result
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(1 2 3 4)</span>
</pre>
</div>

<p>
Da Clojure nije lenj taÄke bi se ispisivale na ekran odmah pri
definisanju <code>result</code>-a. Ovako je ispisivanje na ekran pozvano tek
kada smo zatraÅ¾ili da se <code>result</code> isprinta.
</p>

<p>
JoÅ¡ jedna stvar za koju lenje sekvence mogu biti od koristi je i
predstava beskonaÄnih struktura. Npr, ako imamo lenje sekvence i
skup realnih brojeva onda fibonaÄijevu sekvencu moÅ¾emo da
predstavimo na sledeÄi naÄin:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">fib-seq</span>
  <span style="color: #6c3163;">(</span>lazy-cat <span style="color: #2d9574;">[</span>1 1<span style="color: #2d9574;">]</span> <span style="color: #2d9574;">(</span>map + <span style="color: #67b11d;">(</span>rest fib-seq<span style="color: #67b11d;">)</span> fib-seq<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>doc lazy-cat<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/lazy-cat</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([&amp; colls])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Macro</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Expands to code which yields a lazy sequence of the concatenation</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">of the supplied colls.  Each coll expr is not evaluated until it is</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">needed.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(lazy-cat xs ys zs) === (concat (lazy-seq xs) (lazy-seq ys) (lazy-seq zs))</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span>take 10 fib-seq<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (1 1 2 3 5 8 13 21 34 55)</span>

<span style="color: #3a81c3;">(</span>doc take<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/take</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([n] [n coll])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns a lazy sequence of the first n items in coll, or all items if</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">there are fewer than n.  Returns a stateful transducer when</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">no collection is provided.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>
</pre>
</div>

<p>
Kada smo radili napredni Python upoznali smo se sa metodama koje
nam omoguÄuju da beskonaÄno kruÅ¾imo kroz konaÄne strukture. Ovde je
dat joÅ¡ jedan primer koriÅ¡Äenja ovog koncepta:
</p>

<p>
Recimo Å¾elimo da ravnomerno rasporedimo ljude iz kolekcije na 4
moguÄa izlaza:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">people</span> <span style="color: #6c3163;">[</span><span style="color: #2d9574;">"Milica"</span> <span style="color: #2d9574;">"Milan"</span> <span style="color: #2d9574;">"Ivan"</span> <span style="color: #2d9574;">"Stefan"</span> <span style="color: #2d9574;">"Nikolina"</span> <span style="color: #2d9574;">"Nikola"</span> <span style="color: #2d9574;">"Ilija"</span> <span style="color: #2d9574;">"Dunja</span><span style="color: #6c4173;">"</span>
             <span style="color: #2d9574;">"Vi&#353;nja"</span> <span style="color: #2d9574;">"Aida"</span> <span style="color: #2d9574;">"Nemanja"</span> <span style="color: #2d9574;">"Ivona"</span> <span style="color: #2d9574;">"Petar"</span> <span style="color: #2d9574;">"Petra"</span> <span style="color: #2d9574;">"Aagda"</span> <span style="color: #2d9574;">"Du&#353;an"</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>mapv #<span style="color: #6c3163;">(</span>vector <span style="color: #715ab1;">%1</span> <span style="color: #715ab1;">%2</span><span style="color: #6c3163;">)</span> <span style="color: #6c3163;">(</span>cycle <span style="color: #2d9574;">[</span><span style="color: #4e3163;">:up</span> <span style="color: #4e3163;">:down</span> <span style="color: #4e3163;">:left</span> <span style="color: #4e3163;">:right</span><span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span> people<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[[:up "Milica"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:down "Milan"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:left "Ivan"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:right "Stefan"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:up "Nikolina"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:down "Nikola"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:left "Ilija"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:right "Dunja"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:up "Vi&#353;nja"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:down "Aida"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:left "Nemanja"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:right "Ivona"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:up "Petar"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:down "Petra"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:left "Aagda"]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:right "Du&#353;an"]]</span>

<span style="color: #3a81c3;">(</span>doc mapv<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/mapv</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([f coll] [f c1 c2] [f c1 c2 c3] [f c1 c2 c3 &amp; colls])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns a vector consisting of the result of applying f to the</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">set of first items of each coll, followed by applying f to the set</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">of second items in each coll, until any one of the colls is</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">exhausted.  Any remaining items in other colls are ignored. Function</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">f should accept number-of-colls arguments.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span>doc vector<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/vector</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([] [a] [a b] [a b c] [a b c d] [a b c d e] [a b c d e f] [a b c d e f &amp; args</span><span style="color: #6c4173; background-color: #ecf3ec;">])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Creates a new vector containing the args.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org43276ef" class="outline-3">
<h3 id="org43276ef"><span class="section-number-3">3.4</span> VeÅ¾banje 1</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Ideje zadataka uglavnom preuzete sa <a href="https://www.4clojure.com">4Clojure</a>.
</p>

<ol class="org-ol">
<li>Napisati funkciju <code>say-hello</code> koja prima parametar <code>name</code> i vraÄa
tekst <code>Hello to &lt;name&gt;</code>.</li>
<li><p>
Napisati funkciju <code>get-the-caps</code> koja prima string engleskih
slova a vraÄa samo njegova velika slova.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc -&gt;&gt;<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/-&gt;&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([x &amp; forms])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Macro</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Threads the expr through the forms. Inserts x as the</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">last item in the first form, making a list of it if it is not a</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">list already. If there are more forms, inserts the first form as the</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">last item in second form, etc.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span>doc apply<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/apply</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([f args] [f x args] [f x y args] [f x y z args] [f a b c d &amp; args])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Applies fn f to the argument list formed by prepending intervening arguments </span><span style="color: #6c4173; background-color: #ecf3ec;">to args.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">get-the-caps</span>
  <span style="color: #da8b55;">"Gets the string and returns string consisted of capital letters from</span>
<span style="color: #da8b55;">  the original."</span>
  <span style="color: #6c3163;">[</span>s<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #2d9574;">[</span>capitals <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;&gt;</span> <span style="color: #b1951d;">(</span>range 65 91<span style="color: #b1951d;">)</span>
                      <span style="color: #b1951d;">(</span>map char<span style="color: #b1951d;">)</span>
                      set<span style="color: #67b11d;">)</span><span style="color: #2d9574;">]</span>
    <span style="color: #2d9574;">(</span>apply str <span style="color: #67b11d;">(</span>filter capitals s<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>get-the-caps <span style="color: #2d9574;">"AmsdaBsdaDsdaDAS"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; "ABDDAS"</span>
</pre>
</div></li>

<li><p>
Napisati funkciju <code>drop-nth</code> koja prima dva parametra od kojih je
prvo vektor elemenata a drugo <code>n</code>. Funkcija vraÄa listu bez
svakog <code>n</code>-tog elementa.
</p>

<p>
Eksplicitnom rekurzijom:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc concat<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/concat</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([] [x] [x y] [x y &amp; zs])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns a lazy seq representing the concatenation of the elements in the supp</span><span style="color: #6c4173; background-color: #ecf3ec;">lied colls.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span>doc into<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/into</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([to from] [to xform from])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns a new coll consisting of to-coll with all of the items of</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">from-coll conjoined. A transducer may be supplied.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">drop-nth</span>
  <span style="color: #da8b55;">"Drop every nth element from a vector starting with first if n fits</span>
<span style="color: #da8b55;">  in length of v."</span>
  <span style="color: #6c3163;">[</span>v n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>&lt; <span style="color: #67b11d;">(</span>count v<span style="color: #67b11d;">)</span> n<span style="color: #2d9574;">)</span>
    v
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">loop</span> <span style="color: #67b11d;">[</span>v   v
           acc <span style="color: #b1951d;">[]</span><span style="color: #67b11d;">]</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #b1951d;">(</span>zero? <span style="color: #3a81c3;">(</span>count v<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
        <span style="color: #b1951d;">(</span>into <span style="color: #3a81c3;">[]</span> acc<span style="color: #b1951d;">)</span>
        <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">recur</span> <span style="color: #3a81c3;">(</span>drop n v<span style="color: #3a81c3;">)</span>
               <span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;&gt;</span> v <span style="color: #6c3163;">(</span>take n<span style="color: #6c3163;">)</span> rest <span style="color: #6c3163;">(</span>concat acc<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>drop-nth <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 2<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 3 5 7 9]</span>

<span style="color: #3a81c3;">(</span>drop-nth <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 3<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 2 4 5 7 8]</span>

<span style="color: #3a81c3;">(</span>drop-nth <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 5<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 2 3 4 6 7 8 9]</span>

<span style="color: #3a81c3;">(</span>drop-nth <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 10<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 2 3 4 5 6 7 8 9]</span>

<span style="color: #3a81c3;">(</span>drop-nth <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 11<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (0 1 2 3 4 5 6 7 8 9)</span>
</pre>
</div>

<p>
Ili koristeÄi <code>keep-indexed</code> funkciju:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc -&gt;<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/-&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([x &amp; forms])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Macro</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Threads the expr through the forms. Inserts x as the</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">second item in the first form, making a list of it if it is not a</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">list already. If there are more forms, inserts the first form as the</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">second item in second form, etc.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span>doc keep-indexed<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/keep-indexed</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([f] [f coll])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns a lazy sequence of the non-nil results of (f index item). Note,</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">this means false return values will be included.  f must be free of</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">side-effects.  Returns a stateful transducer when no collection is</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">provided.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">drop-nth-2</span>
  <span style="color: #da8b55;">"Drop every nth element from a vector starting with first if n fits</span>
<span style="color: #da8b55;">  in length of v."</span>
  <span style="color: #6c3163;">[</span>v n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>&gt;= <span style="color: #67b11d;">(</span>count v<span style="color: #67b11d;">)</span> n<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>vec
     <span style="color: #67b11d;">(</span>keep-indexed <span style="color: #b1951d;">(</span><span style="color: #3a81c3; font-weight: bold;">fn</span> <span style="color: #3a81c3;">[</span>i v<span style="color: #3a81c3;">]</span> <span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;</span> i
                                     <span style="color: #2d9574;">(</span>mod n<span style="color: #2d9574;">)</span>
                                     zero?
                                     not<span style="color: #6c3163;">)</span>
                               v<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span>
                   v<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    v<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>drop-nth-2 <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 2<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 3 5 7 9]</span>

<span style="color: #3a81c3;">(</span>drop-nth-2 <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 3<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 2 4 5 7 8]</span>

<span style="color: #3a81c3;">(</span>drop-nth-2 <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 5<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 2 3 4 6 7 8 9]</span>

<span style="color: #3a81c3;">(</span>drop-nth-2 <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 10<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 2 3 4 5 6 7 8 9]</span>

<span style="color: #3a81c3;">(</span>drop-nth-2 <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 11<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (0 1 2 3 4 5 6 7 8 9)</span>
</pre>
</div>

<p>
Ili uz malo skupovnih operacija:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">drop-nthh</span>
  <span style="color: #da8b55;">"Drop every n-th element using only take-nth and a little bit of set</span>
<span style="color: #da8b55;">  theory."</span>
  <span style="color: #6c3163;">[</span>v n<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>&gt;= <span style="color: #67b11d;">(</span>count v<span style="color: #67b11d;">)</span> n<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>vec <span style="color: #67b11d;">(</span><span style="color: #ba2f59; font-weight: bold;">clojure.set</span>/difference <span style="color: #b1951d;">(</span>apply sorted-set v<span style="color: #b1951d;">)</span> <span style="color: #b1951d;">(</span>take-nth n v<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    v<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>drop-nthh <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 2<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 3 5 7 9]</span>

<span style="color: #3a81c3;">(</span>drop-nthh <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 3<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 2 4 5 7 8]</span>

<span style="color: #3a81c3;">(</span>drop-nthh <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 5<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 2 3 4 6 7 8 9]</span>

<span style="color: #3a81c3;">(</span>drop-nthh <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 10<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [1 2 3 4 5 6 7 8 9]</span>

<span style="color: #3a81c3;">(</span>drop-nthh <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span> 11<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (0 1 2 3 4 5 6 7 8 9)</span>
</pre>
</div></li>

<li><p>
Napravite <code>flip</code> funkciju viÅ¡eg reda koja invertuje parametre
prosleÄene funkcije.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #6c3163;">(</span>flip -<span style="color: #6c3163;">)</span> 1 2<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc apply<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/apply</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([f args] [f x args] [f x y args] [f x y z args] [f a b c d &amp; args])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Applies fn f to the argument list formed by prepending intervening arguments </span><span style="color: #6c4173; background-color: #ecf3ec;">to args.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">flip</span>
  <span style="color: #da8b55;">"Flip the parameters of a function."</span>
  <span style="color: #6c3163;">[</span>f<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">fn</span> <span style="color: #2d9574;">[</span>&amp; args<span style="color: #2d9574;">]</span>
    <span style="color: #2d9574;">(</span>apply f <span style="color: #67b11d;">(</span>reverse args<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>= 3 <span style="color: #6c3163;">(</span><span style="color: #2d9574;">(</span>flip nth<span style="color: #2d9574;">)</span> 2 <span style="color: #2d9574;">[</span>1 2 3 4 5<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>

<span style="color: #3a81c3;">(</span>= <span style="color: #4e3163;">true</span> <span style="color: #6c3163;">(</span><span style="color: #2d9574;">(</span>flip &gt;<span style="color: #2d9574;">)</span> 7 8<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>

<span style="color: #3a81c3;">(</span>= 4 <span style="color: #6c3163;">(</span><span style="color: #2d9574;">(</span>flip quot<span style="color: #2d9574;">)</span> 2 8<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>

<span style="color: #3a81c3;">(</span>= <span style="color: #6c3163;">[</span>1 2 3<span style="color: #6c3163;">]</span> <span style="color: #6c3163;">(</span><span style="color: #2d9574;">(</span>flip take<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">[</span>1 2 3 4 5<span style="color: #2d9574;">]</span> 3<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
</pre>
</div></li>

<li><p>
Napisati funkciju <code>b-tree?</code> koja proverava da li je neka
sekvenca binarno stablo.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>b-tree? <span style="color: #6c3163;">[</span>1 <span style="color: #2d9574;">[</span>2 <span style="color: #67b11d;">[</span>3 <span style="color: #b1951d;">[</span>4 <span style="color: #4e3163;">false</span> <span style="color: #4e3163;">nil</span><span style="color: #b1951d;">]</span> <span style="color: #4e3163;">nil</span><span style="color: #67b11d;">]</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">]</span> <span style="color: #4e3163;">nil</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>

<span style="color: #3a81c3;">(</span>b-tree? '<span style="color: #6c3163;">(</span><span style="color: #4e3163;">:a</span> <span style="color: #4e3163;">nil</span> <span style="color: #2d9574;">()</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>

<span style="color: #3a81c3;">(</span>b-tree? <span style="color: #6c3163;">[</span>1 <span style="color: #2d9574;">[</span>2 <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">]</span> <span style="color: #2d9574;">[</span>3 <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">]</span> <span style="color: #2d9574;">[</span>4 <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">]</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>

<span style="color: #3a81c3;">(</span>b-tree? '<span style="color: #6c3163;">(</span><span style="color: #4e3163;">:a</span> <span style="color: #2d9574;">(</span><span style="color: #4e3163;">:b</span> <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">)</span> <span style="color: #4e3163;">nil</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">b-tree?</span>
  <span style="color: #da8b55;">"Predicate that checks is s a binary tree or not."</span>
  <span style="color: #6c3163;">[</span>s<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>coll? s<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #67b11d;">(</span>not= <span style="color: #b1951d;">(</span>count s<span style="color: #b1951d;">)</span> 3<span style="color: #67b11d;">)</span>
      <span style="color: #4e3163;">false</span>
      <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">and</span> <span style="color: #b1951d;">(</span>b-tree? <span style="color: #3a81c3;">(</span>nth s 1<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span> <span style="color: #b1951d;">(</span>b-tree? <span style="color: #3a81c3;">(</span>nth s 2<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #4e3163;">true</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>b-tree? <span style="color: #6c3163;">[</span>1 <span style="color: #2d9574;">[</span>2 <span style="color: #67b11d;">[</span>3 <span style="color: #b1951d;">[</span>4 <span style="color: #4e3163;">false</span> <span style="color: #4e3163;">nil</span><span style="color: #b1951d;">]</span> <span style="color: #4e3163;">nil</span><span style="color: #67b11d;">]</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">]</span> <span style="color: #4e3163;">nil</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>

<span style="color: #3a81c3;">(</span>b-tree? '<span style="color: #6c3163;">(</span><span style="color: #4e3163;">:a</span> <span style="color: #4e3163;">nil</span> <span style="color: #2d9574;">()</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>

<span style="color: #3a81c3;">(</span>b-tree? <span style="color: #6c3163;">[</span>1 <span style="color: #2d9574;">[</span>2 <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">]</span> <span style="color: #2d9574;">[</span>3 <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">]</span> <span style="color: #2d9574;">[</span>4 <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">]</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>

<span style="color: #3a81c3;">(</span>b-tree? '<span style="color: #6c3163;">(</span><span style="color: #4e3163;">:a</span> <span style="color: #2d9574;">(</span><span style="color: #4e3163;">:b</span> <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">)</span> <span style="color: #4e3163;">nil</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
</pre>
</div></li>

<li>Lepota je u simetriji. NapiÅ¡ite predikat <code>beauty-tree?</code> koji
proverava da li je binarno stablo simetriÄno. Stablo je
simetriÄno ako je svako levo podstablo odraz u ogledalu od
desnog podstabla.</li>
</ol>
</div>
</div>

<div id="outline-container-org9248b0f" class="outline-3">
<h3 id="org9248b0f"><span class="section-number-3">3.5</span> Kada je mutacija stvarno nezaobilazna</h3>
<div class="outline-text-3" id="text-3-5">
<p>
To Å¡to je Clojure <i>value oriented</i> ne znaÄi da ne postoji naÄin da
koristite mutabilna stanja veÄ da kada ih koristite ona moraju biti
dobro izolovana i jedino na pravilan (konzistentan) naÄin moÅ¾ete
njima rukovati. Clojure pruÅ¾a nekoliko mehanizama za rukovanje
mutabilnim stanjem.
</p>
</div>

<div id="outline-container-org8057ad1" class="outline-4">
<h4 id="org8057ad1"><span class="section-number-4">3.5.1</span> Atom</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
<i>Atomi</i> su prvi i najjednostavniji mehanizam za rukovanje
mutabilnim stanjem. Ideja je da se oni uposle kada imamo
<b>sinhrono</b>, <b>nekoordinisano</b> ili <b>nezavisano</b> koriÅ¡Äenje deljenih
resursa. Dakle, ako treba da baratamo samo jednim parÄetom
mutabilnog stanja od jednom i drugih zahteva onda su Atomi prava
stvar za nas (i upravo to je i najÄeÅ¡Äe).
</p>

<p>
Do sada smo uvek kada govorimo o Clojure-u govorili o vrednostima
(a ne o promenljivom sadrÅ¾aju), <i>atomi su definisani na malo
sloÅ¾eniji naÄin</i>. PoÅ¡to nam treba da atomima predstavimo neÅ¡to Å¡to
se moÅ¾e menjati u vremenu i poÅ¡to Clojure ne dozvoljava mutabilne
strukture podataka jedini naÄin da se implementiraju atomi je bio
&#x2014; <span class="underline">kao promenljive reference na imutabilne strukture</span>. Jedan
naÄin kako se definiÅ¡e atom je dat u nastavku:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">app-state</span> <span style="color: #6c3163;">(</span>atom <span style="color: #2d9574;">{}</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
app-state
</pre>
</div>

<p>
Ovako smo napravili atom koji sadrÅ¾i praznu perzistentnu -
<b>imutabilnu</b> mapu a Äija je referenca saÄuvana u <code>app-state</code>
(adresa mape je data heksadecimalno). PoÅ¡to ovako prazna naÅ¡a mapa
nije baÅ¡ korisna hajde da asociramo neke vrednosti unutar nje:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc swap!<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/swap!</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([atom f] [atom f x] [atom f x y] [atom f x y &amp; args])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Atomically swaps the value of atom to be:</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(apply f current-value-of-atom args). Note that f may be called</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">multiple times, and thus should be free of side effects.  Returns</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the value that was swapped in.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span>swap! app-state assoc <span style="color: #4e3163;">:current-user</span> <span style="color: #2d9574;">"Mile"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #atom[{:current-user "Mile"} 0x18a5b107]</span>

<span style="color: #3a81c3;">(</span>swap! app-state assoc <span style="color: #4e3163;">:session-id</span> <span style="color: #2d9574;">"873649203"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #atom[{:current-user "Mile", :session-id "873649203"} 0x18a5b107]</span>
</pre>
</div>

<p>
Dakle, funkcija <code>swap!</code> <b>zamenjuje</b> vrednost na kuju pokazuje
<code>app-state</code> za neku drugu vrednost koja je rezultat primene
funkcije <code>assoc</code> na onu vrednost na koju trenutno pokazuje
<code>app-state</code> i ostale argumente. Naravno, umesto <code>assoc</code> funkcije
se moÅ¾e koristiti bilo koja druga.
</p>

<p>
Ako samo Å¾elimo da <b>zamenimo</b> vrednost na koju trenutno pokazuje
<code>app-state</code> sa nekom drugom vrednoÅ¡Äu za to moÅ¾emo koristiti
funkciju <code>reset!</code>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>reset! app-state <span style="color: #6c3163;">{}</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #atom[{} 0x18a5b107]</span>
</pre>
</div>

<p>
Sada kada znamo kako da saÄuvamo deljeno stanje u okviru atoma
pitanje je &#x2014; kako da ga proÄitamo odatle? Operacija Äitanja se u
ovom kontekstu zove <b>dereferenciranje</b> i radi se funkcijom <code>deref</code>
ili <code>@</code> <i>reader macro</i>-om:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>swap! app-state assoc <span style="color: #4e3163;">:current-user</span> <span style="color: #2d9574;">"Pera"</span> <span style="color: #4e3163;">:session-id</span> <span style="color: #2d9574;">"98374374"</span><span style="color: #3a81c3;">)</span>
@app-state
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; {:current-user "Pera", :session-id "98374374"}</span>
<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">:current-user</span> @app-state<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; "Pera"</span>
<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">:session-id</span> @app-state<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 98374374</span>
<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">:foo</span> @app-state<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; nil</span>
</pre>
</div>

<p>
Ovaj vrlo prost i intuitivan mehanizam nas spaÅ¡ava pisanje
eksplicitnih zakljuÄavanja i daje nam veoma Äist - funkcionalni
API za rukovanje deljenim stanjem.
</p>

<p>
ProkomentariÅ¡ite rezultate ispod.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">state</span> <span style="color: #6c3163;">(</span>atom <span style="color: #2d9574;">{</span><span style="color: #4e3163;">:account</span> 200<span style="color: #2d9574;">}</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">multit</span> <span style="color: #6c3163;">[]</span>
  <span style="color: #6c3163;">(</span>future <span style="color: #2d9574;">(</span>swap! state update-in <span style="color: #67b11d;">[</span><span style="color: #4e3163;">:account</span><span style="color: #67b11d;">]</span>
                 <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">do</span>
                   <span style="color: #b1951d;">(</span>println <span style="color: #2d9574;">"Negotiations start..."</span><span style="color: #b1951d;">)</span>
                   <span style="color: #b1951d;">(</span><span style="color: #ba2f59; font-weight: bold;">Thread</span>/sleep 10000<span style="color: #b1951d;">)</span>
                   <span style="color: #b1951d;">(</span>println <span style="color: #2d9574;">"They're ready to pay!"</span><span style="color: #b1951d;">)</span>
                   <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">They decided to support our budget by 50%</span>
                   #<span style="color: #b1951d;">(</span>+ <span style="color: #715ab1;">%</span> <span style="color: #3a81c3;">(</span>* <span style="color: #715ab1;">%</span> 0.5<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>future <span style="color: #2d9574;">(</span>swap! state update-in <span style="color: #67b11d;">[</span><span style="color: #4e3163;">:account</span><span style="color: #67b11d;">]</span> <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">do</span>
                                              <span style="color: #b1951d;">(</span><span style="color: #ba2f59; font-weight: bold;">Thread</span>/sleep 800<span style="color: #b1951d;">)</span>
                                              <span style="color: #b1951d;">(</span>println <span style="color: #2d9574;">"We have to pay taxes."</span><span style="color: #b1951d;">)</span>
                                              #<span style="color: #b1951d;">(</span>- <span style="color: #715ab1;">%</span> 180<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@state</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; {:account 200}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(multit)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Negotiations start...</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">#future[{:status :pending, :val nil} 0x499ef740]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">We have to pay taxes.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@state</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:account 20}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">They're ready to pay!</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@state</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:account 30.0}</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">multit-2</span> <span style="color: #6c3163;">[]</span>
  <span style="color: #6c3163;">(</span>future <span style="color: #2d9574;">(</span>swap! state update-in <span style="color: #67b11d;">[</span><span style="color: #4e3163;">:account</span><span style="color: #67b11d;">]</span>
                 <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">do</span>
                   <span style="color: #b1951d;">(</span>println <span style="color: #2d9574;">"Negotiations start..."</span><span style="color: #b1951d;">)</span>
                   <span style="color: #b1951d;">(</span><span style="color: #ba2f59; font-weight: bold;">Thread</span>/sleep 10000<span style="color: #b1951d;">)</span>
                   <span style="color: #b1951d;">(</span>println <span style="color: #2d9574;">"They're ready to pay!"</span><span style="color: #b1951d;">)</span>
                   <span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">They decided to support our budget by 50%</span>
                   #<span style="color: #b1951d;">(</span>+ <span style="color: #715ab1;">%</span> <span style="color: #3a81c3;">(</span>* <span style="color: #715ab1;">%</span> 0.5<span style="color: #3a81c3;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>future <span style="color: #2d9574;">(</span>swap! state update-in <span style="color: #67b11d;">[</span><span style="color: #4e3163;">:account</span><span style="color: #67b11d;">]</span> <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">do</span>
                                              <span style="color: #b1951d;">(</span>println <span style="color: #2d9574;">"We negotiate about taxes</span><span style="color: #6c4173;">..."</span><span style="color: #b1951d;">)</span>
                                              <span style="color: #b1951d;">(</span><span style="color: #ba2f59; font-weight: bold;">Thread</span>/sleep 15000<span style="color: #b1951d;">)</span>
                                              <span style="color: #b1951d;">(</span>println <span style="color: #2d9574;">"We have to pay taxes."</span><span style="color: #b1951d;">)</span>
                                              #<span style="color: #b1951d;">(</span>- <span style="color: #715ab1;">%</span> 180<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@state</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:account 200}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(multit-2)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Negotiations start...</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">We negotiate about taxes...</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">#future[{:status :pending, :val nil} 0x1ec207bd]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">They're ready to pay!</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@state</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:account 300.0}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">We have to pay taxes.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@state</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:account 120.0}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga485bfd" class="outline-4">
<h4 id="orga485bfd"><span class="section-number-4">3.5.2</span> Ref</h4>
<div class="outline-text-4" id="text-3-5-2">
<p>
Atomi nam daju mehanizam za rukovanje mutabilnim deljenim stanjem
kada je to stanje predstavljeno jednom vrednoÅ¡Äu. Kada je stanje
predstavljeno kroz <b>viÅ¡e vrednosti</b> i kada rukovanje stanjem
zahteva <b>koordinaciju</b> izmeÄu njih tu su Refs. KlasiÄan primer
koji se navodi kada se govori o ovoj vrsti deljenog stanje je
prenos sredstava izmeÄu raÄuna u banci. Refs u Clojure-u uvek
funkcioniÅ¡u kroz sistem za postizanje konkurentnosti koji se
koristi kod baza podataka &#x2014; transakcijama. Mehanizam koji
obezbeÄuje da se transakcije obavljaju na nivou programa se naziva
<a href="https://en.wikipedia.org/wiki/Software_transactional_memory">Software transactional memory</a>(STM) i ispunjava prva 3 naÄela <a href="https://en.wikipedia.org/wiki/ACID">ACID</a>
principa (Atomicity, Consistency, Isolation). Äetvrti (Durability)
naravno nije ispunjen po dizajnu jer je sve definisano na nivou
programa.
</p>

<p>
Ovaj, kao i verovatno veÄina kurseva koja se bave ovom temom u
svrhu ilustracije daÄe primer sa prenosom sredstava meÄu raÄunima
u banci ali Äemo za poÄetak da zaÅ¡to to ne moÅ¾emo da
implementiramo koristeÄi Atome:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc throw<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">throw</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(throw expr)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Special Form</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">The expr is evaluated and thrown, therefore it should</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">yield an instance of some derivee of Throwable.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Please see http://clojure.org/special_forms#throw</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">savings</span> <span style="color: #6c3163;">(</span>atom <span style="color: #2d9574;">{</span><span style="color: #4e3163;">:balance</span> 300<span style="color: #2d9574;">}</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">checking</span> <span style="color: #6c3163;">(</span>atom <span style="color: #2d9574;">{</span><span style="color: #4e3163;">:balance</span> 700<span style="color: #2d9574;">}</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">transfer</span>
  <span style="color: #da8b55;">"Transfer 200 from checking to savings."</span>
  <span style="color: #6c3163;">[]</span>
  <span style="color: #6c3163;">(</span>swap! checking assoc <span style="color: #4e3163;">:balance</span> 500<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">throw</span> <span style="color: #2d9574;">(</span>Exception. <span style="color: #2d9574;">"Something went wrong..."</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>swap! savings assoc <span style="color: #4e3163;">:balance</span> 500<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@savings</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 300}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@checking</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 700}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(transfer)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Exception Something went wrong...  clojure-ntp.atoms/transfer (form-init75671</span><span style="color: #6c4173; background-color: #ecf3ec;">72114564680926.clj:124)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@savings</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 300}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@checking</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 500}</span>
</pre>
</div>

<p>
Dakle, atomi nas ne Äuvaju od toga da akcija nad jednim uspe a nad
drugim ne uspe &#x2014; <span class="underline">nekoordinisani su</span>. I zato su tu Refs:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc dosync<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/dosync</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([&amp; exprs])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Macro</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Runs the exprs (in an implicit do) in a transaction that encompasses</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">exprs and any nested calls.  Starts a transaction if none is already</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">running on this thread. Any uncaught exception will abort the</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">transaction and flow out of dosync. The exprs may be run more than</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">once, but any effects on Refs will be atomic.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span>doc commute<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/commute</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([ref fun &amp; args])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Must be called in a transaction. Sets the in-transaction-value of</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">ref to:</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(apply fun in-transaction-value-of-ref args)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">and returns the in-transaction-value of ref.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">At the commit point of the transaction, sets the value of ref to be:</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(apply fun most-recently-committed-value-of-ref args)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Thus fun should be commutative, or, failing that, you must accept</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">last-one-in-wins behavior.  commute allows for more concurrency than</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">ref-set.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">savings</span> <span style="color: #6c3163;">(</span>ref <span style="color: #2d9574;">{</span><span style="color: #4e3163;">:balance</span> 300<span style="color: #2d9574;">}</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">checking</span> <span style="color: #6c3163;">(</span>ref <span style="color: #2d9574;">{</span><span style="color: #4e3163;">:balance</span> 700<span style="color: #2d9574;">}</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">transfer</span>
  <span style="color: #da8b55;">"Transfer 200 from checking to savings."</span>
  <span style="color: #6c3163;">[</span>&amp; e<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">dosync</span>
   <span style="color: #2d9574;">(</span>commute checking assoc <span style="color: #4e3163;">:balance</span> 500<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">when</span> e
     <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">throw</span> <span style="color: #b1951d;">(</span>Exception. <span style="color: #2d9574;">"Something went wrong..."</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>commute savings assoc <span style="color: #4e3163;">:balance</span> 500<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Flow when transaction fails and everything stay untouched (but consistent).</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@savings</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 300}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@checking</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 700}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(transfer true)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Exception Something went wrong...  clojure-ntp.atoms/transfer/fn--20417 (form</span><span style="color: #6c4173; background-color: #ecf3ec;">-init7567172114564680926.clj:192)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@savings</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 300}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@checking</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 700}</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Flow when transaction succeed and things change (in consistent manner).</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(transfer)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 500}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">savings</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 500}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">@checking</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:balance 500}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1ab0869" class="outline-3">
<h3 id="org1ab0869"><span class="section-number-3">3.6</span> Perzistentne strukture podataka</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Kako bismo lakÅ¡e razumeli efikasnost imutabinih/perzistentnih
struktura podataka u Clojure-u ovde Äemo pukaÅ¡ati da opiÅ¡emo Å¡ta se
tu ispod haube zapravo deÅ¡ava i Å¡ta se to taÄno <span class="underline">kopira</span> kada
Clojure "vraÄa vrednosti koje su nastale od prethodnih vrednosti".
</p>

<p>
Strukture podataka veÄine imperativnih programskih jezika koje ste
do sada koristili su uglavnom destruktivne prirode &#x2014; kada neÅ¡to
Å¾elite da izmenite to se bukvalno izmeni na mestu na kome se
nalazi. Ne moÅ¾ete viÅ¡e tu strukturu da prosleÄujete unaokolo po svom
programu bez bojazni da Äe se neko raÄunanje koje koristi tu
strukturu podataka "pokvariti".
</p>

<p>
Na primer, ako izmenite drugi element neke liste <i>L1</i> u programskom
jeziku kao Å¡to je Java, sadrÅ¾aj na tom mestu u memoriji je
promenjen i to viÅ¡e nije ona stara lista, stare <span class="underline">viÅ¡e nema</span> i sva
raÄunanja koja koriste ovu listu moraju to da prepoznaju i pravilno
reaguju.
</p>


<div class="figure">
<p><img src="images/Selection_001.png" alt="Selection_001.png" width="700" />
</p>
<p><span class="figure-number">Figure 4: </span>slika iz knjige <a href="http://www.wrox.com/WileyCDA/WroxTitle/Professional-Clojure.productCd-1119267277.html">Professional Clojure</a></p>
</div>

<p>
Clojure sa druge strane svoje strukture podataka implementira u
perzistentnom maniru, to znaÄi da svaki put kada pokuÅ¡ate da
izmenite vrednost zapravo <span class="underline">dobijete novu vrednost koja moÅ¾e da deli
neki deo strukture sa originalnom</span>. MoÅ¾da deljenje strukture na
prvi pogled moÅ¾e izgledati riziÄno ali poÅ¡to su svi delovi neke
vrednosti (npr. kolekcije) same po sebi imutabilne tu nema nikakvih
problema.
</p>

<p>
Pogledajmo sada isti primer "izmene" nekog elementa liste kod
Clojure-a. Ono Å¡to se zapravo dogaÄa je vraÄanje <span class="underline">nove liste</span> <i>L2</i>
koja je nastala kopiranjem svih elemenata originalne liste do onog
koji Å¾elimo da menjamo, a ostatak strukture deli sa originalnom.
</p>


<div class="figure">
<p><img src="images/Selection_002.png" alt="Selection_002.png" width="700" />
</p>
<p><span class="figure-number">Figure 5: </span>slika iz knjige <a href="http://www.wrox.com/WileyCDA/WroxTitle/Professional-Clojure.productCd-1119267277.html">Professional Clojure</a></p>
</div>

<p>
Da smo Å¾eleli da dodamo listu <i>L2</i> na kraj liste <i>L1</i> desilo bi se
kopiranje liste <i>L1</i> sa tim Å¡to bi pokazivaÄ na poslednjem elementu
nove liste <i>L2</i> pokazivao na poÄetak liste <i>L3</i>.
</p>


<div class="figure">
<p><img src="images/Selection_003.png" alt="Selection_003.png" width="700" />
</p>
<p><span class="figure-number">Figure 6: </span>slika iz knjige <a href="http://www.wrox.com/WileyCDA/WroxTitle/Professional-Clojure.productCd-1119267277.html">Professional Clojure</a></p>
</div>

<p>
<span class="underline">Imajte u vidu</span> da je osnovna motivacija za ovakvu implementaciju
bila <span class="underline">oÄuvanje itegriteta</span> podataka i zaÅ¡tita korektnosti
izraÄunavanja, a <span class="underline">ne puke performanse</span> koje mogu naruÅ¡iti
korektnost. Na ovom konkretnom primeru to znaÄi da sva raÄunanja
koja koriste <i>L1</i> mogu da nastave <span class="underline">kao da se niÅ¡ta nije desilo</span> &#x2014;
uÅ¡teda na vremenu i prostoru se oÄekuje ovde.
</p>

<p>
Kako bismo stekli bolji oseÄaj o funkcionisanju perzistentnih
struktura podataka pogledajmo kako bismo implementirali binarno
stablo:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">ns</span> <span style="color: #ba2f59; font-weight: bold;">clojure-ntp.persistent-datastructures</span>
  <span style="color: #da8b55;">"This code is borrowed from the book Professional Clojure."</span>
  <span style="color: #6c3163;">(</span><span style="color: #4e3163;">:require</span> <span style="color: #2d9574;">[</span>clojure.repl <span style="color: #4e3163;">:refer</span> <span style="color: #67b11d;">[</span>doc<span style="color: #67b11d;">]</span><span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defprotocol</span> <span style="color: #ba2f59; font-weight: bold;">INode</span>
  <span style="color: #6c3163;">(</span>entry <span style="color: #2d9574;">[</span>_<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>left <span style="color: #2d9574;">[</span>_<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>right <span style="color: #2d9574;">[</span>_<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>contains-value? <span style="color: #2d9574;">[</span>_ _<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>insert-value <span style="color: #2d9574;">[</span>_ _<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">deftype</span> <span style="color: #ba2f59; font-weight: bold;">Node</span> <span style="color: #6c3163;">[</span>value left-branch right-branch<span style="color: #6c3163;">]</span>
  INode
  <span style="color: #6c3163;">(</span>entry <span style="color: #2d9574;">[</span>_<span style="color: #2d9574;">]</span> value<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>left <span style="color: #2d9574;">[</span>_<span style="color: #2d9574;">]</span> left-branch<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>right <span style="color: #2d9574;">[</span>_<span style="color: #2d9574;">]</span> right-branch<span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>contains-value? <span style="color: #2d9574;">[</span>tree v<span style="color: #2d9574;">]</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span>
      <span style="color: #67b11d;">(</span>= v value<span style="color: #67b11d;">)</span> <span style="color: #4e3163;">true</span>
      <span style="color: #67b11d;">(</span>&lt; v value<span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>contains-value? left-branch v<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>&gt; v value<span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>contains-value? right-branch v<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>insert-value <span style="color: #2d9574;">[</span>tree v<span style="color: #2d9574;">]</span>
    <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">cond</span>
      <span style="color: #67b11d;">(</span>= v value<span style="color: #67b11d;">)</span> tree
      <span style="color: #67b11d;">(</span>&lt; v value<span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>Node. value <span style="color: #b1951d;">(</span>insert-value left-branch v<span style="color: #b1951d;">)</span> right-branch<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>&gt; v value<span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>Node. value left-branch <span style="color: #b1951d;">(</span>insert-value right-branch v<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>extend-protocol INode
  <span style="color: #4e3163;">nil</span>
  <span style="color: #6c3163;">(</span>entry <span style="color: #2d9574;">[</span>_<span style="color: #2d9574;">]</span> <span style="color: #4e3163;">nil</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>left <span style="color: #2d9574;">[</span>_<span style="color: #2d9574;">]</span> <span style="color: #4e3163;">nil</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>right <span style="color: #2d9574;">[</span>_<span style="color: #2d9574;">]</span> <span style="color: #4e3163;">nil</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>contains-value? <span style="color: #2d9574;">[</span>_ _<span style="color: #2d9574;">]</span> <span style="color: #4e3163;">false</span><span style="color: #6c3163;">)</span>
  <span style="color: #6c3163;">(</span>insert-value <span style="color: #2d9574;">[</span>_ value<span style="color: #2d9574;">]</span> <span style="color: #2d9574;">(</span>Node. value <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Pogledajmo sada kako bismo pravili stablo:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">root</span> <span style="color: #6c3163;">(</span>-&gt;Node 7 <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span>left root<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; nil</span>
<span style="color: #3a81c3;">(</span>right root<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; nil</span>
<span style="color: #3a81c3;">(</span>entry root<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 7</span>
<span style="color: #3a81c3;">(</span>contains-value? root 7<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span>contains-value? root 23<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>
</pre>
</div>

<p>
Super! Hajde sada da napravimo neko malo zanimljivije stablo:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">root</span> <span style="color: #6c3163;">(</span>Node. 7 <span style="color: #2d9574;">(</span>Node. 5 <span style="color: #67b11d;">(</span>Node. 3 <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #67b11d;">)</span> <span style="color: #4e3163;">nil</span><span style="color: #2d9574;">)</span>
                 <span style="color: #2d9574;">(</span>Node. 12 <span style="color: #67b11d;">(</span>Node. 9 <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span>Node. 17 <span style="color: #4e3163;">nil</span> <span style="color: #4e3163;">nil</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Kod od gore bi trebao da odgovara stablu ispod:
</p>


<div class="figure">
<p><img src="images/Selection_004.png" alt="Selection_004.png" width="700" />
</p>
<p><span class="figure-number">Figure 7: </span>slika iz knjige <a href="http://www.wrox.com/WileyCDA/WroxTitle/Professional-Clojure.productCd-1119267277.html">Professional Clojure</a></p>
</div>

<p>
Pa hajde da to validiramo:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>left root<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #object[clojure_ntp.persistent_datastructures.Node 0x5c0500d7</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;            </span><span style="color: #2aa1ae; background-color: #ecf3ec;">"clojure_ntp.persistent_datastructures.Node@5c0500d7"]</span>

<span style="color: #3a81c3;">(</span>entry <span style="color: #6c3163;">(</span>left root<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 5</span>

<span style="color: #3a81c3;">(</span>entry <span style="color: #6c3163;">(</span>left <span style="color: #2d9574;">(</span>left root<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 3</span>

<span style="color: #3a81c3;">(</span>entry <span style="color: #6c3163;">(</span>right root<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 12</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;</span> root
    right
    left
    entry<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 9</span>
</pre>
</div>

<p>
Hajde sada da ispitamo identite levih i desnih podstabala naÅ¡eg stabla:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>doc identity<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.core/identity</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([x])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns its argument.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nil</span>

<span style="color: #3a81c3;">(</span>identity <span style="color: #6c3163;">(</span>left root<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #object[clojure_ntp.persistent_datastructures.Node 0x5c0500d7</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;            </span><span style="color: #2aa1ae; background-color: #ecf3ec;">"clojure_ntp.persistent_datastructures.Node@5c0500d7"]</span>

<span style="color: #3a81c3;">(</span>identity <span style="color: #6c3163;">(</span>right root<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #object[clojure_ntp.persistent_datastructures.Node 0x45a2d58d</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;            </span><span style="color: #2aa1ae; background-color: #ecf3ec;">"clojure_ntp.persistent_datastructures.Node@45a2d58d"]</span>
</pre>
</div>

<p>
Ono na Å¡ta treba da obratimo paÅ¾nju su konkretne adrese na kojima
se nalaze identiteti naÅ¡ih Ävorova koji predstavljaju levo i desno
podstablo.
</p>

<p>
Hajde sada da da dodamo jedan Ävor sa vrednoÅ¡Äu 6 u stablo
(naravno, nema mutiranja, dobijamo potpuno novo stablo):
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">l</span> <span style="color: #6c3163;">(</span>insert-value root 6<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
<b>Å ta je ovde sad kopirano a Å¡ta se deli?</b>
</p>

<p>
Ispitajmo leva i desna podstabla naÅ¡eg novog stabla:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>identity <span style="color: #6c3163;">(</span>left l<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #object[clojure_ntp.persistent_datastructures.Node 0x12b6354b</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;            </span><span style="color: #2aa1ae; background-color: #ecf3ec;">"clojure_ntp.persistent_datastructures.Node@12b6354b"]</span>
<span style="color: #3a81c3;">(</span>entry <span style="color: #6c3163;">(</span>left l<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 5</span>

<span style="color: #3a81c3;">(</span>identity <span style="color: #6c3163;">(</span>right l<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #object[clojure_ntp.persistent_datastructures.Node 0x45a2d58d</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;            </span><span style="color: #2aa1ae; background-color: #ecf3ec;">"clojure_ntp.persistent_datastructures.Node@45a2d58d"]</span>
<span style="color: #3a81c3;">(</span>entry <span style="color: #6c3163;">(</span>right l<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 12</span>
</pre>
</div>

<p>
Levo podstablo nam nije poznato (po adresi, po identitetu) ali
desno jeste&#x2026;
</p>

<p>
<span class="underline">to je taj isti identitet koji ujedno predstavlja i desno podstablo
poÄetnog stabla</span>!
</p>

<p>
Dakle, ono Å¡to smo zapravo napravili je struktura kao na slici ispod:
</p>


<div class="figure">
<p><img src="images/Selection_005.png" alt="Selection_005.png" width="700" />
</p>
<p><span class="figure-number">Figure 8: </span>slika iz knjige <a href="http://www.wrox.com/WileyCDA/WroxTitle/Professional-Clojure.productCd-1119267277.html">Professional Clojure</a></p>
</div>

<p>
Dakle, <b>desilo se neko kopiranje</b> ali je <b>neki deo strukture
deljen</b> i nije se kopirao. Oni koji Å¾ele da znaju koji se taÄno deo
kopira a koji se deli kao i kako se to raÄuna mogu svoje Äitanje da
nastave na nekom od sledeÄih mesta:
</p>
<ul class="org-ul">
<li>blog <a href="http://hypirion.com/musings/understanding-persistent-vector-pt-1">Polymatheia</a></li>
<li>Higher Order Blog (<a href="http://blog.higher-order.net/2009/02/01/understanding-clojures-persistentvector-implementation">ovde</a> i <a href="http://blog.higher-order.net/2009/09/08/understanding-clojures-persistenthashmap-deftwice">ovde</a>)</li>
</ul>

<p>
Ovaj kurs ne pokriva dublju priÄu na ovu temu ali Vam je toplo
preporuÄuje. :)
</p>
</div>
</div>

<div id="outline-container-org3c3e50f" class="outline-3">
<h3 id="org3c3e50f"><span class="section-number-3">3.7</span> Clojure u standardnim OO problemima</h3>
</div>
</div>
<div id="outline-container-org3cb455c" class="outline-2">
<h2 id="org3cb455c"><span class="section-number-2">4</span> Read, evaluate vrtlog i makroi</h2>
<div class="outline-text-2" id="text-4">
<blockquote>
<p>
Sve navedeno u ovom poglavlju vaÅ¾i za Clojure kako i za sve ostale
Lisp jezike i obrnuto, osim ako drugaÄije nije naznaÄeno.
</p>
</blockquote>

<p>
Programski jezici koji spadaju u porodicu Lisp jezika imaju korisnu
i zanimljivu osobinu da mogu veoma elegantno da transformiÅ¡u <span class="underline">bilo
kakve izraze</span> u validan kod. Å ta to praktiÄno znaÄi:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defmacro</span> <span style="color: #6c3163; font-weight: bold;">hebrew-lisp</span> <span style="color: #6c3163;">[</span>form<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>reverse form<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>hebrew-lisp <span style="color: #6c3163;">(</span><span style="color: #2d9574;">(</span>str <span style="color: #2d9574;">"Hello "</span> p<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">[</span>p<span style="color: #2d9574;">]</span> foo defn<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>foo <span style="color: #2d9574;">"people!"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Hello people!</span>

<span style="color: #3a81c3;">(</span>hebrew-lisp <span style="color: #6c3163;">(</span><span style="color: #2d9574;">"people!"</span> foo<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Hello people!</span>
</pre>
</div>

<p>
Sve gore navedeno radi fino iako sledeÄi izrazi uopÅ¡te nisu
sintaktiÄki validni u Clojure-u:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(((str "Hello " p) [p] foo defn))</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; CompilerException java.lang.RuntimeException: Unable to resolve symbol:</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;    </span><span style="color: #2aa1ae; background-color: #ecf3ec;">p in this context, compiling:...</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">("people!" foo)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; ClassCastException java.lang.String cannot be cast to clojure.lang.IFn</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;    </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure-ntp.macros/eval20385 (form-init7854233134659944327.clj:14)</span>
</pre>
</div>

<p>
Ova osobina nam omoguÄuje da jednostavno <span class="underline">menjamo jezik</span> u kome
programiramo shodno problemu koji reÅ¡avamo naÅ¡im programom. To na
kraju dovodi do momenta kada svoj program moÅ¾emo da piÅ¡emo
<span class="underline">direktno preslikavajuÄi</span> svoje znanje iz domena problema na
kod. Tako dobijamo maksimalnu ekspresivnost (deklerativnost) koda i
minimalan prostor za greÅ¡ke u domenu problema koji reÅ¡avamo.
</p>

<p>
Filozofija koja stoji iza makroa je sledeÄa:
</p>

<blockquote>
<p>
Ako pravite WEB aplikaciju &#x2014; programirajte jezikom WEB-a (a ne
jezikom opÅ¡te namene).
</p>

<p>
Ako pravite grafiÄki interfejs &#x2014; programirajte jezikom grafiÄkih
interfejsa (a ne jezikom opÅ¡te namene).
</p>

<p>
Ako programirate sistem za genetska istraÅ¾ivanja &#x2014; programirajte
jezikom genetike (a ne jezikom opÅ¡te namene).
</p>

<p>
&#x2026;
</p>
</blockquote>

<p>
Ono Å¡to Vam Cljure pruÅ¾a u duhu ove filozofije je veoma moÄan a
lagan sistem u kome moÅ¾ete da piÅ¡ete VaÅ¡e nove jezike. Taj sistem
Äak <span class="underline">nije nadgradnja</span> Lisp-a veÄ je u <span class="underline">osnovi njegove
konstrukcije</span>, u temeljima &#x2014; u <i>evaluation model</i>-u.
</p>
</div>

<div id="outline-container-org2ab0932" class="outline-3">
<h3 id="org2ab0932"><span class="section-number-3">4.1</span> <i>Evaluation Model</i> Clojure-a</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Lisp ima model izvrÅ¡avanja koji se u osnovi razlikuje od ostalih
programskih jezika. Taj sistem radi u dve faze &#x2014; Äita se kod kao
tekst i od njega se pravi Lisp struktura podataka. Te strukture
podataka se potom evaluiraju(izraÄunavaju): obilazi se struktura i
rade se razne akcije nad njom na osnovu tipa izraza.
</p>

<p>
Npr. kada Lisp Äita tekst <code>(+ 1 2)</code> u prvoj fazi se dobija Lisp
lista Äiji je prvi element <code>+</code> a potom idu brojevi 1 i 2. Ta Lista
se onda Å¡alje evaluatoru koji potraÅ¾i funkciju koja odgovara
simbolu <code>+</code> i primeni je na brojeve 1 i 2.
</p>

<p>
Jezici koji imaju ovakvu vezu izmeÄu koda, podataka i izvrÅ¡avanja
se nazivaju <b>homoikoniÄnim</b>.
</p>

<blockquote>
<p>
HomoikoniÄni jezici Vam daju moÄ da na kod gledate kao na strukturu
podataka koja se moÅ¾e programski menjati.
</p>
</blockquote>

<p>
Kako bismo objasnili naÄin nakoji je ovo izvedeno hajde da
napravimo jedan mali osvrt na kompajlere i proces kompaanja:
Programski kod je samo skup karaktera a kompjuter razume samo
maÅ¡inske instrukcije. Dakle, da bi maÅ¡ina mogla da izvrÅ¡ava kod
potreban nam je interpreter ili kompajler. Tokom svog rada
kompajler konstruiÅ¡e stablo apstrakne sintakse (AST) &#x2014; strukturu
podataka koja predstavlja program. AST se potom prosledi evaluatoru
na izvrÅ¡avanje. Evaluator moÅ¾ete zamisliti kao funkciju koja
obilazi stablo i pravi maÅ¡inske instrukcije za Ävorove kroz koje
prolazi.
</p>

<p>
Dakle, proces kompajliranja popriliÄno podseÄa na ono Å¡to radi
Lisp. MeÄutim, kod veÄine programskih jezika AST nije dostupno u
programskom jeziku. Prostor u kome deluje kompajler i prostor u
koje deluje sam programski jezik su razdvojeni. Proces
kompajliranja izvrÅ¡avanja u ne-Lisp jezicima moÅ¾ete zamisliti na
sledeÄi naÄin:
</p>


<div class="figure">
<p><img src="images/Selection_006.png" alt="Selection_006.png" width="500" />
</p>
<p><span class="figure-number">Figure 9: </span>Ilustracija iz knjige <a href="http://www.braveclojure.com/read-and-eval/">Clojure For The Brave And True</a></p>
</div>

<p>
Za razliku od veÄine programskih jezika Lisp svoje apstraktno
sintaksno stablo predstavlja u obliku svojih struktura podataka &#x2014;
ugnjeÅ¾denih listi. Evo jedne ilustracije koja pokazuje da su Lisp
izrazi zapravo veÄ sami posebi jedan naÄin predstave stabla:
</p>


<div class="figure">
<p><img src="images/Selection_007.png" alt="Selection_007.png" width="500" />
</p>
<p><span class="figure-number">Figure 10: </span>Ilustracija iz knjige <a href="http://www.braveclojure.com/read-and-eval/">Clojure For The Brave And True</a></p>
</div>

<p>
Dakle, Clojure <i>reader</i> dobije na ulaz tekst a na izlazu da AST u
obliku Clojure listi koje kasnije prosledi evaluatoru. Proces
izvrÅ¡avanja Lisp-a moÅ¾ete zamisliti na sledeÄi naÄin:
</p>


<div class="figure">
<p><img src="images/Selection_008.png" alt="Selection_008.png" width="500" />
</p>
<p><span class="figure-number">Figure 11: </span>Ilustracija iz knjige <a href="http://www.braveclojure.com/read-and-eval/">Clojure For The Brave And True</a></p>
</div>

<p>
Dakle, <b>Lisp kod je zapravo Lisp struktura podataka</b>. Da bismo
pokazali da je to stvarno tako evo primera koji pokazuje da su
<i>evaluator</i> i <i>reader</i> <span class="underline">dostupni u svakom vaÅ¡em programu</span>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;</span> <span style="color: #2d9574;">"(defn foo [p] (println (str p </span><span style="color: #2d9574; font-weight: bold;">\"</span><span style="color: #2d9574;"> from some function foo.</span><span style="color: #2d9574; font-weight: bold;">\"</span><span style="color: #2d9574;">)))"</span>
    read-string
    eval<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #'clojure-ntp.macros/foo</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;</span> <span style="color: #2d9574;">"(foo </span><span style="color: #2d9574; font-weight: bold;">\"</span><span style="color: #2d9574;">Some text</span><span style="color: #2d9574; font-weight: bold;">\"</span><span style="color: #2d9574;">)"</span>
    read-string
    eval<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Some text printed from some function foo.</span>
</pre>
</div>

<p>
PoÅ¡to je Clojure homoikoniÄan zaÅ¡to bismo pisali stringove? Hajde
da piÅ¡emo <b>liste == kod</b>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>eval '<span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">foo</span>
         <span style="color: #2d9574;">[</span>p<span style="color: #2d9574;">]</span>
         <span style="color: #2d9574;">(</span>println <span style="color: #67b11d;">(</span>str p <span style="color: #2d9574;">" printed from some function foo."</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #'clojure-ntp.macros/foo</span>

<span style="color: #3a81c3;">(</span>eval '<span style="color: #6c3163;">(</span>foo <span style="color: #2d9574;">"Some text"</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Some text printed from some function foo.</span>
</pre>
</div>

<p>
Ali liste su podrazumevane strukture podataka u Lispu a evaluator
se poziva implicitno :) Pa je tako sve ovo prosto ekvivalentno sa:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">foo</span>
  <span style="color: #6c3163;">[</span>p<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>println <span style="color: #2d9574;">(</span>str p <span style="color: #2d9574;">" printed from some function foo."</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #'clojure-ntp.macros/foo</span>

<span style="color: #3a81c3;">(</span>foo <span style="color: #2d9574;">"Some text"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Some text printed from some function foo.</span>

<span style="color: #3a81c3;">(</span>list? <span style="color: #6c3163;">(</span>read-string <span style="color: #2d9574;">"(+ 1 2)"</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
</pre>
</div>

<p>
Sada kada nam je potpuno jasno kako Lisp radi hajde da pokuÅ¡amo da
razumemo Å¡ta se taÄno deÅ¡ava sa makroom na poÄetku:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defmacro</span> <span style="color: #6c3163; font-weight: bold;">hebrew-lisp</span> <span style="color: #6c3163;">[</span>form<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>reverse form<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>hebrew-lisp <span style="color: #6c3163;">(</span><span style="color: #2d9574;">(</span>str <span style="color: #2d9574;">"Hello "</span> p<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">[</span>p<span style="color: #2d9574;">]</span> foo defn<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>foo <span style="color: #2d9574;">"people!"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Hello people!</span>

<span style="color: #3a81c3;">(</span>hebrew-lisp <span style="color: #6c3163;">(</span><span style="color: #2d9574;">"people!"</span> foo<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Hello people!</span>
</pre>
</div>

<p>
Da bismo ovo razumeli potrebno nam je da joÅ¡ detaljnije pogledamo
kako izgleda proces izvrÅ¡avanja Lisp-a. Zato hajde napiÅ¡emo joÅ¡
jedan mali makro:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defmacro</span> <span style="color: #6c3163; font-weight: bold;">infix</span> <span style="color: #6c3163;">[</span>form<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>list
   <span style="color: #2d9574;">(</span>second form<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>first form<span style="color: #2d9574;">)</span>
   <span style="color: #2d9574;">(</span>last form<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>infix <span style="color: #6c3163;">(</span>1 + 2<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 3</span>
</pre>
</div>

<p>
I pogledajmo kako teÄe izvrÅ¡avanje ovog malog programa:
</p>


<div class="figure">
<p><img src="images/Selection_009.png" alt="Selection_009.png" width="200" />
</p>
<p><span class="figure-number">Figure 12: </span>Ilustracija iz knjige <a href="http://www.braveclojure.com/read-and-eval/">Clojure For The Brave And True</a></p>
</div>

<p>
Dakle, Lisp kod u obliku teksta se izvrÅ¡ava tako Å¡to se prvo
proÄita <b>reader</b>-om onda se razviju svi makroi <b>makroexpander</b>-om i
rezultujuÄa struktura podataka se preda <b>evaluator</b>-u.
</p>

<p>
Kako bismo utvrdili da je jasno Å¡ta se deÅ¡ava pogledajmo joÅ¡ jedan
makro:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>read-string <span style="color: #2d9574;">"(defmacro hebrew-lisp [form] (reverse form))"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (defmacro hebrew-lisp [form] (reverse form))</span>

<span style="color: #3a81c3;">(</span>eval <span style="color: #6c3163;">(</span>read-string <span style="color: #2d9574;">"(defmacro hebrew-lisp [form] (reverse form))"</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #'clojure-ntp.macros/hebrew-lisp</span>

<span style="color: #3a81c3;">(</span>macroexpand <span style="color: #6c3163;">(</span>read-string <span style="color: #2d9574;">"(hebrew-lisp ((str </span><span style="color: #2d9574; font-weight: bold;">\"</span><span style="color: #2d9574;">Hello </span><span style="color: #2d9574; font-weight: bold;">\"</span><span style="color: #2d9574;"> p) [p] foo defn))"</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (def foo (clojure.core/fn ([p] (str "Hello " p))))</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;</span> <span style="color: #2d9574;">"(hebrew-lisp ((str </span><span style="color: #2d9574; font-weight: bold;">\"</span><span style="color: #2d9574;">Hello </span><span style="color: #2d9574; font-weight: bold;">\"</span><span style="color: #2d9574;"> p) [p] foo defn))"</span>
    read-string
    macroexpand
    eval<span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>foo <span style="color: #2d9574;">"good people"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Hello good people</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgacf3735" class="outline-3">
<h3 id="orgacf3735"><span class="section-number-3">4.2</span> Neki poznati <i>reader</i> makroi</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Znamo da anonimnu funkciju u Clojure moÅ¾emo da napiÅ¡emo na viÅ¡e
naÄina i da je jedan od njih <code>#(...)</code>, drugi <code>(fn [...] ...)</code>. Kako
to radi?
</p>

<p>
<b>Kao <i>reader</i> makro</b>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>read-string <span style="color: #2d9574;">"#(println %)"</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Dakle, struktura podataka koja izaÄe iz <i>reader</i>-a kada koristimo
jedan naÄin i kada koristimo drugi naÄin je zapravo jedno te isto.
</p>

<p>
Na sliÄan naÄin je napravljeno citiranje sintakse u Clojure:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>read-string <span style="color: #2d9574;">"#(println %)"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (fn* [p1__20475#] (println p1__20475#))</span>
</pre>
</div>

<p>
TakoÄe i dereferenciranje:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>read-string <span style="color: #2d9574;">"'(1 2 3)"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (quote (1 2 3))</span>
</pre>
</div>

<p>
I komentari su izvedeni na taj naÄin:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>read-string <span style="color: #2d9574;">"@a"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (clojure.core/deref a)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org226b23d" class="outline-3">
<h3 id="org226b23d"><span class="section-number-3">4.3</span> <i>Homoiconicity</i> &#x2014; "istoizglednost"</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Razmotrite ovaj crteÅ¾ i primetite kako fleksibilnost <i>evaluation
model</i>-a Lispa utiÄe na dizajn programa koji su pisani u
njemu. <i>HomoikoniÄnost</i> jezika Äini implementaciju Äitavog niza
alata konceptualno trivijalnim (mackroi, validacija podataka i
generativno testiranje &#x2014; <a href="#org64ae815">Clojure.spec</a>, transfer podataka &#x2014; <a href="https://github.com/edn-format/edn">EDN</a>,
konfiguracija&#x2026;).
</p>


<div class="figure">
<p><img src="images/franca_homoiconicy_clojure.jpg" alt="franca_homoiconicy_clojure.jpg" width="700" />
</p>
<p><span class="figure-number">Figure 13: </span><a href="https://twitter.com/franschm">@franschm</a></p>
</div>

<p>
Primetimo da u jezicima koji nisu <i>homoikoniÄni</i> vaÅ¾i pravilo:
</p>

<p>
<b>Kod je Kralj, podaci se zamiÅ¡ljaju.</b>
</p>

<p>
Dok kod jezika koji su <i>homoikoniÄni</i> situacija nije tako
striktna. Kod u koji gledamo su zapravo podaci, ne moramo da ih
zamiÅ¡ljamo.
</p>

<blockquote>
<p>
Lisp je definisan u terminima sopstvenih struktura podataka a ne u
terminima tekstualne sintakse. <a href="https://clojure.org/reference/reader">MoÅ¾emo reÄi</a> da je sintaksa Lispa
data u strukturama podataka Lispa.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgc73fafc" class="outline-3">
<h3 id="orgc73fafc"><span class="section-number-3">4.4</span> NavoÄenje sintakse &#x2014; <i>syntax quoting</i></h3>
<div class="outline-text-3" id="text-4-4">
<p>
Sav Lisp kod je ujedno i struktura podataka, a izvrÅ¡avanje svodi na
izraÄunavanje struktura podataka. Ako pak nekada <span class="underline">ne Å¾elimo</span> da
neka <b>struktura podataka == kod</b> bude raÄunata treba da je
<i>quote</i>-ujemo.
</p>

<p>
Za sve forme koje nisu simboli, liste, vektori, skupovi i mape je
<code>`x</code> (<i>syntax quoting</i>) isto Å¡to i <code>'x</code> (obiÄan <code>(quote x)</code>). Za
simbole, liste, vektore, skupove i mape <i>syntax quoting</i> (<code>`</code>) radi
rekurzivno <i>quote</i>-ovanje &#x2014; za svaku strukturu <i>quote</i>-uje sve
unutar nje, do najdublje strukture.
</p>

<p>
Sada je pitanje Å¡ta ako u okviru neke forme koju smo <i>syntax
quote</i>-ovali Å¾elimo da izvrÅ¡imo neki mali deo. Stvar koja nam to
omoguÄava se zove <i>unquoting</i>. Ako Å¾elimo da <i>unquote</i>-ujemo formu
to radimo sa <code>~</code> ispred nje. Dakle:
</p>

<div class="org-src-container">
<pre class="src src-clojure">`<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">a1</span> <span style="color: #6c3163;">(</span>+ 1 2<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (def clojure-ntp.macros/a1 (clojure.core/+ 1 2))</span>

`<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">a2</span> <span style="color: #6c3163;">(</span>* 43 ~<span style="color: #2d9574;">(</span>+ 1 2<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (def clojure-ntp.macros/a2 (clojure.core/* 43 3))</span>

`~<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">a3</span> <span style="color: #6c3163;">(</span>* 43 <span style="color: #2d9574;">(</span>+ 1 2<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; #'clojure-ntp.macros/a3</span>

a3
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 129</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">a1</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Error: Unable to resolve symbol: a1 in this context</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">a2</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Error: Unable to resolve symbol: a2 in this context</span>
</pre>
</div>

<p>
TakoÄe postoji i naÄin da <i>unquote</i>-ujete neku formu i da je pri
tome "odvijete iz zagrada" &#x2014; <i>unquote-splicing</i> <code>~@</code>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">let</span> <span style="color: #6c3163;">[</span>forms `<span style="color: #2d9574;">(</span>+ <span style="color: #67b11d;">[</span>1 2 3<span style="color: #67b11d;">]</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">]</span>
  `<span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">b</span> <span style="color: #2d9574;">(</span>apply ~@forms<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (def clojure-ntp.macros/b (clojure.core/apply clojure.core/+ [1 2 3]))</span>
</pre>
</div>

<p>
Za joÅ¡ priÄe o <i>quoting</i>-u pogledajte <a href="https://8thlight.com/blog/colin-jones/2012/05/22/quoting-without-confusion.html">ovaj</a> post.
</p>
</div>
</div>

<div id="outline-container-org43670df" class="outline-3">
<h3 id="org43670df"><span class="section-number-3">4.5</span> Reader conditionals (.cljc)</h3>
</div>

<div id="outline-container-orgc3dc549" class="outline-3">
<h3 id="orgc3dc549"><span class="section-number-3">4.6</span> VeÅ¾banje 2</h3>
<div class="outline-text-3" id="text-4-6">
<ol class="org-ol">
<li><p>
KoristeÄi makroe proÅ¡iriti Clojure tako da se u njemu mogu
definisati funkcije koriÅ¡Äenjem srpske reÄi za to "Ð´ÐµÑÐ¸Ð½Ð¸ÑÐ¸-Ñ"
(Clojure podrÅ¾ava <a href="https://en.wikipedia.org/wiki/Unicode">Unicode</a>, moÅ¾ete slobodno da piÅ¡ete Äirilicom):
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>&#1076;&#1077;&#1092;&#1080;&#1085;&#1080;&#1096;&#1080;-&#1092; &#1079;&#1076;&#1088;&#1072;&#1074;&#1086;
  <span style="color: #6c3163;">[]</span>
  <span style="color: #6c3163;">(</span>println <span style="color: #2d9574;">"&#1047;&#1076;&#1088;&#1072;&#1074;&#1086; &#1089;&#1074;&#1080;&#1084;&#1072;!"</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>&#1079;&#1076;&#1088;&#1072;&#1074;&#1086;<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; &#1047;&#1076;&#1088;&#1072;&#1074;&#1086; &#1089;&#1074;&#1080;&#1084;&#1072;!</span>

<span style="color: #3a81c3;">(</span>&#1076;&#1077;&#1092;&#1080;&#1085;&#1080;&#1096;&#1080;-&#1092; &#1072;&#1088;&#1080;&#1090;&#1084;&#1077;&#1090;&#1080;&#1095;&#1082;&#1072;-&#1089;&#1088;&#1077;&#1076;&#1080;&#1085;&#1072;
  <span style="color: #6c3163;">[</span>&#1073;&#1088;&#1086;&#1112;&#1077;&#1074;&#1080;<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>/ <span style="color: #2d9574;">(</span>apply + &#1073;&#1088;&#1086;&#1112;&#1077;&#1074;&#1080;<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;</span> &#1073;&#1088;&#1086;&#1112;&#1077;&#1074;&#1080;
                           count
                           double<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>&#1072;&#1088;&#1080;&#1090;&#1084;&#1077;&#1090;&#1080;&#1095;&#1082;&#1072;-&#1089;&#1088;&#1077;&#1076;&#1080;&#1085;&#1072; <span style="color: #6c3163;">(</span>range 10<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 4.5</span>
</pre>
</div>

<p>
VaÅ¡e je da definiÅ¡ete makro <code>Ð´ÐµÑÐ¸Ð½Ð¸ÑÐ¸-Ñ</code>.
</p>

<p>
ReÅ¡enje:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defmacro</span> <span style="color: #6c3163; font-weight: bold;">&#1076;&#1077;&#1092;&#1080;&#1085;&#1080;&#1096;&#1080;-&#1092;</span> <span style="color: #6c3163;">[</span>name params form<span style="color: #6c3163;">]</span>
  `<span style="color: #6c3163;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> ~name ~<span style="color: #2d9574;">(</span>vec params<span style="color: #2d9574;">)</span> ~form<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div></li>

<li>UÄinite isto i za funkcije <code>println</code>, <code>count</code> i <code>apply</code>
(ÄiriliÄna imena za njih se prepuÅ¡taju VaÅ¡oj maÅ¡ti).</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org154433d" class="outline-2">
<h2 id="org154433d"><span class="section-number-2">5</span> Konkurentno i paralelno programiranje</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgfe236de" class="outline-3">
<h3 id="orgfe236de"><span class="section-number-3">5.1</span> Reference</h3>
</div>

<div id="outline-container-org7daac66" class="outline-3">
<h3 id="org7daac66"><span class="section-number-3">5.2</span> core.async</h3>
</div>
</div>

<div id="outline-container-orgd4d2964" class="outline-2">
<h2 id="orgd4d2964"><span class="section-number-2">6</span> Interakcija sa platformom</h2>
</div>
<div id="outline-container-org63f8201" class="outline-2">
<h2 id="org63f8201"><span class="section-number-2">7</span> Apstrakcije</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org0a31aff" class="outline-3">
<h3 id="org0a31aff"><span class="section-number-3">7.1</span> Multimethods</h3>
</div>

<div id="outline-container-org752e564" class="outline-3">
<h3 id="org752e564"><span class="section-number-3">7.2</span> Protocols</h3>
</div>

<div id="outline-container-org4e803c7" class="outline-3">
<h3 id="org4e803c7"><span class="section-number-3">7.3</span> Records</h3>
</div>

<div id="outline-container-org64ae815" class="outline-3">
<h3 id="org64ae815"><span class="section-number-3">7.4</span> clojure.spec</h3>
<div class="outline-text-3" id="text-7-4">
<p>
Clojure je dinamiÄki programski jezik i kao takvom mu nisu
neophodne anotacije tipova u vreme kompajliranja. Iako Clojure ima
<i>type hints</i> oni nisu ni obavezni a ni dovoljno bogat mehanizam veÄ
samo sluÅ¾e da pomognu kompajleru kako bi rezultujuÄi kod bio Å¡to
efikasniji. Ipak, u Clojure zajednici je uvek bila praksa da se
koriste razliÄite biblioteke za opis oblika podataka i predikatskih
pravila koja se proveravaju u vreme izvrÅ¡avanja. Komentari, koji su
osnovni mehanizam u dinamiÄkim programskim jezicima, mogu da
posluÅ¾e za komunikaciju sa Äovekom ali u automatskoj proveri ili
testiranju i ne baÅ¡.
</p>

<p>
PoÄetnicima u Clojure svetu poruke o greÅ¡ci koje potiÄu iz ruÄnog
parsiranja podataka ili restruktuiranja Äestu deluju nejasno
(posebno kada one doÄu od makroa). U ovom sluÄaju deklerativni opis
podataka moÅ¾e mnogo da pomogne u razumevanju greÅ¡ke.
</p>

<p>
Ako govorimo o testiranju onda je <i>property based testing</i> tehnika
koja nam omoguÄuje mnogo pouzdanije testove od onih koje bismo
napisali ruÄno. Kako bi se testovi mogli generisati (npr. pomoÄu
<a href="https://github.com/clojure/test.check">test.check</a>) potreban je dobar opis podataka a to je upravo posao
<a href="https://clojure.org/about/spec">clojure.spec</a>-a.
</p>

<p>
Pored svih svoji osobina <i>clojure.spec</i> <span class="underline">nije</span> <i>type system</i> &#x2014;
<i>type</i> sistemi uzimaju za korektno samo ono Å¡to je formalno
dokazivo, <i>clojure.spec</i> dozvoljava veÄu ekspresivnost u opisu ali
sa druge strane ne teÅ¾i nikakvom formalnom dokazu
korektnosti. TakoÄe ono Äime se <i>clojure.spec</i> bavi jesu dinamiÄki
stvoreni podaci u programu a ne statiÄki.
</p>

<blockquote>
<p>
Dakle, smisao <code>clojure.spec</code>-a je da pruÅ¾i moÄan mehanizam za
deklerativan opis podataka koji Äe se proveravati u vreme
izvrÅ¡avanja.
</p>
</blockquote>

<p>
U ovom delu Äemo dati neke primere koriÄenja a za opÅ¡irniji uvod
pogledajte <a href="https://clojure.org/guides/spec">ovde</a>.
</p>

<p>
<b>[napomena]</b> <i>clojure.spec</i> je uveden u Clojure verziji <code>1.9</code> koja
joÅ¡ nije oficijalno izaÅ¡la pa Äe tako primeri biti dati za verziju
<code>1.9.0-alpha16</code>.
</p>

<p>
Å emu moÅ¾emo definisati na sledeÄi naÄin:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">ns</span> <span style="color: #ba2f59; font-weight: bold;">clojure-ntp.spec</span>
  <span style="color: #6c3163;">(</span><span style="color: #4e3163;">:require</span> <span style="color: #2d9574;">[</span>clojure.spec.alpha <span style="color: #4e3163;">:as</span> s<span style="color: #2d9574;">]</span>
            <span style="color: #2d9574;">[</span>clojure.repl <span style="color: #4e3163;">:refer</span> <span style="color: #67b11d;">[</span>doc<span style="color: #67b11d;">]</span><span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #4e3163;">:keyword</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; :keyword</span>

<span style="color: #4e3163;">::qualified-keyword</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; :clojure-ntp.spec/qualified-keyword</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::big-even</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/and int? even? #<span style="color: #2d9574;">(</span>&gt; <span style="color: #715ab1;">%</span> 1000<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
A ovako moÅ¾emo proveriti da li je neki podatak validan po nekoj Å¡emi:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #4e3163;">::big-even</span> 200<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #4e3163;">::big-even</span> 1100<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
</pre>
</div>

<p>
Dajemo joÅ¡ primera:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::name-or-id</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/or <span style="color: #4e3163;">:name</span> string?
                          <span style="color: #4e3163;">:id</span>   int?<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #4e3163;">::name-or-id</span> <span style="color: #2d9574;">"abc"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #4e3163;">::name-or-id</span> 100<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #4e3163;">::name-or-id</span> <span style="color: #4e3163;">:foo</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/conform <span style="color: #4e3163;">::name-or-id</span> <span style="color: #2d9574;">"abc"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [:name "abc"]</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/conform <span style="color: #4e3163;">::name-or-id</span> 100<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [:id 100]</span>
</pre>
</div>

<p>
Ako Å¾elimo da kaÅ¾emo da neka vrednost treba da zadovoljava Å¡emu ili
da bude <code>nil</code>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/nilable <span style="color: #4e3163;">::name-or-id</span><span style="color: #6c3163;">)</span> <span style="color: #4e3163;">nil</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/nilable <span style="color: #4e3163;">::name-or-id</span><span style="color: #6c3163;">)</span> <span style="color: #2d9574;">"abc"</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/nilable <span style="color: #4e3163;">::name-or-id</span><span style="color: #6c3163;">)</span> 0.1<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>
</pre>
</div>

<p>
Postoji i funkcija koja moÅ¾e da "objasni" zaÅ¡to neki podaci ne
zadovoljavaju datu Å¡emu:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/explain <span style="color: #4e3163;">::name-or-id</span> <span style="color: #6c3163;">{</span><span style="color: #4e3163;">:a</span> 1<span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">val: {:a 1} fails spec: :clojure-ntp.spec/name-or-id at: [:name] predicate: s</span><span style="color: #6c4173; background-color: #ecf3ec;">tring?</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">val: {:a 1} fails spec: :clojure-ntp.spec/name-or-id at: [:id] predicate: int</span><span style="color: #6c4173; background-color: #ecf3ec;">?</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/explain <span style="color: #4e3163;">::name-or-id</span> 1<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Success!</span>
</pre>
</div>
</div>

<div id="outline-container-org6b09df9" class="outline-4">
<h4 id="org6b09df9"><span class="section-number-4">7.4.1</span> Validatori za mape</h4>
<div class="outline-text-4" id="text-7-4-1">
<p>
Validitori za mape se kreiraju sa <code>clojure.spec/keys</code>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(doc s/keys)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.spec.alpha/keys</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([&amp; {:keys [req req-un opt opt-un gen]}])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Macro</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Creates and returns a map validating spec. :req and :opt are both</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">vectors of namespaced-qualified keywords. The validator will ensure</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the :req keys are present. The :opt keys serve as documentation and</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">may be used by the generator.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">The :req key vector supports 'and' and 'or' for key groups:</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(s/keys :req [::x ::y (or ::secret (and ::user ::pwd))] :opt [::z])</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">There are also -un versions of :req and :opt. These allow</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">you to connect unqualified keys to specs.  In each case, fully</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">qualfied keywords are passed, which name the specs, but unqualified</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">keys (with the same name component) are expected and checked at</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">conform-time, and generated during gen:</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(s/keys :req-un [:my.ns/x :my.ns/y])</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">The above says keys :x and :y are required, and will be validated</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">and generated by specs (if they exist) named :my.ns/x :my.ns/y</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">respectively.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">In addition, the values of *all* namespace-qualified keys will be validated</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(and possibly destructured) by any registered specs. Note: there is</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">no support for inline value specification, by design.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Optionally takes :gen generator-fn, which must be a fn of no args that</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">returns a test.check generator.</span>
</pre>
</div>

<p>
Evo nekih primera:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #715ab1;">email-regex</span> #<span style="color: #2d9574;">"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+</span><span style="color: #2d9574; font-weight: bold;">\.</span><span style="color: #2d9574;">[a-zA-Z]{2,63}$"</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::email-type</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/and string? #<span style="color: #2d9574;">(</span>re-matches email-regex <span style="color: #715ab1;">%</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::acctid</span> int?<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::first-name</span> string?<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::last-name</span> string?<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::email</span> <span style="color: #4e3163;">::email-type</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::phone</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/and string? #<span style="color: #2d9574;">(</span><span style="color: #3a81c3; font-weight: bold;">and</span> <span style="color: #67b11d;">(</span>&gt; <span style="color: #b1951d;">(</span>count <span style="color: #715ab1;">%</span><span style="color: #b1951d;">)</span> 5<span style="color: #67b11d;">)</span>
                                    <span style="color: #67b11d;">(</span>&lt; <span style="color: #b1951d;">(</span>count <span style="color: #715ab1;">%</span><span style="color: #b1951d;">)</span> 10<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::person</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/keys <span style="color: #4e3163;">:req</span> <span style="color: #2d9574;">[</span><span style="color: #4e3163;">::name-or-id</span> <span style="color: #4e3163;">::first-name</span> <span style="color: #4e3163;">::last-name</span> <span style="color: #4e3163;">::email</span><span style="color: #2d9574;">]</span>
                        <span style="color: #4e3163;">:opt</span> <span style="color: #2d9574;">[</span><span style="color: #4e3163;">::phone</span><span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #4e3163;">::person</span>
          <span style="color: #6c3163;">{</span><span style="color: #4e3163;">::name-or-id</span> 43
           <span style="color: #4e3163;">::first-name</span> <span style="color: #2d9574;">"Elon"</span>
           <span style="color: #4e3163;">::last-name</span>  <span style="color: #2d9574;">"Musk"</span>
           <span style="color: #4e3163;">::email</span>      <span style="color: #2d9574;">"elon@example.com"</span><span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #4e3163;">::person</span>
          <span style="color: #6c3163;">{</span><span style="color: #4e3163;">::name-or-id</span> 43
           <span style="color: #4e3163;">::first-name</span> <span style="color: #2d9574;">"Elon"</span>
           <span style="color: #4e3163;">::last-name</span>  <span style="color: #2d9574;">"Musk"</span>
           <span style="color: #4e3163;">::email</span>      <span style="color: #2d9574;">"elon#example.com"</span><span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/explain-data <span style="color: #4e3163;">::person</span> <span style="color: #6c3163;">{</span><span style="color: #4e3163;">::id</span> 43
                          <span style="color: #4e3163;">::first-name</span> <span style="color: #2d9574;">"Elon"</span>
                          <span style="color: #4e3163;">::last-name</span>  <span style="color: #2d9574;">"Musk"</span>
                          <span style="color: #4e3163;">::email</span>      <span style="color: #2d9574;">"elon#example.com"</span><span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">#:clojure.spec.alpha{:problems</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                      </span><span style="color: #2aa1ae; background-color: #ecf3ec;">({:path              [],</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:pred</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(contains? % :clojure-ntp.spec/name-or-id),</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:val</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">#:clojure-ntp.spec {:id         43,</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                                            </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:first-name "Elon",</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                                            </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:last-name  "Musk",</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                                            </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:email      "elon#example.com"},</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:via               [:clojure-ntp.spec/person],</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:in                []}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                       </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:path [:clojure-ntp.spec/email],</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:pred (re-matches email-regex %),</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:val  "elon#example.com",</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:via</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:clojure-ntp.spec/person</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                         </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:clojure-ntp.spec/email-type],</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                        </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:in   [:clojure-ntp.spec/email]})}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cf25cd" class="outline-4">
<h4 id="org7cf25cd"><span class="section-number-4">7.4.2</span> Validatori za kolekcije</h4>
<div class="outline-text-4" id="text-7-4-2">
<p>
Validatore za kolekcije moÅ¾ete dobiti i koriÅ¡Äenjem sledeÄih <i>helper</i>-a:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(doc s/coll-of)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.spec.alpha/coll-of</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([pred &amp; opts])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Macro</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns a spec for a collection of items satisfying pred. Unlike</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">'every', coll-of will exhaustively conform every value.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Same options as 'every'. conform will produce a collection</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">corresponding to :into if supplied, else will match the input collection,</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">avoiding rebuilding when possible.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">See also - every, map-of</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/coll-of number?<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">[</span>1 2 3<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/coll-of number?<span style="color: #6c3163;">)</span> '<span style="color: #6c3163;">(</span>1 2<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/coll-of number?<span style="color: #6c3163;">)</span> #<span style="color: #6c3163;">{</span>1<span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/coll-of number?<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">{</span><span style="color: #4e3163;">:a</span> 1<span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(doc s/tuple)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.spec.alpha/tuple</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([&amp; preds])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Macro</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">takes one or more preds and returns a spec for a tuple, a vector</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">where each element conforms to the corresponding pred. Each element</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">will be referred to in paths using its ordinal.</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/tuple string? number? keyword?<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">[</span><span style="color: #2d9574;">"a"</span> 1 <span style="color: #4e3163;">:a</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/tuple string? number? keyword?<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">[</span><span style="color: #2d9574;">"a"</span> 1<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/tuple string? number? keyword?<span style="color: #6c3163;">)</span> '<span style="color: #6c3163;">(</span><span style="color: #2d9574;">"a"</span> 1 <span style="color: #4e3163;">:a</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(doc s/map-of)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.spec.alpha/map-of</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([kpred vpred &amp; opts])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Macro</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns a spec for a map whose keys satisfy kpred and vals satisfy</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">vpred. Unlike 'every-kv', map-of will exhaustively conform every</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">value.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Same options as 'every', :kind defaults to map?, with the addition of:</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:conform-keys - conform keys as well as values (default false)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">See also - every-kv</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/map-of integer? string?<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">{</span>1 <span style="color: #2d9574;">"one"</span> 2 <span style="color: #2d9574;">"two"</span><span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/map-of integer? string?<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">{</span>1 <span style="color: #2d9574;">"one"</span> 2 22<span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6debe00" class="outline-4">
<h4 id="org6debe00"><span class="section-number-4">7.4.3</span> Validatori za sekvence</h4>
<div class="outline-text-4" id="text-7-4-3">
<p>
Sekvencijalni podaci se mogu validirati validatorima koji
oslikavaju one standardne operatore kod regularnih izraza:
</p>

<ul class="org-ul">
<li><code>cat</code> &#x2014; konkatenacija Å¡ema</li>
<li><code>alt</code> &#x2014; izbor Å¡ema</li>
<li><code>*</code> &#x2014; 0 ili viÅ¡e pojava neke Å¡eme</li>
<li><code>+</code> &#x2014; 1 ili viÅ¡e pojava neke Å¡eme</li>
<li><code>?</code> &#x2014; 0 ili 1 pojava neke Å¡eme</li>
</ul>

<p>
Ovde Äemo dati samo neke primere:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::ingredient</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/cat <span style="color: #4e3163;">:quantity</span> number? <span style="color: #4e3163;">:unit</span> keyword?<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #4e3163;">::ingredient</span> <span style="color: #6c3163;">[</span>2 <span style="color: #4e3163;">:teaspoon</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/conform <span style="color: #4e3163;">::ingredient</span> <span style="color: #6c3163;">[</span>2 <span style="color: #4e3163;">:teaspoon</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; {:quantity 2, :unit :teaspoon}</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/* keyword?<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">[</span><span style="color: #4e3163;">:a</span> <span style="color: #4e3163;">:b</span> <span style="color: #4e3163;">:c</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/* keyword?<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">[</span><span style="color: #4e3163;">:a</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; true</span>
<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/valid? <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/* keyword?<span style="color: #6c3163;">)</span> <span style="color: #6c3163;">[</span><span style="color: #4e3163;">:a</span> 1<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; false</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ca5941" class="outline-4">
<h4 id="org3ca5941"><span class="section-number-4">7.4.4</span> Validiranje funkcija</h4>
<div class="outline-text-4" id="text-7-4-4">
<p>
PoÅ¡to moÅ¾emo opisati podatke onda moÅ¾emo opisati i parametre
funkcije kao i njene povratne vrednosti. Dodatno, moÅ¾emo opisati i
funkciju koja Äe proveriti da li vaÅ¾i neka za:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(doc s/fdef)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.spec.alpha/fdef</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([fn-sym &amp; specs])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Macro</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Takes a symbol naming a function, and one or more of the following:</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:args A regex spec for the function arguments as they were a list to be</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;     </span><span style="color: #2aa1ae; background-color: #ecf3ec;">passed to apply - in this way, a single spec can handle functions with</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;     </span><span style="color: #2aa1ae; background-color: #ecf3ec;">multiple arities</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:ret A spec for the function's return value</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:fn A spec of the relationship between args and ret - the</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;     </span><span style="color: #2aa1ae; background-color: #ecf3ec;">value passed is {:args conformed-args :ret conformed-ret} and is</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;     </span><span style="color: #2aa1ae; background-color: #ecf3ec;">expected to contain predicates that relate those values</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Qualifies fn-sym with resolve, or using *ns* if no resolution found.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Registers an fspec in the global registry, where it can be retrieved</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">by calling get-spec with the var or fully-qualified symbol.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Once registered, function specs are included in doc, checked by</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">instrument, tested by the runner clojure.spec.test.alpha/check, and (if</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">a macro) used to explain errors during macroexpansion.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Note that :fn specs require the presence of :args and :ret specs to</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">conform values, and so :fn specs will be ignored if :args or :ret</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">are missing.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns the qualified fn-sym.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">For example, to register function specs for the symbol function:</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(s/fdef clojure.core/symbol</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;     </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:args (s/alt :separate (s/cat :ns string? :n string?)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:str string?</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:sym symbol?)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;     </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:ret symbol?)</span>

<span style="color: #3a81c3;">(</span>require '<span style="color: #6c3163;">[</span>clojure.spec.test.alpha <span style="color: #4e3163;">:as</span> st<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(doc st/instrument)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.spec.test.alpha/instrument</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([] [sym-or-syms] [sym-or-syms opts])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Instruments the vars named by sym-or-syms, a symbol or collection</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">of symbols, or all instrumentable vars if sym-or-syms is not</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">specified.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">If a var has an :args fn-spec, sets the var's root binding to a</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">fn that checks arg conformance (throwing an exception on failure)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">before delegating to the original fn.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">The opts map can be used to override registered specs, and/or to</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">replace fn implementations entirely. Opts for symbols not included</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">in sym-or-syms are ignored. This facilitates sharing a common</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">options map across many different calls to instrument.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">The opts map may have the following keys:</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:spec     a map from var-name symbols to override specs</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:stub     a set of var-name symbols to be replaced by stubs</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:gen      a map from spec names to generator overrides</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:replace  a map from var-name symbols to replacement fns</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:spec overrides registered fn-specs with specs your provide. Use</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:spec overrides to provide specs for libraries that do not have</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">them, or to constrain your own use of a fn to a subset of its</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">spec'ed contract.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:stub replaces a fn with a stub that checks :args, then uses the</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:ret spec to generate a return value.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:gen overrides are used only for :stub generation.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:replace replaces a fn with a fn that checks args conformance, then</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">invokes the fn you provide, enabling arbitrary stubbing and mocking.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:spec can be used in combination with :stub or :replace.</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns a collection of syms naming the vars instrumented.</span>

<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">defn</span> <span style="color: #6c3163; font-weight: bold;">ranged-rand</span>
  <span style="color: #da8b55;">"Returns random int in range start &lt;= rand &lt; end"</span>
  <span style="color: #6c3163;">[</span>start end<span style="color: #6c3163;">]</span>
  <span style="color: #6c3163;">(</span>+ start <span style="color: #2d9574;">(</span>long <span style="color: #67b11d;">(</span>rand <span style="color: #b1951d;">(</span>- end start<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/fdef ranged-rand
        <span style="color: #4e3163;">:args</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/and <span style="color: #2d9574;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/cat <span style="color: #4e3163;">:start</span> int? <span style="color: #4e3163;">:end</span> int?<span style="color: #2d9574;">)</span>
                     #<span style="color: #2d9574;">(</span>&lt; <span style="color: #67b11d;">(</span><span style="color: #4e3163;">:start</span> <span style="color: #715ab1;">%</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span><span style="color: #4e3163;">:end</span> <span style="color: #715ab1;">%</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
        <span style="color: #4e3163;">:ret</span> int?
        <span style="color: #4e3163;">:fn</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/and #<span style="color: #2d9574;">(</span>&gt;= <span style="color: #67b11d;">(</span><span style="color: #4e3163;">:ret</span> <span style="color: #715ab1;">%</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;</span> <span style="color: #715ab1;">%</span> <span style="color: #4e3163;">:args</span> <span style="color: #4e3163;">:start</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
                   #<span style="color: #2d9574;">(</span>&lt; <span style="color: #67b11d;">(</span><span style="color: #4e3163;">:ret</span> <span style="color: #715ab1;">%</span><span style="color: #67b11d;">)</span> <span style="color: #67b11d;">(</span><span style="color: #3a81c3; font-weight: bold;">-&gt;</span> <span style="color: #715ab1;">%</span> <span style="color: #4e3163;">:args</span> <span style="color: #4e3163;">:end</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span>ranged-rand 10 20<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 11</span>

<span style="color: #3a81c3;">(</span>ranged-rand 20 10<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 11</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">st</span>/instrument `ranged-rand<span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(ranged-rand 20 10)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; Run time error</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:clojure.spec.alpha/problems [{:path [:args], :pred (&lt; (:start %) (:end %)),</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                                 </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:val {:start 20, :end 10}, :via [], :in []}],</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:clojure.spec.alpha/args (20 10),</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:clojure.spec.alpha/failure :instrument,</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:clojure.spec.test.alpha/caller</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{:file "form-init2622668631526581668.clj",</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:line 313,</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;   </span><span style="color: #2aa1ae; background-color: #ecf3ec;">:var-scope clojure-ntp.spec/eval24505}}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c322ba" class="outline-4">
<h4 id="org4c322ba"><span class="section-number-4">7.4.5</span> Generativno testiranje <code>test-check</code></h4>
<div class="outline-text-4" id="text-7-4-5">
<p>
Kada imamo sve ove validatore baÅ¡ bi bilo dobro da postoji naÄin
da generiÅ¡emo podatke iz Å¡eme. To bi nam baÅ¡ bilo korisno za
testiranje. Ono Å¡to nam treba za ovako neÅ¡to se nalazi u
<code>clojure.spec.gen.alpha</code> <i>namespace-u</i>.
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span>require '<span style="color: #6c3163;">[</span>clojure.spec.gen.alpha <span style="color: #4e3163;">:as</span> gen<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(doc s/gen)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.spec.alpha/gen</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([spec] [spec overrides])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Given a spec, returns the generator for it, or throws if none can</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">be constructed. Optionally an overrides map can be provided which</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">should map spec names or paths (vectors of keywords) to no-arg</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">generator-creating fns. These will be used instead of the generators at those</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">names/paths. Note that parent generator (in the spec or overrides</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                                             </span><span style="color: #2aa1ae; background-color: #ecf3ec;">map) will supersede those of any </span><span style="color: #6c4173; background-color: #ecf3ec;">subtrees. A generator for a regex</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">op must always return a sequential collection (i.e. a generator for</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                                                     </span><span style="color: #2aa1ae; background-color: #ecf3ec;">s/? should return either </span><span style="color: #6c4173; background-color: #ecf3ec;">an empty sequence/vector or a</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;                                                     </span><span style="color: #2aa1ae; background-color: #ecf3ec;">sequence/vector with one </span><span style="color: #6c4173; background-color: #ecf3ec;">item in it)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(doc gen/generate)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.spec.gen.alpha/generate</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([generator])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Generate a single value using generator.</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">::article</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/cat <span style="color: #4e3163;">:id</span> pos-int? <span style="color: #4e3163;">:name</span> string?<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">gen</span>/generate <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/gen <span style="color: #4e3163;">::article</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (5 "ZUy89X72lb1l5Nzj52EIdUMj1Rq5ui")</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">gen</span>/sample <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/gen <span style="color: #4e3163;">::article</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">((1 "")</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(2 "0")</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(1 "")</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(2 "")</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(1 "RtPf")</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(2 "2nZ")</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(1 "")</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(2 "lo78A")</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(3 "rc")</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(2 "IWy"))</span>
</pre>
</div>

<p>
Funkcija kojom moÅ¾emo da dobijemo uporedno generisane podatke i
njihovo slaganje u Å¡emu je <code>exercise</code>:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/exercise <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/or <span style="color: #4e3163;">:k</span> keyword? <span style="color: #4e3163;">:s</span> string? <span style="color: #4e3163;">:n</span> number?<span style="color: #6c3163;">)</span> 5<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([:d [:k :d]]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:x/y3 [:k :x/y3]]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[:Np.x/_ [:k :Np.x/_]]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[0 [:n 0]]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">["lcvR" [:s "lcvR"]])</span>
</pre>
</div>

<p>
MoÅ¾emo od generatora dobiti i parove ulaz-izlaz za funkcije kojima
smo dali Å¡eme i koje smo instrumentalizovali &#x2014; eto generativnog
testiranja:
</p>

<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">(doc s/exercise-fn)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">-------------------------</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">clojure.spec.alpha/exercise-fn</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([sym] [sym n] [sym-or-f n fspec])</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">exercises the fn named by sym (a symbol) by applying it to</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">n (default 10) generated samples of its args spec. When fspec is</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">supplied its arg spec is used, and sym-or-f can be a fn.  Returns a</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">sequence of tuples of [args ret].</span>

<span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">s</span>/exercise-fn `ranged-rand<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt;</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">([(-4 0) -2]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[(-1 0) -1]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[(-1 1) -1]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[(-2 0) -1]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[(-1 1) -1]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[(-1 0) -1]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[(-3 6) 1]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[(4 45) 31]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[(-8 -4) -6]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;;  </span><span style="color: #2aa1ae; background-color: #ecf3ec;">[(-145 -20) -142])</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org8c6bf28" class="outline-2">
<h2 id="org8c6bf28"><span class="section-number-2">8</span> ClojureScript</h2>
</div>

<div id="outline-container-org9e1112f" class="outline-2">
<h2 id="org9e1112f"><span class="section-number-2">9</span> Literatura</h2>
<div class="outline-text-2" id="text-9">
<ul class="org-ul">
<li><a href="http://www.braveclojure.com/">Clojure For The Brave and True</a> &#x2014; Daniel Higginbotham</li>
<li>Professional Clojure &#x2014; Anderson, Gaare, Holguin, Bailey, Pratley</li>
<li>Web Development with Clojure 2nd Edition &#x2014; Dmitri Sotnikov</li>
<li><a href="http://deptinfo.unice.fr/~roy/sicp.pdf">Structure and Interpretation of Computer Programs</a> &#x2014; Harold
Abelson, Gerald Jay Sussman with Julie Sussman (sa video
<a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-001-structure-and-interpretation-of-computer-programs-spring-2005/video-lectures/">predavanjima</a> na YouTube-u)</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Novak BoÅ¡kov</p>
<p class="date">Created: 2018-04-26 Thu 16:09</p>
<p class="validation"></p>
</div>
</body>
</html>
